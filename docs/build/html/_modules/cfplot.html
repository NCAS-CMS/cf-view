<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>cfplot &mdash; cf-view 0.6.10 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.6.10',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="cf-view 0.6.10 documentation" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../index.html">cf-view 0.6.10 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for cfplot</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Routines for making climate contour/vector plots using cf-python, matplotlib and basemap.</span>
<span class="sd">Andy Heaps NCAS-CMS February 2014.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">pvars</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
   <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
      <span class="sd">&#39;&#39;&#39;Initialize a new Pvars instance&#39;&#39;&#39;</span>
      <span class="k">for</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
         <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">attr</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

   <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
      <span class="sd">&#39;&#39;&#39;x.__str__() &lt;==&gt; str(x)&#39;&#39;&#39;</span>
      <span class="n">out</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> = </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">v</span><span class="p">))]</span>
      <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
         <span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">cf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">call</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">call</span>
<span class="kn">import</span> <span class="nn">matplotlib</span>
<span class="kn">import</span> <span class="nn">matplotlib.tri</span> <span class="kn">as</span> <span class="nn">triang</span>


<span class="c">#Check for a display and use the Agg backing store if none is present</span>
<span class="c">#This is for batch mode processing</span>
<span class="k">try</span><span class="p">:</span>
   <span class="n">disp</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s">&quot;DISPLAY&quot;</span><span class="p">]</span>
<span class="k">except</span><span class="p">:</span>
   <span class="n">matplotlib</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">&#39;Agg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plot</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.basemap</span> <span class="kn">import</span> <span class="n">Basemap</span><span class="p">,</span> <span class="n">shiftgrid</span><span class="p">,</span> <span class="n">addcyclic</span>




<span class="c">#####################################</span>
<span class="c">#plotvars - global plotting variables</span>
<span class="c">#####################################</span>

<span class="c">#Default colour scales</span>
<span class="c">#cscale1 is a differential data scale - blue to red</span>
<span class="n">cscale1</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;#0a3278&#39;</span><span class="p">,</span> <span class="s">&#39;#0f4ba5&#39;</span><span class="p">,</span> <span class="s">&#39;#1e6ec8&#39;</span><span class="p">,</span> <span class="s">&#39;#3ca0f0&#39;</span><span class="p">,</span> <span class="s">&#39;#50b4fa&#39;</span><span class="p">,</span> <span class="s">&#39;#82d2ff&#39;</span><span class="p">,</span> <span class="s">&#39;#a0f0ff&#39;</span><span class="p">,</span> \
         <span class="s">&#39;#c8faff&#39;</span><span class="p">,</span> <span class="s">&#39;#e6ffff&#39;</span><span class="p">,</span> <span class="s">&#39;#fffadc&#39;</span><span class="p">,</span> <span class="s">&#39;#ffe878&#39;</span><span class="p">,</span> <span class="s">&#39;#ffc03c&#39;</span><span class="p">,</span> <span class="s">&#39;#ffa000&#39;</span><span class="p">,</span> <span class="s">&#39;#ff6000&#39;</span><span class="p">,</span> \
         <span class="s">&#39;#ff3200&#39;</span><span class="p">,</span> <span class="s">&#39;#e11400&#39;</span><span class="p">,</span> <span class="s">&#39;#c00000&#39;</span><span class="p">,</span> <span class="s">&#39;#a50000&#39;</span><span class="p">]</span>

<span class="c">#cosam is a continuous data scale - purple, blue, green, yellow, red</span>
<span class="n">cosam</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;#780088&#39;</span><span class="p">,</span> <span class="s">&#39;#5a00b8&#39;</span><span class="p">,</span> <span class="s">&#39;#4600f5&#39;</span><span class="p">,</span> <span class="s">&#39;#00aae1&#39;</span><span class="p">,</span> <span class="s">&#39;#00c8c8&#39;</span><span class="p">,</span> <span class="s">&#39;#00c87d&#39;</span><span class="p">,</span> <span class="s">&#39;#c3ff00&#39;</span><span class="p">,</span> \
         <span class="s">&#39;#ffff00&#39;</span><span class="p">,</span> <span class="s">&#39;#ff9b00&#39;</span><span class="p">,</span> <span class="s">&#39;#ff0000&#39;</span><span class="p">]</span>



<span class="n">plotvars</span><span class="o">=</span><span class="n">pvars</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=-</span><span class="mi">180</span><span class="p">,</span> <span class="n">lonmax</span><span class="o">=</span><span class="mi">180</span><span class="p">,</span> <span class="n">latmin</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">latmax</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s">&#39;cyl&#39;</span><span class="p">,</span> \
               <span class="n">resolution</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">plot_type</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> \
               <span class="n">levels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">levels_min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">levels_max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">levels_step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> \
               <span class="n">levels_extend</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span> <span class="n">xmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> \
               <span class="n">xlog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>\
               <span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;landscape&#39;</span><span class="p">,</span>\
               <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">user_cscale</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">user_levs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>\
               <span class="n">master_plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">text_fontsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">cs</span><span class="o">=</span><span class="n">cscale1</span><span class="p">,</span> \
               <span class="n">mymap</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> \
               <span class="n">xticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> \
               <span class="n">xstep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ystep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> \
               <span class="n">title_fontsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">axis_label_fontsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> \
               <span class="n">text_fontweight</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">,</span> <span class="n">axis_label_fontweight</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">,</span> \
               <span class="n">title_fontweight</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">,</span> \
               <span class="n">continent_thickness</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">continent_color</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>


<div class="viewcode-block" id="con"><a class="viewcode-back" href="../con.html#cfplot.con">[docs]</a><span class="k">def</span> <span class="nf">con</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">lines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">line_labels</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> \
        <span class="n">colorbar_title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colorbar</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">colorbar_label_skip</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> \
        <span class="n">negative_linestyle</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">blockfill</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">zero_thick</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colorbar_shrink</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> \
        <span class="n">colorbar_orientation</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | con is the interface to contouring in cfplot. The minimum use is con(f) </span>
<span class="sd">    | where f is a 2 dimensional array. If a cf field is passed then an </span>
<span class="sd">    | appropriate plot will be produced i.e. a longitude-latitude or </span>
<span class="sd">    | latitude-height plot for example. If a 2d numeric array is passed then </span>
<span class="sd">    | the optional arrays x and y can be used to describe the x and y data </span>
<span class="sd">    | point locations.</span>
<span class="sd">    |</span>
<span class="sd">    | f - array to contour</span>
<span class="sd">    | x - x locations of data in f (optional)</span>
<span class="sd">    | y - y locations of data in f (optional)</span>
<span class="sd">    | fill=True - colour fill contours</span>
<span class="sd">    | lines=True - draw contour lines and labels</span>
<span class="sd">    | line_labels=True - label contour lines</span>
<span class="sd">    | title=title - title for the plot</span>
<span class="sd">    | ptype=0 - plot type - not needed for cf fields.</span>
<span class="sd">    |                       0 = no specific plot type,</span>
<span class="sd">    |                       1 = longitude-latitude,</span>
<span class="sd">    |                       2 = latitude - height, </span>
<span class="sd">    |                       3 = longitude - height, </span>
<span class="sd">    |                       4 = latitude - time,</span>
<span class="sd">    |                       5 = longitude - time</span>
<span class="sd">    |                       6 = rotated pole</span>
<span class="sd">    | negative_linestyle=None - set to 1 to get dashed negative contours</span>
<span class="sd">    | zero_thick=None - add a thick zero contour line. Set to 3 for example.</span>
<span class="sd">    | blockfill=None - set to 1 for a blockfill plot</span>
<span class="sd">    | colbar_title=colbar_title - title for the colour bar</span>
<span class="sd">    | colorbar=1 - add a colour bar if a filled contour plot</span>
<span class="sd">    | colorbar_label_skip=None - skip colour bar labels. Set to 2 to skip every</span>
<span class="sd">    |                            other label.</span>
<span class="sd">    | colorbar_orientation=None - options are &#39;horizontal&#39; and &#39;vertical&#39;</span>
<span class="sd">    |                      The default for most plots is horizontal but</span>
<span class="sd">    |                      for polar stereographic plots this is vertical.</span>
<span class="sd">    | colorbar_shrink=None - value to shrink the colorbar by.  If the colorbar </span>
<span class="sd">    |                        exceeds the plot area then values of 1.0, 0.55 or 0.5</span>
<span class="sd">    |                        may help it better fit the plot area.</span>
<span class="sd">    | xlog=None - logarithmic x axis</span>
<span class="sd">    | ylog=None - logarithmic y axis</span>
<span class="sd">    | verbose=None - change to 1 to get a verbose listing of what con is doing</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     None</span>

<span class="sd">   &quot;&quot;&quot;</span> 

   <span class="c">#Extract required data for contouring</span>
   <span class="c">#If a cf-python field</span>
   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
      <span class="c">#Check if this is a cf.Fieldlist and reject if it is</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> cf_data_assign error - passed field is a cf.Fieldlist</span><span class="se">\n</span><span class="s">&#39;</span>
         <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;Please pass one field for contouring</span><span class="se">\n</span><span class="s">&#39;</span>
         <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;i.e. f[0]</span><span class="se">\n</span><span class="s">&#39;</span>
         <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span> 

      <span class="c">#Extract data</span>
      <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - calling cf_data_assign&#39;</span>
      <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">time_opts</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span>\
             <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>

   <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - using user assigned data&#39;</span>
      <span class="n">field</span><span class="o">=</span><span class="n">f</span> <span class="c">#field data passed in as f</span>
      <span class="n">check_data</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
      <span class="n">xlabel</span><span class="o">=</span><span class="s">&#39;&#39;</span>
      <span class="n">ylabel</span><span class="o">=</span><span class="s">&#39;&#39;</span>





   <span class="c">#Set contour line styles</span>
   <span class="k">if</span> <span class="n">negative_linestyle</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;contour.negative_linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;solid&#39;</span>
   <span class="k">else</span><span class="p">:</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;contour.negative_linestyle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">negative_linestyle</span>


   <span class="c">#Set contour lines off on block plots</span>
   <span class="k">if</span> <span class="n">blockfill</span><span class="p">:</span> 
      <span class="n">fill</span><span class="o">=</span><span class="bp">False</span>
      <span class="k">if</span> <span class="n">lines</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> <span class="n">lines</span><span class="o">=</span><span class="bp">False</span>
      <span class="n">field_orig</span><span class="o">=</span><span class="n">field</span>  
      <span class="n">x_orig</span><span class="o">=</span><span class="n">x</span>
      <span class="n">y_orig</span><span class="o">=</span><span class="n">y</span>   

      <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;spstere&#39;</span><span class="p">):</span>         
         <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s"> con error - blockfill not supported for polar stereograpic plots</span><span class="se">\n\n</span><span class="s">&#39;</span>
         <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

   <span class="c">#Turn off colorbar if fill is turned off</span>
   <span class="k">if</span> <span class="n">fill</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">blockfill</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">colorbar</span><span class="o">=</span><span class="mi">0</span>

   <span class="c">#Revert to default colour scale if user_cscale flag is set</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_cscale</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="o">=</span><span class="n">cscale1</span>


   <span class="c">#Set the orientation of the colorbar</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;spstere&#39;</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">colorbar_orientation</span><span class="o">=</span><span class="s">&#39;vertical&#39;</span>
   <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">colorbar_orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span>



   <span class="c">#Set size of color bar if not specified</span>
   <span class="k">if</span> <span class="n">colorbar_shrink</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">colorbar_shrink</span><span class="o">=</span><span class="mf">1.0</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">scale</span><span class="o">=</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="o">-</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="o">-</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">colorbar_shrink</span><span class="o">=</span><span class="mf">0.55</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s">&#39;landscape&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;cyl&#39;</span> <span class="ow">and</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s">&#39;vertical&#39;</span><span class="p">):</span> <span class="n">colorbar_shrink</span><span class="o">=</span><span class="mf">0.5</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;cyl&#39;</span> <span class="ow">and</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s">&#39;horizontal&#39;</span><span class="p">):</span> <span class="n">colorbar_shrink</span><span class="o">=</span><span class="mf">1.0</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s">&#39;portrait&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;cyl&#39;</span> <span class="ow">and</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s">&#39;vertical&#39;</span><span class="p">):</span> <span class="n">colorbar_shrink</span><span class="o">=</span><span class="mf">0.25</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;cyl&#39;</span> <span class="ow">and</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s">&#39;horizontal&#39;</span><span class="p">):</span> <span class="n">colorbar_shrink</span><span class="o">=</span><span class="mf">1.0</span>       

         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;spstere&#39;</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s">&#39;landscape&#39;</span><span class="p">:</span>
               <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s">&#39;horizontal&#39;</span><span class="p">:</span> <span class="n">colorbar_shrink</span><span class="o">=</span><span class="mf">1.0</span>
               <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s">&#39;vertical&#39;</span><span class="p">:</span> <span class="n">colorbar_shrink</span><span class="o">=</span><span class="mf">1.0</span>
            <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span> <span class="o">==</span> <span class="s">&#39;portrait&#39;</span><span class="p">:</span>
               <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s">&#39;horizontal&#39;</span><span class="p">:</span> <span class="n">colorbar_shrink</span><span class="o">=</span><span class="mf">1.0</span>
               <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s">&#39;vertical&#39;</span><span class="p">:</span> <span class="n">colorbar_shrink</span><span class="o">=</span><span class="mf">1.0</span>




   <span class="c">#Set plot type if user specified</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">ptype</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span><span class="o">=</span><span class="n">ptype</span>
 
 
   <span class="c">#Get contour levels      </span>
   <span class="n">includes_zero</span><span class="o">=</span><span class="mi">0</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="c">#User defined    </span>
      <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - using user defined contour levels&#39;</span>
      <span class="n">clevs</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span>
      <span class="n">mult</span><span class="o">=</span><span class="mi">0</span>
      <span class="n">fmult</span><span class="o">=</span><span class="mi">1</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_cscale</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="n">includes_zero</span><span class="o">=</span><span class="mi">0</span>
         <span class="n">col_zero</span><span class="o">=</span><span class="mi">0</span>
         <span class="k">for</span> <span class="n">cval</span> <span class="ow">in</span> <span class="n">clevs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">includes_zero</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">col_zero</span><span class="o">=</span><span class="n">col_zero</span><span class="o">+</span><span class="mi">1</span>   
            <span class="k">if</span> <span class="n">cval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">includes_zero</span><span class="o">=</span><span class="mi">1</span>

         <span class="k">if</span> <span class="n">includes_zero</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cscale</span><span class="p">(</span><span class="s">&#39;scale1&#39;</span><span class="p">,</span> <span class="n">below</span><span class="o">=</span><span class="n">col_zero</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span><span class="o">-</span><span class="n">col_zero</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">cscale</span><span class="p">(</span><span class="s">&#39;cosam&#39;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>   

         <span class="n">plotvars</span><span class="o">.</span><span class="n">user_cscale</span><span class="o">=</span><span class="mi">0</span> <span class="c">#Revert to standard colour scale after plot</span>

   <span class="k">else</span><span class="p">:</span>
      <span class="c">#Automatic levels  </span>
      <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - generating automatic contour levels&#39;</span>
      <span class="n">clevs</span><span class="p">,</span> <span class="n">mult</span> <span class="o">=</span> <span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">field</span><span class="p">),</span> <span class="n">dmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">field</span><span class="p">),</span> <span class="n">tight</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
      <span class="n">fmult</span><span class="o">=</span><span class="mi">10</span><span class="o">**-</span><span class="n">mult</span>      

      <span class="c">#Adjust colour table</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_cscale</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="n">col_zero</span><span class="o">=</span><span class="mi">0</span>
         <span class="k">for</span> <span class="n">cval</span> <span class="ow">in</span> <span class="n">clevs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">includes_zero</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">col_zero</span><span class="o">=</span><span class="n">col_zero</span><span class="o">+</span><span class="mi">1</span>   
            <span class="k">if</span> <span class="n">cval</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">includes_zero</span><span class="o">=</span><span class="mi">1</span>

         <span class="k">if</span> <span class="n">includes_zero</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">cscale</span><span class="p">(</span><span class="s">&#39;scale1&#39;</span><span class="p">,</span> <span class="n">below</span><span class="o">=</span><span class="n">col_zero</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span><span class="o">-</span><span class="n">col_zero</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">cscale</span><span class="p">(</span><span class="s">&#39;cosam&#39;</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

         <span class="c">#Revert to standard colour scale after plot</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">user_cscale</span><span class="o">=</span><span class="mi">0</span> 


   <span class="c">#Set colorbar labels</span>
   <span class="c">#Set a sensible label spacing if the user hasn&#39;t already done so   </span>
   <span class="k">if</span> <span class="n">colorbar_label_skip</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">colorbar_orientation</span> <span class="o">==</span> <span class="s">&#39;horizontal&#39;</span><span class="p">:</span>
         <span class="n">nchars</span><span class="o">=</span><span class="mi">0</span>
         <span class="k">for</span> <span class="n">lev</span> <span class="ow">in</span> <span class="n">clevs</span><span class="p">:</span> <span class="n">nchars</span><span class="o">=</span><span class="n">nchars</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lev</span><span class="p">))</span>
         <span class="n">colorbar_label_skip</span><span class="o">=</span><span class="n">nchars</span><span class="o">/</span><span class="mi">80</span><span class="o">+</span><span class="mi">1</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">colorbar_label_skip</span><span class="o">=</span><span class="n">nchars</span><span class="o">*</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span><span class="o">/</span><span class="mi">80</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">colorbar_label_skip</span><span class="o">=</span><span class="mi">1</span>
      
   <span class="k">if</span> <span class="n">colorbar_label_skip</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">includes_zero</span><span class="p">:</span> 
         <span class="c">#include zero in the colorbar labels</span>
         <span class="n">zero_pos</span><span class="o">=</span><span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">mylev</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span> <span class="k">if</span> <span class="n">mylev</span> <span class="o">==</span> <span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
         <span class="n">colorbar_labels</span><span class="o">=</span><span class="n">clevs</span><span class="p">[</span><span class="n">zero_pos</span><span class="p">]</span>
         <span class="n">i</span><span class="o">=</span><span class="n">zero_pos</span><span class="o">+</span><span class="n">colorbar_label_skip</span>
         <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">colorbar_labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colorbar_labels</span><span class="p">,</span> <span class="n">clevs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="n">colorbar_label_skip</span>
         <span class="n">i</span><span class="o">=</span><span class="n">zero_pos</span><span class="o">-</span><span class="n">colorbar_label_skip</span>
         <span class="k">if</span> <span class="n">i</span> <span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">while</span> <span class="n">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
               <span class="n">colorbar_labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">clevs</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">colorbar_labels</span><span class="p">)</span>
               <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">-</span><span class="n">colorbar_label_skip</span>
      <span class="k">else</span><span class="p">:</span> 
         <span class="n">colorbar_labels</span><span class="o">=</span><span class="n">clevs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
         <span class="n">i</span><span class="o">=</span><span class="n">colorbar_label_skip</span>
         <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">colorbar_labels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">colorbar_labels</span><span class="p">,</span> <span class="n">clevs</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">i</span><span class="o">=</span><span class="n">i</span><span class="o">+</span><span class="n">colorbar_label_skip</span>        
   <span class="k">else</span><span class="p">:</span> 
      <span class="n">colorbar_labels</span><span class="o">=</span><span class="n">clevs</span>


   <span class="c">#Add mult to colorbar_title if used </span>
   <span class="k">if</span> <span class="p">(</span><span class="n">colorbar_title</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span> 
      <span class="n">colorbar_title</span><span class="o">=</span><span class="s">&#39;&#39;</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">mult</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="o">+</span><span class="s">&#39; *10$^{&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mult</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;}$&#39;</span> 


   <span class="c">#Catch null titles</span>
   <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;&#39;</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">title</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title</span>
  
   <span class="c">#Set plot variables</span>
   <span class="n">title_fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>
   <span class="n">text_fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
   <span class="n">axis_label_fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span>
   <span class="n">continent_thickness</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
   <span class="n">continent_color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
   <span class="k">if</span> <span class="n">title_fontsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">15</span>
   <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">text_fontsize</span><span class="o">=</span><span class="mi">11</span>
   <span class="k">if</span> <span class="n">axis_label_fontsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">axis_label_fontsize</span><span class="o">=</span><span class="mi">11</span>
   <span class="n">text_fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span>
   <span class="n">title_fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span>
   <span class="n">axis_label_fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span>
   <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">continent_thickness</span><span class="o">=</span><span class="mf">1.5</span>
   <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">continent_color</span><span class="o">=</span><span class="s">&#39;k&#39;</span>

 
   <span class="c">#Select contour triangulation based on input grid dimensions</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>   <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>  
      <span class="n">tri</span><span class="o">=</span><span class="mi">1</span>      
   <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span>   <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>  
      <span class="n">tri</span><span class="o">=</span><span class="mi">0</span>      
   <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span>   <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
      <span class="n">tri</span><span class="o">=</span><span class="mi">0</span>





   <span class="c">########## </span>
   <span class="c"># Map plot</span>
   <span class="c">##########</span>
   <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
      <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - making a map plot&#39;</span>
      <span class="c">#Open a new plot is necessary</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

      <span class="c">#Set up mapping</span>
      <span class="n">lonrange</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="c">#Reset mapping</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="o">=-</span><span class="mi">180</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="o">=</span><span class="mi">180</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="o">=-</span><span class="mi">90</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="o">=</span><span class="mi">90</span>

      <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">set_map</span><span class="p">()</span>  
      <span class="k">else</span><span class="p">:</span>
         <span class="n">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">lonmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">latmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> \
                <span class="n">latmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
         <span class="n">set_map</span><span class="p">()</span>  


      <span class="n">mymap</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>   
      <span class="n">user_mapset</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span>
   
      <span class="n">lonrange</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 
      <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;</span><span class="mi">350</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      
         <span class="c">#Add cyclic information if missing.</span>
         <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
            <span class="n">field</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">addcyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">lonrange</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

         <span class="c">#Shift grid if needed</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">-</span><span class="mi">360</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">+</span><span class="mi">360</span>
         <span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">shiftgrid</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>   

         <span class="c">#Add cyclic information if missing.</span>
         <span class="n">lonrange</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
         <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
            <span class="n">field</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">addcyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
            <span class="n">lonrange</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>


      <span class="c">#Flip latitudes and field if latitudes are in descending order</span>
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
            <span class="n">field</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
   
      <span class="c">#Plotting a sub-area of the grid produces stray contour labels in polar plots</span>
      <span class="c">#Subsample the grid to remove this problem</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;npstere&#39;</span><span class="p">:</span>
         <span class="n">myypos</span><span class="o">=</span><span class="n">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span>
         <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="n">myypos</span><span class="p">:]</span>
         <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">[</span><span class="n">myypos</span><span class="p">:,</span> <span class="p">:]</span>

      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;spstere&#39;</span><span class="p">:</span>
         <span class="n">myypos</span><span class="o">=</span><span class="n">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>     
         <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">myypos</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
         <span class="n">field</span><span class="o">=</span><span class="n">field</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">myypos</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>

      <span class="c">#Create the meshgrid if required</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span>   <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>     
         <span class="n">lons</span><span class="o">=</span><span class="n">x</span>
         <span class="n">lats</span><span class="o">=</span><span class="n">y</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span>   <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>      
         <span class="n">lons</span><span class="o">=</span><span class="n">x</span>
         <span class="n">lats</span><span class="o">=</span><span class="n">y</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span>   <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
         <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">mymap</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>



      <span class="c">#Set the plot limits</span>
      <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&gt;</span> <span class="mi">350</span><span class="p">:</span>
         <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">user_mapset</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span> <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lons</span><span class="p">),</span> <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">lats</span><span class="p">),</span> <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>




      <span class="c">#Filled contours</span>
      <span class="k">if</span> <span class="n">fill</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">blockfill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - adding filled contours&#39;</span>
         <span class="c">#Get colour scale for use in contouring</span>
         <span class="c">#If colour bar extensions are enabled then the colour map goes</span>
         <span class="c">#from 1 to ncols-2.  The colours for the colour bar extensions are then </span>
         <span class="c">#changed on the colourbar and plot after the plot is made </span>
         <span class="n">cscale_ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
         <span class="n">colmap</span><span class="o">=</span><span class="n">cscale_get_map</span><span class="p">()</span>
  
         <span class="c">#filled colour contours</span>
         <span class="n">cfill</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span><span class="n">clevs</span><span class="p">,</span><span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>\
                 <span class="n">colors</span><span class="o">=</span><span class="n">colmap</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>


         <span class="c">#add colour scale extensions if required</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;min&#39;</span><span class="p">):</span>
            <span class="n">cfill</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span><span class="p">):</span>
            <span class="n">cfill</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">cscale_ncols</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>



      <span class="c">#Block fill</span>
      <span class="k">if</span> <span class="n">blockfill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - adding blockfill&#39;</span>
         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>  
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;lon&#39;</span><span class="p">),</span> <span class="s">&#39;hasbounds&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
               <span class="n">xpts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span>
               <span class="n">xpts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="c"># Add last longitude point</span>
               <span class="n">ypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[:,</span><span class="mi">0</span><span class="p">])</span> 
               <span class="n">ypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> <span class="c"># Add last latitude point</span>
               <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
            <span class="k">else</span><span class="p">:</span>
               <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  

         <span class="k">else</span><span class="p">:</span>
            <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  



      <span class="c">#Contour lines and labels  </span>
      <span class="k">if</span> <span class="n">lines</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> 
         <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - adding contour lines and labels&#39;</span>
         <span class="n">cs</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span><span class="n">clevs</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">line_labels</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">nd</span><span class="o">=</span><span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span>
            <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;%1.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;f&#39;</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">text_fontweight</span><span class="p">)</span> 

         <span class="c">#Thick zero contour line   </span>
         <span class="k">if</span> <span class="n">zero_thick</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">mymap</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,[</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span> 

      

      <span class="c">#axes</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;cyl&#39;</span><span class="p">:</span>      
         <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - adding cylindrical axes&#39;</span>
         <span class="n">lonticks</span><span class="p">,</span><span class="n">lonlabels</span><span class="o">=</span><span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
         <span class="n">latticks</span><span class="p">,</span><span class="n">latlabels</span><span class="o">=</span><span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
         <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">lonticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">lonlabels</span><span class="p">)</span>
         <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">)</span>
   
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;spstere&#39;</span><span class="p">:</span> 
         <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - adding stereograpic axes&#39;</span>
         <span class="n">latstep</span><span class="o">=</span><span class="mi">30</span>
         <span class="k">if</span> <span class="mi">90</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">:</span> <span class="n">latstep</span><span class="o">=</span><span class="mi">10</span>
         <span class="n">mymap</span><span class="o">.</span><span class="n">drawparallels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="n">latstep</span><span class="p">))</span>
         <span class="n">mymap</span><span class="o">.</span><span class="n">drawmeridians</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">360</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> 


      <span class="c">#Color bar</span>
      <span class="k">if</span> <span class="n">colorbar</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
         <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - adding colour bar&#39;</span>    
         <span class="n">pad</span><span class="o">=</span><span class="mf">0.10</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.15</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.20</span> 
         <span class="c">#cbar=plotvars.master_plot.colorbar(cfill, orientation=colorbar_orientation, aspect=75, \</span>
         <span class="c">#                                   pad=pad, ticks=colorbar_labels, drawedges=True, \</span>
         <span class="c">#                                   shrink=colorbar_shrink)</span>
         <span class="n">cbar</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cfill</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span>\
                                            <span class="n">orientation</span><span class="o">=</span><span class="n">colorbar_orientation</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span>\
                                            <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">)</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colorbar_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>
         <span class="c">#Bug in Matplotlib colorbar labelling</span>
         <span class="c">#With clevs=[-1, 1, 10000, 20000, 30000, 40000, 50000, 60000]</span>
         <span class="c">#Labels are [0, 2, 10001, 20001, 30001, 40001, 50001, 60001]</span>
         <span class="c">#With a +1 near to the colorbar label</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorbar_labels</span><span class="p">])</span> 
         
         <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span> 
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">text_fontsize</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">text_fontweight</span><span class="p">)</span>


      <span class="c">#Coastlines and title</span>
      <span class="n">mymap</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">continent_color</span><span class="p">)</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>


  
   <span class="c">########################</span>
   <span class="c"># Latitude-pressure plot</span>
   <span class="c">########################</span>
   <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - making a latitude-pressure plot&#39;</span>


      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

      <span class="c">#Set plot limits</span>
      <span class="c">#if [plotvars.xmin, plotvars.xmax, plotvars.ymin, plotvars.ymax].count(None) == 4:</span>
      <span class="n">user_gset</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>
      <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="c">#Program selected data plot limits</span>
         <span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">80</span> <span class="ow">and</span> <span class="n">xmin</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span> <span class="n">xmin</span><span class="o">=-</span><span class="mi">90</span>
         <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">90</span> 
         <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">ymin</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span>
         <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="c">#User specified plot limits</span>
         <span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
         <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">:</span> 
            <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
            <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>


      <span class="n">xstep</span><span class="o">=</span><span class="bp">None</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">==</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">==</span> <span class="mi">90</span><span class="p">):</span> <span class="n">xstep</span><span class="o">=</span><span class="mi">30</span>
      <span class="n">ystep</span><span class="o">=</span><span class="bp">None</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">):</span> <span class="n">ystep</span><span class="o">=</span><span class="mi">100</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">==</span> <span class="mi">100000</span><span class="p">):</span> <span class="n">ystep</span><span class="o">=</span><span class="mi">10000</span>

      <span class="n">ytype</span><span class="o">=</span><span class="mi">0</span> <span class="c">#pressure or similar y axis</span>
      <span class="k">if</span> <span class="s">&#39;theta&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">):</span> <span class="n">ytype</span><span class="o">=</span><span class="mi">1</span>
      <span class="k">if</span> <span class="s">&#39;height&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">):</span> 
         <span class="n">ytype</span><span class="o">=</span><span class="mi">1</span>
         <span class="n">ystep</span><span class="o">=</span><span class="mi">100</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span> <span class="n">ystep</span><span class="o">=</span><span class="mf">500.0</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span> <span class="n">ystep</span><span class="o">=</span><span class="mf">1000.0</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50000</span><span class="p">:</span> <span class="n">ystep</span><span class="o">=</span><span class="mf">10000.0</span>

      <span class="c">#Set plot limits and draw axes</span>
      <span class="k">if</span> <span class="n">ylog</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>   
         <span class="k">if</span> <span class="n">ytype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
            <span class="n">latticks</span><span class="p">,</span><span class="n">latlabels</span><span class="o">=</span><span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">,</span>\
                 <span class="n">yticks</span><span class="o">=</span><span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>\
                 <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span> 
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
            <span class="n">latticks</span><span class="p">,</span><span class="n">latlabels</span><span class="o">=</span><span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">,</span>\
                 <span class="n">yticks</span><span class="o">=</span><span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>\
                 <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>  

      <span class="c">#Log y axis </span>
      <span class="k">if</span> <span class="n">ylog</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">ymin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">1</span>
         <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
         <span class="n">latticks</span><span class="p">,</span><span class="n">latlabels</span><span class="o">=</span><span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
         <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">,</span>\
              <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>


      <span class="c">#Get colour scale for use in contouring</span>
      <span class="c">#If colour bar extensions are enabled then the colour map goes</span>
      <span class="c">#from 1 to ncols-2.  The colours for the colour bar extensions are then</span>
      <span class="c">#changed on the colourbar and plot after the plot is made</span>
      <span class="n">cscale_ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
      <span class="n">colmap</span><span class="o">=</span><span class="n">cscale_get_map</span><span class="p">()</span>


      <span class="c">#Filled contours</span>
      <span class="k">if</span> <span class="n">fill</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">blockfill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">cfill</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span><span class="n">clevs</span><span class="p">,</span> \
               <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colmap</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>

         <span class="c">#add colour scale extensions if required</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;min&#39;</span><span class="p">):</span>
            <span class="n">cfill</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span><span class="p">):</span>
            <span class="n">cfill</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">cscale_ncols</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  
      <span class="c">#Block fill</span>
      <span class="k">if</span> <span class="n">blockfill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   
         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>  
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;lat&#39;</span><span class="p">),</span> <span class="s">&#39;hasbounds&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
               <span class="n">xpts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
               <span class="n">ypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;pressure&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>   
               <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
            <span class="k">else</span><span class="p">:</span>
               <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  

         <span class="k">else</span><span class="p">:</span>
            <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
 


      <span class="c">#Contour lines and labels</span>
      <span class="k">if</span> <span class="n">lines</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> 
         <span class="n">cs</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span><span class="n">clevs</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">line_labels</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>  
            <span class="n">nd</span><span class="o">=</span><span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span>
            <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;%1.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;f&#39;</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">text_fontweight</span><span class="p">)</span> 

            <span class="c">#Thick zero contour line</span>
            <span class="k">if</span> <span class="n">zero_thick</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
               <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,[</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span><span class="n">colors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
     
  

      <span class="c">#Colorbar</span>
      <span class="k">if</span> <span class="n">colorbar</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  

         <span class="n">pad</span><span class="o">=</span><span class="mf">0.15</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.25</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span>
         <span class="n">cbar</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cfill</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">colorbar_orientation</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> \
                                            <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span> \
                                            <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">)</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colorbar_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorbar_labels</span><span class="p">])</span> <span class="c">#Bug in Matplotlib colorbar labelling</span>
         <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">text_fontsize</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">text_fontweight</span><span class="p">)</span>

      <span class="c">#Title</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>



   <span class="c">########################</span>
   <span class="c"># Longitude-pressure plot</span>
   <span class="c">########################</span>
   <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - making a longitude-pressure plot&#39;</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
      <span class="n">user_gset</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>

      <span class="c">#Set plot limits</span>
      <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="c">#Program selected data plot limits</span>
         <span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">170</span> <span class="ow">and</span> <span class="n">xmin</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">180</span><span class="p">:</span> <span class="n">xmin</span><span class="o">=-</span><span class="mi">180</span>
         <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="mi">170</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">180</span> 
         <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">ymin</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span>
         <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="c">#User specified plot limits</span>
         <span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
         <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">:</span> 
            <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
            <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>

      <span class="n">xstep</span><span class="o">=</span><span class="bp">None</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">==</span> <span class="o">-</span><span class="mi">180</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">==</span> <span class="mi">180</span><span class="p">):</span> <span class="n">xstep</span><span class="o">=</span><span class="mi">60</span>
      <span class="n">ystep</span><span class="o">=</span><span class="bp">None</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">):</span> <span class="n">ystep</span><span class="o">=</span><span class="mi">100</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">==</span> <span class="mi">100000</span><span class="p">):</span> <span class="n">ystep</span><span class="o">=</span><span class="mi">10000</span>

      <span class="n">ytype</span><span class="o">=</span><span class="mi">0</span> <span class="c">#pressure or similar y axis</span>
      <span class="k">if</span> <span class="s">&#39;theta&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">):</span> <span class="n">ytype</span><span class="o">=</span><span class="mi">1</span>
      <span class="k">if</span> <span class="s">&#39;height&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">):</span> 
         <span class="n">ytype</span><span class="o">=</span><span class="mi">1</span>
         <span class="n">ystep</span><span class="o">=</span><span class="mi">100</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span> <span class="n">ystep</span><span class="o">=</span><span class="mf">500.0</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span> <span class="n">ystep</span><span class="o">=</span><span class="mf">1000.0</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50000</span><span class="p">:</span> <span class="n">ystep</span><span class="o">=</span><span class="mf">10000.0</span>

      <span class="c">#Set plot limits and draw axes</span>
      <span class="n">lonticks</span><span class="p">,</span><span class="n">lonlabels</span><span class="o">=</span><span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">ylog</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>   
         <span class="k">if</span> <span class="n">ytype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>         
            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">lonticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">lonlabels</span><span class="p">,</span>\
                 <span class="n">yticks</span><span class="o">=</span><span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>\
                 <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span> 
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">lonticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">lonlabels</span><span class="p">,</span>\
                 <span class="n">yticks</span><span class="o">=</span><span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>\
                 <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>  

      <span class="c">#Log y axis </span>
      <span class="k">if</span> <span class="n">ylog</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">ymin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">1</span>
         <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
         <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">lonticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">lonlabels</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>

      <span class="c">#Get colour scale for use in contouring</span>
      <span class="c">#If colour bar extensions are enabled then the colour map goes</span>
      <span class="c">#from 1 to ncols-2.  The colours for the colour bar extensions are then</span>
      <span class="c">#changed on the colourbar and plot after the plot is made</span>
      <span class="n">cscale_ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
      <span class="n">colmap</span><span class="o">=</span><span class="n">cscale_get_map</span><span class="p">()</span>


      <span class="c">#Filled contours</span>
      <span class="k">if</span> <span class="n">fill</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">blockfill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">cfill</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span><span class="n">clevs</span><span class="p">,</span> \
               <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colmap</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>

         <span class="c">#add colour scale extensions if required</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;min&#39;</span><span class="p">):</span>
            <span class="n">cfill</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span><span class="p">):</span>
            <span class="n">cfill</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">cscale_ncols</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  
      <span class="c">#Block fill</span>
      <span class="k">if</span> <span class="n">blockfill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   
         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>  
            <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;lat&#39;</span><span class="p">),</span> <span class="s">&#39;hasbounds&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">):</span>
               <span class="n">xpts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
               <span class="n">ypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;pressure&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>   
               <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
            <span class="k">else</span><span class="p">:</span>
               <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  

         <span class="k">else</span><span class="p">:</span>
            <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
 


      <span class="c">#Contour lines and labels</span>
      <span class="k">if</span> <span class="n">lines</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> 
         <span class="n">cs</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span><span class="n">clevs</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">line_labels</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>  
            <span class="n">nd</span><span class="o">=</span><span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span>
            <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;%1.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;f&#39;</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">text_fontweight</span><span class="p">)</span> 

            <span class="c">#Thick zero contour line</span>
            <span class="k">if</span> <span class="n">zero_thick</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
               <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,[</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span><span class="n">colors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
     
  

      <span class="c">#Colorbar</span>
      <span class="k">if</span> <span class="n">colorbar</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  

         <span class="n">pad</span><span class="o">=</span><span class="mf">0.15</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.25</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span>
         <span class="n">cbar</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cfill</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">colorbar_orientation</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> \
                                            <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span> \
                                            <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">)</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colorbar_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorbar_labels</span><span class="p">])</span> <span class="c">#Bug in Matplotlib colorbar labelling</span>
         <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">text_fontsize</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">text_fontweight</span><span class="p">)</span>

      <span class="c">#Title</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>




   <span class="c">#################</span>
   <span class="c"># Hovmuller plots</span>
   <span class="c">#################</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">or</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">):</span> 
      <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - making a Hovmuller plot&#39;</span>
      <span class="n">ylabel</span><span class="o">=</span><span class="s">&#39;Time&#39;</span>
      <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">&#39;Longitude&#39;</span>
      <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> <span class="n">xlabel</span><span class="o">=</span><span class="s">&#39;Latitude&#39;</span>
      <span class="n">user_gset</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>

      <span class="n">ref_time</span><span class="o">=</span><span class="n">time_opts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">ref_calendar</span><span class="o">=</span><span class="n">time_opts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">ref_time_origin</span><span class="o">=</span><span class="n">time_opts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>


      <span class="c">#Time strings set to None initially</span>
      <span class="n">tmin</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">tmax</span><span class="o">=</span><span class="bp">None</span>
      <span class="c">#Set plot limits</span>
      <span class="k">if</span> <span class="p">[</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>

         <span class="c">#Store time strings for later use</span>
         <span class="n">tmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
         <span class="n">tmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

         <span class="c">#Change from date string in ymin and ymax to date as a float</span>
         <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>
         <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
         <span class="n">ymin</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">array</span>
         <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>
         <span class="n">ymax</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">array</span>
         <span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
         <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
         <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
         <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
         <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>



      <span class="c">#Set plot limits</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
      <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>

      <span class="c">#Revert to time strings if set</span>
      <span class="k">if</span> <span class="p">[</span><span class="n">tmin</span><span class="p">,</span> <span class="n">tmax</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="o">=</span><span class="n">tmin</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="o">=</span><span class="n">tmax</span>
 
      <span class="n">time_units</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Units</span><span class="p">(</span><span class="n">ref_time</span><span class="p">,</span> <span class="n">ref_calendar</span><span class="p">)</span>
      <span class="c">#t = cf.Data(cf.dt(ref_time_origin), units=time_units)</span>
      <span class="n">t</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">cf</span><span class="o">.</span><span class="n">dt</span><span class="p">(</span><span class="s">&#39;1980-1-1&#39;</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="n">time_units</span><span class="p">)</span>

      <span class="n">times</span><span class="o">=</span><span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">T</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="n">times</span><span class="p">,</span> <span class="n">units</span><span class="o">=</span><span class="n">t</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span>
      <span class="n">time_ticks</span><span class="o">=</span><span class="n">T</span><span class="o">.</span><span class="n">array</span>
      <span class="n">time_tick_labels</span><span class="o">=</span><span class="n">T</span><span class="o">.</span><span class="n">year</span><span class="o">.</span><span class="n">array</span>

      <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span> <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span> <span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

      <span class="c">#Draw axes</span>
      <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span><span class="p">,</span>\
           <span class="n">yticks</span><span class="o">=</span><span class="n">time_ticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">time_tick_labels</span><span class="p">,</span>\
           <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>


      <span class="c">#Get colour scale for use in contouring</span>
      <span class="c">#If colour bar extensions are enabled then the colour map goes</span>
      <span class="c">#from 1 to ncols-2.  The colours for the colour bar extensions are then</span>
      <span class="c">#changed on the colourbar and plot after the plot is made</span>
      <span class="n">cscale_ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
      <span class="n">colmap</span><span class="o">=</span><span class="n">cscale_get_map</span><span class="p">()</span>


      <span class="c">#Filled contours</span>
      <span class="k">if</span> <span class="n">fill</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">blockfill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">cfill</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span><span class="n">clevs</span><span class="p">,</span> \
               <span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="n">colmap</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>

         <span class="c">#add colour scale extensions if required</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;min&#39;</span><span class="p">):</span>
            <span class="n">cfill</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span><span class="p">):</span>
            <span class="n">cfill</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">cscale_ncols</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
  
      <span class="c">#Block fill</span>
      <span class="k">if</span> <span class="n">blockfill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   
         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>  
            <span class="k">if</span> <span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;lon&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hasbounds</span><span class="p">:</span>
               <span class="n">xpts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;lat&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>
               <span class="n">ypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">coord</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">bounds</span><span class="o">.</span><span class="n">array</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">]</span>   
               <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  
            <span class="k">else</span><span class="p">:</span>
               <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  

         <span class="k">else</span><span class="p">:</span>
            <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
 


      <span class="c">#Contour lines and labels</span>
      <span class="k">if</span> <span class="n">lines</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span> 
         <span class="n">cs</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span><span class="n">clevs</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">line_labels</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>  
            <span class="n">nd</span><span class="o">=</span><span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span>
            <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;%1.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;f&#39;</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">text_fontweight</span><span class="p">)</span> 

            <span class="c">#Thick zero contour line</span>
            <span class="k">if</span> <span class="n">zero_thick</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
               <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,[</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span><span class="n">colors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
     


      <span class="c">#Colorbar</span>
      <span class="k">if</span> <span class="n">colorbar</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  

         <span class="n">pad</span><span class="o">=</span><span class="mf">0.15</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.25</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span>
         <span class="n">cbar</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cfill</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">colorbar_orientation</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> \
                                            <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span> \
                                            <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">)</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colorbar_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorbar_labels</span><span class="p">])</span> <span class="c">#Bug in Matplotlib colorbar labelling</span>
         <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">text_fontsize</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">text_fontweight</span><span class="p">)</span>

      <span class="c">#Title</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>




   <span class="c">#############</span>
   <span class="c">#Rotated pole</span>
   <span class="c">#############</span>
   <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span> 
      <span class="c">#Rotated pole plots use a regularly spaced grid</span>
      <span class="c">#The x and y points from the data are used to make the rotated axes</span>
      <span class="n">xpts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
      <span class="n">ypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>

      <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - making a rotated pole plot&#39;</span>
      <span class="n">user_gset</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

      <span class="c">#Set plot limits </span>
      <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>


      <span class="c">#Get colour scale for use in contouring</span>
      <span class="c">#If colour bar extensions are enabled then the colour map goes</span>
      <span class="c">#from 1 to ncols-2.  The colours for the colour bar extensions are then</span>
      <span class="c">#changed on the colourbar and plot after the plot is made</span>
      <span class="n">cscale_ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
      <span class="n">colmap</span><span class="o">=</span><span class="n">cscale_get_map</span><span class="p">()</span>


      <span class="c">#Filled contours</span>
      <span class="k">if</span> <span class="n">fill</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">blockfill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">cfill</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span><span class="n">ypts</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span><span class="n">clevs</span><span class="p">,</span><span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>\
               <span class="n">colors</span><span class="o">=</span><span class="n">colmap</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>

         <span class="c">#add colour scale extensions if required</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;min&#39;</span><span class="p">):</span>
             <span class="n">cfill</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span><span class="p">):</span>
             <span class="n">cfill</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">cscale_ncols</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>


      <span class="c">#Block fill</span>
      <span class="k">if</span> <span class="n">blockfill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  
         <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
 

      <span class="c">#Contour lines and labels </span>
      <span class="k">if</span> <span class="n">lines</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
         <span class="n">cs</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span><span class="n">ypts</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span><span class="n">clevs</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">line_labels</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>     
            <span class="n">nd</span><span class="o">=</span><span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span>
            <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;%1.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;f&#39;</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">text_fontweight</span><span class="p">)</span> 
   
         <span class="c">#Thick zero contour line</span>
         <span class="k">if</span> <span class="n">zero_thick</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span><span class="n">ypts</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,[</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span><span class="n">colors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>


      <span class="c">#Colorbar</span>
      <span class="k">if</span> <span class="n">colorbar</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>     

         <span class="n">pad</span><span class="o">=</span><span class="mf">0.15</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.25</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span>
         <span class="n">cbar</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cfill</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">colorbar_orientation</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> \
                                            <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span> \
                                            <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">)</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colorbar_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorbar_labels</span><span class="p">])</span> <span class="c">#Bug in Matplotlib colorbar labelling</span>
         <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">text_fontsize</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">text_fontweight</span><span class="p">)</span>

      <span class="c">#Rotated grid axes</span>
      <span class="n">rgaxes</span><span class="p">(</span><span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>


      <span class="c">#Title</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>





   <span class="c">############</span>
   <span class="c">#Other plots</span>
   <span class="c">############</span>
   <span class="k">if</span> <span class="n">ptype</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
      <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - making an other plot&#39;</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
      <span class="n">user_gset</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>

      <span class="c">#Work out axes if none are supplied</span>
      <span class="k">if</span> <span class="p">[</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
         <span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
         <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
         <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
         <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
         <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
         <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
         <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>

      <span class="n">xstep</span><span class="o">=</span><span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span>
      <span class="n">ystep</span><span class="o">=</span><span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span>

      <span class="c">#Set plot limits and draw axes</span>
      <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>    
         
      
      <span class="n">xticks</span><span class="o">=</span><span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">ymin</span> <span class="o">&lt;</span> <span class="n">ymax</span><span class="p">:</span> <span class="n">yticks</span><span class="o">=</span><span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">ymax</span> <span class="o">&lt;</span> <span class="n">ymin</span><span class="p">:</span> <span class="n">yticks</span><span class="o">=</span><span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="p">(</span><span class="n">ymin</span><span class="o">-</span><span class="n">ymax</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>


      <span class="c">#Get colour scale for use in contouring</span>
      <span class="c">#If colour bar extensions are enabled then the colour map goes</span>
      <span class="c">#from 1 to ncols-2.  The colours for the colour bar extensions are then</span>
      <span class="c">#changed on the colourbar and plot after the plot is made</span>
      <span class="n">cscale_ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
      <span class="n">colmap</span><span class="o">=</span><span class="n">cscale_get_map</span><span class="p">()</span>


      <span class="c">#Filled contours</span>
      <span class="k">if</span> <span class="n">fill</span> <span class="o">==</span> <span class="bp">True</span> <span class="ow">or</span> <span class="n">blockfill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">cfill</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span><span class="n">clevs</span><span class="p">,</span><span class="n">extend</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="p">,</span>\
               <span class="n">colors</span><span class="o">=</span><span class="n">colmap</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>

         <span class="c">#add colour scale extensions if required</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;min&#39;</span><span class="p">):</span>
             <span class="n">cfill</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span><span class="p">):</span>
             <span class="n">cfill</span><span class="o">.</span><span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">cscale_ncols</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>


      <span class="c">#Block fill</span>
      <span class="k">if</span> <span class="n">blockfill</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  
         <span class="n">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field_orig</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x_orig</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_orig</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="n">clevs</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  
 

      <span class="c">#Contour lines and labels </span>
      <span class="k">if</span> <span class="n">lines</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>
         <span class="n">cs</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,</span><span class="n">clevs</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">line_labels</span> <span class="o">==</span> <span class="bp">True</span><span class="p">:</span>     
            <span class="n">nd</span><span class="o">=</span><span class="n">ndecs</span><span class="p">(</span><span class="n">clevs</span><span class="p">)</span>
            <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span>
            <span class="k">if</span> <span class="n">nd</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;%1.&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">nd</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;f&#39;</span>
            <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">clabel</span><span class="p">(</span><span class="n">cs</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="n">fmt</span><span class="p">,</span> <span class="n">colors</span> <span class="o">=</span> <span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">text_fontweight</span><span class="p">)</span> 
   
         <span class="c">#Thick zero contour line</span>
         <span class="k">if</span> <span class="n">zero_thick</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">cs</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">field</span><span class="o">*</span><span class="n">fmult</span><span class="p">,[</span><span class="mf">1e-32</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span><span class="n">colors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="n">zero_thick</span><span class="p">,</span> <span class="n">tri</span><span class="o">=</span><span class="n">tri</span><span class="p">)</span>


      <span class="c">#Colorbar</span>
      <span class="k">if</span> <span class="n">colorbar</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>     

         <span class="n">pad</span><span class="o">=</span><span class="mf">0.15</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.25</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">:</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.3</span>
         <span class="n">cbar</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cfill</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="n">colorbar_orientation</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">75</span><span class="p">,</span> \
                                            <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="n">colorbar_labels</span><span class="p">,</span> \
                                            <span class="n">shrink</span><span class="o">=</span><span class="n">colorbar_shrink</span><span class="p">)</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">colorbar_title</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">text_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>
         <span class="n">cbar</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">colorbar_labels</span><span class="p">])</span> <span class="c">#Bug in Matplotlib colorbar labelling</span>
         <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">():</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">text_fontsize</span><span class="p">)</span>
            <span class="n">t</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">text_fontweight</span><span class="p">)</span>

      <span class="c">#Title</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>




   <span class="c">##################</span>
   <span class="c">#Save or view plot</span>
   <span class="c">##################</span>

   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>       
      <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;con - saving or viewing plot&#39;</span>
      <span class="c">#gset(user_gset=0)</span>
      <span class="n">gclose</span><span class="p">()</span>
  



</div>
<div class="viewcode-block" id="mapset"><a class="viewcode-back" href="../mapset.html#cfplot.mapset">[docs]</a><span class="k">def</span> <span class="nf">mapset</span><span class="p">(</span><span class="n">lonmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lonmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">latmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">latmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">proj</span><span class="o">=</span><span class="s">&#39;cyl&#39;</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
           <span class="n">lon_0</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="s">&#39;c&#39;</span><span class="p">,</span> <span class="n">user_mapset</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | mapset sets the mapping parameters.</span>
<span class="sd">    |</span>
<span class="sd">    | lonmin=lonmin - minimum longitude</span>
<span class="sd">    | lonmax=lonmax - maximum longitude</span>
<span class="sd">    | latmin=latmin - minimum latitude</span>
<span class="sd">    | latmax=latmax - maximum latitude</span>
<span class="sd">    | proj=proj - &#39;cyl&#39; for cylindrical projection. &#39;npstere&#39; or &#39;spstere&#39; for northern </span>
<span class="sd">    |      hemisphere or southern hemisphere polar stereographic projection</span>
<span class="sd">    |      &#39;moll&#39; for the mollweide projection</span>
<span class="sd">    | boundinglat=boundinglat - edge of the viewable latitudes in a stereographic plot</span>
<span class="sd">    | lon_0=lon_0 - centre of desired map domain in stereographic or   plots</span>
<span class="sd">    | resolution=resolution - the map resolution - can be one of &#39;c&#39; (crude), &#39;l&#39; (low), </span>
<span class="sd">    |      &#39;i&#39; (intermediate), &#39;h&#39; (high), &#39;f&#39; (full) or &#39;None&#39;</span>
<span class="sd">    | user_mapset=user_mapset - variable to indicate whether a user call to mapset has been </span>
<span class="sd">    |             made. </span>
<span class="sd">    |</span>
<span class="sd">    | The default map plotting projection is the cyclindrical equidistant projection from </span>
<span class="sd">    | -180 to 180 in longitude and -90 to 90 in latitude. To change the map view in this </span>
<span class="sd">    | projection to over the United Kingdom, for example, you would use</span>
<span class="sd">    | mapset(lonmin=-6, lonmax=3, latmin=50, latmax=60) or mapset(-6, 3, 50, 60).</span>
<span class="sd">    |</span>
<span class="sd">    | The limits are -360 to 720 in longitude so to look at the equatorial Pacific you </span>
<span class="sd">    | could use</span>
<span class="sd">    | mapset(lonmin=90, lonmax=300, latmin=-30, latmax=30)</span>
<span class="sd">    | or</span>
<span class="sd">    | mapset(lonmin=-270, lonmax=-60, latmin=-30, latmax=30)</span>
<span class="sd">    |</span>
<span class="sd">    | The proj parameter for the present accepts just two values - &#39;npstere&#39; and &#39;spstere&#39; </span>
<span class="sd">    | for northern hemisphere or southern hemisphere polar stereographic projections. In </span>
<span class="sd">    | addition to these the boundinglat parameter sets the edge of the viewable latitudes</span>
<span class="sd">    | and lat_0 sets the centre of desired map domain.</span>
<span class="sd">    |</span>
<span class="sd">    | Map settings are persistent until a new call to mapset is made. To reset to the default</span>
<span class="sd">    | map settings use mapset().</span>

<span class="sd">    :Returns:</span>
<span class="sd">     None</span>
<span class="sd">   &quot;&quot;&quot;</span>


   <span class="k">if</span> <span class="p">[</span><span class="n">lonmin</span><span class="p">,</span><span class="n">lonmax</span><span class="p">,</span><span class="n">latmin</span><span class="p">,</span><span class="n">latmax</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span> <span class="ow">and</span> <span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;cyl&#39;</span><span class="p">:</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="o">=-</span><span class="mi">180</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="o">=</span><span class="mi">180</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="o">=-</span><span class="mi">90</span> 
      <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="o">=</span><span class="mi">90</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span><span class="o">=</span><span class="s">&#39;cyl&#39;</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span><span class="o">=</span><span class="mi">0</span>
      <span class="k">return</span>


   <span class="k">if</span> <span class="n">lonmin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">lonmin</span><span class="o">=-</span><span class="mi">180</span>
   <span class="k">if</span> <span class="n">lonmax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">lonmax</span><span class="o">=</span><span class="mi">180</span>
   <span class="k">if</span> <span class="n">latmin</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">latmin</span><span class="o">=-</span><span class="mi">90</span>
   <span class="k">if</span> <span class="n">latmax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">latmax</span><span class="o">=</span><span class="mi">90</span>

   <span class="k">if</span> <span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;moll&#39;</span><span class="p">:</span>
      <span class="n">lonmin</span><span class="o">=</span><span class="n">lon_0</span><span class="o">-</span><span class="mi">180</span>
      <span class="n">lonmax</span><span class="o">=</span><span class="n">lon_0</span><span class="o">+</span><span class="mi">180</span>


   <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="o">=</span><span class="n">lonmin</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="o">=</span><span class="n">lonmax</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="o">=</span><span class="n">latmin</span> 
   <span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="o">=</span><span class="n">latmax</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span><span class="o">=</span><span class="n">proj</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="o">=</span><span class="n">boundinglat</span> 
   <span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="o">=</span><span class="n">lon_0</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span> 
   <span class="n">plotvars</span><span class="o">.</span><span class="n">user_mapset</span><span class="o">=</span><span class="n">user_mapset</span>
   <span class="n">set_map</span><span class="p">()</span>   



  
</div>
<div class="viewcode-block" id="levs"><a class="viewcode-back" href="../levs.html#cfplot.levs">[docs]</a><span class="k">def</span> <span class="nf">levs</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">step</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">manual</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">extend</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    | The levs command manually sets the contour levels.</span>

<span class="sd">    | min=min - minimum level</span>
<span class="sd">    | max=max - maximum level</span>
<span class="sd">    | step=step - step between levels</span>
<span class="sd">    | manual= manual - set levels manually</span>
<span class="sd">    | extend=&#39;neither&#39;, &#39;both&#39;, &#39;min&#39;, or &#39;max&#39; - colour bar limit extensions.</span>

<span class="sd">    | Use the levs command when a predefined set of levels is required. The min, max </span>
<span class="sd">    | and step parameters are all needed to define a set of  levels. These can take </span>
<span class="sd">    | integer or floating point numbers. If colour filled contours are plotted then </span>
<span class="sd">    | the default is to extend the minimum and maximum contours coloured for out of </span>
<span class="sd">    | range values - extend=&#39;both&#39;.</span>

<span class="sd">    | Once a user call is made to levs the levels are persistent.  i.e. the next plot</span>
<span class="sd">    | will use the same set of levels.</span>
<span class="sd">    | Use levs() to reset to undefined levels.</span>

<span class="sd">    :Returns:</span>
<span class="sd">     None</span>

<span class="sd">   &quot;&quot;&quot;</span> 

   <span class="k">if</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span><span class="n">step</span><span class="p">,</span><span class="n">manual</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_min</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_max</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span><span class="o">=</span><span class="bp">None</span> 
      <span class="n">plotvars</span><span class="o">.</span><span class="n">extend</span><span class="o">=</span><span class="s">&#39;both&#39;</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span><span class="o">=</span><span class="mi">0</span>
      <span class="k">return</span>   

   <span class="k">if</span> <span class="n">manual</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="o">=</span><span class="n">manual</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_min</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_max</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span><span class="o">=</span><span class="mi">1</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span><span class="nb">max</span><span class="p">,</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
         <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n\</span>
<span class="s">                 levs error</span><span class="se">\n\</span>
<span class="s">                 min, max and step or manual need to be passed to levs to generate </span><span class="se">\n\</span>
<span class="s">                 a set of contour levels</span><span class="se">\</span>
<span class="s">                 </span><span class="se">\n</span><span class="s">&#39;</span>
              
         <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_min</span><span class="o">=</span><span class="nb">min</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_max</span><span class="o">=</span><span class="nb">max</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_step</span><span class="o">=</span><span class="n">step</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="o">+</span><span class="n">step</span><span class="p">,</span> <span class="n">step</span><span class="p">)</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">user_levs</span><span class="o">=</span><span class="mi">1</span>

   <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span><span class="o">=</span><span class="n">extend</span>


</div>
<div class="viewcode-block" id="mapaxis"><a class="viewcode-back" href="../mapaxis.html#cfplot.mapaxis">[docs]</a><span class="k">def</span> <span class="nf">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="nb">max</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">type</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    | mapaxis is used to work out a sensible set of longitude and latitude </span>
<span class="sd">    | tick marks and labels.  This is an internal routine and is not used </span>
<span class="sd">    | by the user.</span>

<span class="sd">    | min=min - minimum axis value</span>
<span class="sd">    | max=max - maximum axis value</span>
<span class="sd">    | type=type - 1 = longitude, 2 = latitude</span>
<span class="sd">  </span>
<span class="sd">    :Returns:</span>
<span class="sd">     longtitude/latitude ticks and longitude/latitude tick labels</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span> 

   <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
   <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">lonmin</span><span class="o">=</span><span class="nb">min</span>
      <span class="n">lonmax</span><span class="o">=</span><span class="nb">max</span>
      <span class="n">lonrange</span><span class="o">=</span><span class="n">lonmax</span><span class="o">-</span><span class="n">lonmin</span>
      <span class="n">lonstep</span><span class="o">=</span><span class="mi">60</span>
      <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">180</span><span class="p">:</span> <span class="n">lonstep</span><span class="o">=</span><span class="mi">30</span>
      <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span> <span class="n">lonstep</span><span class="o">=</span><span class="mi">10</span>
      <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span> <span class="n">lonstep</span><span class="o">=</span><span class="mi">5</span>
      <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span> <span class="n">lonstep</span><span class="o">=</span><span class="mi">2</span>
      <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span> <span class="n">lonstep</span><span class="o">=</span><span class="mi">1</span>      
      <span class="c">#if plotvars.xstep is not None: lonstep=plotvars.xstep</span>
     
      <span class="n">lons</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">720</span><span class="p">,</span> <span class="mi">720</span><span class="o">+</span><span class="n">lonstep</span><span class="p">,</span> <span class="n">lonstep</span><span class="p">)</span>
      <span class="n">lonticks</span><span class="o">=</span><span class="p">[]</span>
      <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;=</span> <span class="n">lonmin</span> <span class="ow">and</span> <span class="n">lon</span> <span class="o">&lt;=</span> <span class="n">lonmax</span><span class="p">:</span> <span class="n">lonticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
     
      <span class="n">lonlabels</span><span class="o">=</span><span class="p">[]</span>
      <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lonticks</span><span class="p">:</span>
         <span class="n">lon2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">lon</span> <span class="o">+</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">360</span><span class="p">)</span> <span class="o">-</span> <span class="mi">180</span>
         <span class="k">if</span> <span class="n">lon2</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lon2</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">180</span><span class="p">:</span> <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lon2</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;W&#39;</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">lon2</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">lon2</span> <span class="o">&lt;</span> <span class="mi">180</span><span class="p">:</span> <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lon2</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;E&#39;</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">lon2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lon2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">180</span><span class="p">:</span> <span class="n">lonlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;180&#39;</span><span class="p">)</span>
          
      <span class="k">return</span><span class="p">(</span><span class="n">lonticks</span><span class="p">,</span> <span class="n">lonlabels</span><span class="p">)</span> 
    
   <span class="k">if</span> <span class="nb">type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">latmin</span><span class="o">=</span><span class="nb">min</span>
      <span class="n">latmax</span><span class="o">=</span><span class="nb">max</span>
      <span class="n">latrange</span><span class="o">=</span><span class="n">latmax</span><span class="o">-</span><span class="n">latmin</span>
      <span class="n">latstep</span><span class="o">=</span><span class="mi">30</span>
      <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span> <span class="n">latstep</span><span class="o">=</span><span class="mi">10</span>  
      <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">30</span><span class="p">:</span> <span class="n">latstep</span><span class="o">=</span><span class="mi">5</span>   
      <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span> <span class="n">latstep</span><span class="o">=</span><span class="mi">2</span>
      <span class="k">if</span> <span class="n">latrange</span> <span class="o">&lt;=</span> <span class="mi">5</span><span class="p">:</span> <span class="n">latstep</span><span class="o">=</span><span class="mi">1</span>  
      <span class="c">#if plotvars.ystep is not None: latstep=plotvars.ystep</span>
    
      <span class="n">lats</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="mi">90</span><span class="o">+</span><span class="n">latstep</span><span class="p">,</span> <span class="n">latstep</span><span class="p">)</span>
      <span class="n">latticks</span><span class="o">=</span><span class="p">[]</span>
      <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;=</span> <span class="n">latmin</span> <span class="ow">and</span> <span class="n">lat</span> <span class="o">&lt;=</span> <span class="n">latmax</span><span class="p">:</span> <span class="n">latticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>   


      <span class="n">latlabels</span><span class="o">=</span><span class="p">[]</span>
      <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">latticks</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">latlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;S&#39;</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span> <span class="n">latlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;N&#39;</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">lat</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">latlabels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">)</span>
     
      <span class="k">return</span><span class="p">(</span><span class="n">latticks</span><span class="p">,</span> <span class="n">latlabels</span><span class="p">)</span> 



</div>
<div class="viewcode-block" id="ndecs"><a class="viewcode-back" href="../ndecs.html#cfplot.ndecs">[docs]</a><span class="k">def</span> <span class="nf">ndecs</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">   | ndecs finds the number of decimal places in an array.  Needed to make the </span>
<span class="sd">   | colour bar match the contour line labelling.</span>

<span class="sd">   | data=data - imput array of values</span>

<span class="sd">   :Returns:</span>
<span class="sd">   |  maximum number of necimal places</span>
<span class="sd">   | </span>
<span class="sd">   | </span>
<span class="sd">   | </span>
<span class="sd">   | </span>
<span class="sd">   | </span>
<span class="sd">   | </span>
<span class="sd">   | </span>
<span class="sd">   | </span>
<span class="sd">   &quot;&quot;&quot;</span>

   <span class="n">maxdecs</span><span class="o">=</span><span class="mi">0</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)):</span>
      <span class="n">number</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">a</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;.&#39;</span><span class="p">)</span>  
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> 
         <span class="n">number_decs</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
         <span class="k">if</span> <span class="n">number_decs</span> <span class="o">&gt;</span> <span class="n">maxdecs</span><span class="p">:</span> <span class="n">maxdecs</span><span class="o">=</span><span class="n">number_decs</span>
  
   <span class="k">return</span> <span class="n">maxdecs</span>

</div>
<div class="viewcode-block" id="axes"><a class="viewcode-back" href="../axes.html#cfplot.axes">[docs]</a><span class="k">def</span> <span class="nf">axes</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>\
         <span class="n">xstep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ystep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>	  
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | axes is a function to set axes plotting parameters. The xstep and ystep </span>
<span class="sd">    | parameters are used to label the axes starting at the left hand side and </span>
<span class="sd">    | bottom of the plot respectively. For tighter control over labelling use </span>
<span class="sd">    | xticks, yticks to specify the tick positions and xticklabels, yticklabels </span>
<span class="sd">    | to specify the associated labels.</span>

<span class="sd">    | xstep=xstep - x axis step </span>
<span class="sd">    | ystep=ystep - y axis step </span>
<span class="sd">    | xlabel=xlabel - label for the x-axis </span>
<span class="sd">    | ylabel=ylabel - label for the y-axis </span>
<span class="sd">    | xticks=xticks - values for x ticks </span>
<span class="sd">    | xticklabels=xticklabels - labels for x tick marks </span>
<span class="sd">    | yticks=yticks - values for y ticks </span>
<span class="sd">    | yticklabels=yticklabels - labels for y tick marks </span>
<span class="sd">    | title=None - set title</span>
<span class="sd">    |</span>
<span class="sd">    | Use axes() to reset all the axes plotting attributes to the default.</span>

<span class="sd">    :Returns:</span>
<span class="sd">     None</span>
<span class="sd">   &quot;&quot;&quot;</span> 
     
   <span class="k">if</span> <span class="p">[</span><span class="n">xticks</span><span class="p">,</span><span class="n">yticks</span><span class="p">,</span><span class="n">xticklabels</span><span class="p">,</span><span class="n">yticklabels</span><span class="p">,</span><span class="n">xstep</span><span class="p">,</span><span class="n">ystep</span><span class="p">,</span><span class="n">xlabel</span><span class="p">,</span><span class="n">ylabel</span><span class="p">,</span><span class="n">title</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">9</span><span class="p">:</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">xstep</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">ystep</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="bp">None</span>
      <span class="k">return</span>

   <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span><span class="o">=</span><span class="n">xticks</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span><span class="o">=</span><span class="n">yticks</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span><span class="o">=</span><span class="n">xticklabels</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span><span class="o">=</span><span class="n">yticklabels</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">xstep</span><span class="o">=</span><span class="n">xstep</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">ystep</span><span class="o">=</span><span class="n">ystep</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span><span class="o">=</span><span class="n">title</span>


</div>
<span class="k">def</span> <span class="nf">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticks</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>\
         <span class="n">xstep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ystep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>	    
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | axes_plot is a system function to specify axes plotting parameters. The xstep and ystep </span>
<span class="sd">    | parameters are used to label the axes starting at the left hand side and </span>
<span class="sd">    | bottom of the plot respectively. For tighter control over labelling use </span>
<span class="sd">    | xticks, yticks to specify the tick positions and xticklabels, yticklabels </span>
<span class="sd">    | to specify the associated labels.</span>

<span class="sd">    | xstep=xstep - x axis step </span>
<span class="sd">    | ystep=ystep - y axis step </span>
<span class="sd">    | xlabel=xlabel - label for the x-axis </span>
<span class="sd">    | ylabel=ylabel - label for the y-axis </span>
<span class="sd">    | xticks=xticks - values for x ticks </span>
<span class="sd">    | xticklabels=xticklabels - labels for x tick marks </span>
<span class="sd">    | yticks=yticks - values for y ticks </span>
<span class="sd">    | yticklabels=yticklabels - labels for y tick marks </span>
<span class="sd">    | title=None - set title</span>
<span class="sd">    |</span>

<span class="sd">    :Returns:</span>
<span class="sd">     None</span>
<span class="sd">   &quot;&quot;&quot;</span> 

   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span>
      <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span>
      <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span>
      <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
      <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
      <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
      <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
 
   <span class="c">#Retrieve any user set axes parameters</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> 
      <span class="n">xticks</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xticks</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">xticklabels</span><span class="o">=</span><span class="bp">None</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> 
      <span class="n">yticks</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">yticks</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">yticklabels</span><span class="o">=</span><span class="bp">None</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xticklabels</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">yticklabels</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xstep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> 
      <span class="n">xstep</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xstep</span>
      <span class="n">xticks</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">xticklabels</span><span class="o">=</span><span class="bp">None</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ystep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> 
      <span class="n">ystep</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ystep</span>
      <span class="n">yticks</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">yticklabels</span><span class="o">=</span><span class="bp">None</span>
   
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xlabel</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ylabel</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">title</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title</span>   
   <span class="n">title_fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span>
   <span class="n">text_fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
   <span class="n">axis_label_fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span>
   <span class="k">if</span> <span class="n">title_fontsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="mi">15</span>
   <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">text_fontsize</span><span class="o">=</span><span class="mi">11</span>
   <span class="k">if</span> <span class="n">axis_label_fontsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">axis_label_fontsize</span><span class="o">=</span><span class="mi">11</span>
   <span class="n">axis_label_fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span>
   <span class="n">title_fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span>
   <span class="n">text_fontweight</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span>

   <span class="k">if</span> <span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span> \
                          <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">ylabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span><span class="p">,</span> \
                          <span class="n">fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span><span class="p">)</span>

   <span class="k">if</span> <span class="n">xstep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">ticks</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="n">gvals</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="n">xstep</span><span class="p">)</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="n">mult</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">ystep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">ticks</span><span class="p">,</span> <span class="n">mult</span><span class="o">=</span><span class="n">gvals</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">)</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">*</span><span class="mi">10</span><span class="o">**</span><span class="n">mult</span><span class="p">)</span>


   <span class="k">if</span> <span class="n">xticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">xticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">xticklabels</span><span class="p">)</span>

   <span class="k">if</span> <span class="n">yticks</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">yticklabels</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">yticklabels</span><span class="p">)</span>  


   <span class="c">#Set font size and weight</span>
   <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">():</span>
      <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">axis_label_fontsize</span><span class="p">)</span>
      <span class="n">label</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">axis_label_fontweight</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">get_ticklabels</span><span class="p">():</span>
      <span class="n">label</span><span class="o">.</span><span class="n">set_fontsize</span><span class="p">(</span><span class="n">axis_label_fontsize</span><span class="p">)</span>
      <span class="n">label</span><span class="o">.</span><span class="n">set_fontweight</span><span class="p">(</span><span class="n">axis_label_fontweight</span><span class="p">)</span>
       
   <span class="c">#Title</span>
   <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> 
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.03</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">title_fontsize</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="n">title_fontweight</span><span class="p">)</span>
    

<div class="viewcode-block" id="gset"><a class="viewcode-back" href="../gset.html#cfplot.gset">[docs]</a><span class="k">def</span> <span class="nf">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xlog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Set plot limits for all non longitude-latitide plots. </span>
<span class="sd">    | xmin, xmax, ymin, ymax are all needed to set the plot limits.  </span>
<span class="sd">    | Set xlog/ylog to 1 to get a log axis.</span>
<span class="sd">  </span>
<span class="sd">    | xmin=None - x minimum</span>
<span class="sd">    | xmax=None - x maximum</span>
<span class="sd">    | ymin=None - y minimum</span>
<span class="sd">    | ymax=None - y maximum</span>
<span class="sd">    | xlog=None - log x</span>
<span class="sd">    | ylog=None - log y</span>

<span class="sd">    | Once a user call is made to gset the plot limits are persistent. i.e. the next plot</span>
<span class="sd">    | will use the same set of plot limits.</span>
<span class="sd">    | Use gset() to reset to undefined plot limits i.e. the full range of the data.</span>

<span class="sd">    :Returns:</span>
<span class="sd">     None</span>

<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>

<span class="sd">   &quot;&quot;&quot;</span>

   <span class="c">#plotvars.xlog=xlog</span>
   <span class="c">#plotvars.ylog=ylog</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span>
 
   <span class="k">if</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span>
      <span class="k">return</span>

   <span class="k">if</span> <span class="p">[</span><span class="n">xmin</span><span class="p">,</span><span class="n">xmax</span><span class="p">,</span><span class="n">ymin</span><span class="p">,</span><span class="n">ymax</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;gset error</span><span class="se">\n\</span>
<span class="s">              xmin, xmax, ymin, ymax all need to be passed to gset to set the plot limits</span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>     
      
  
   <span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span><span class="o">=</span><span class="n">xlog</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span><span class="o">=</span><span class="n">ylog</span> 

   <span class="c">#Set plot limits</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">xlog</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s">&#39;log&#39;</span><span class="p">)</span>  


  
</div>
<div class="viewcode-block" id="gopen"><a class="viewcode-back" href="../gopen.html#cfplot.gopen">[docs]</a><span class="k">def</span> <span class="nf">gopen</span><span class="p">(</span><span class="n">rows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_plot</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="s">&#39;python&#39;</span><span class="p">,</span> \
          <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;landscape&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | gopen is used to open a graphic file.  </span>

<span class="sd">    | rows=1 - number of plot rows on the page</span>
<span class="sd">    | columns=1 - number of plot columns on the page</span>
<span class="sd">    | user_plot=1 - internal plot variable - do not use.</span>
<span class="sd">    | file=&#39;python&#39; - default file name</span>
<span class="sd">    | orientation=&#39;landscape&#39; - orientation - also takes &#39;portrait&#39;</span>
<span class="sd">    | fontsize=None - font size - default is 11 for a single plot</span>

<span class="sd">    :Returns:</span>
<span class="sd">     None</span>

<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>

<span class="sd">   &quot;&quot;&quot;</span>

   <span class="c">#Set values in globals</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span><span class="o">=</span><span class="n">rows</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span> 
   <span class="k">if</span> <span class="nb">file</span> <span class="o">!=</span> <span class="s">&#39;python&#39;</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span><span class="o">=</span><span class="nb">file</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span><span class="o">=</span><span class="n">orientation</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span><span class="o">=</span><span class="n">user_plot</span>

   <span class="k">if</span> <span class="n">orientation</span> <span class="o">!=</span> <span class="s">&#39;landscape&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">orientation</span> <span class="o">!=</span> <span class="s">&#39;portrait&#39;</span><span class="p">:</span>
         <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;gopen error</span><span class="se">\n\</span>
<span class="s">                 orientation incorrectly set</span><span class="se">\n\</span>
<span class="s">                 Input value was &#39;</span>\
                 <span class="o">+</span><span class="n">orientation</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">Valid options are portrait or landscape</span><span class="se">\n</span><span class="s">&#39;</span>
         <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>    

   <span class="c">#Set master plot size</span>
   <span class="k">if</span> <span class="n">orientation</span> <span class="o">==</span> <span class="s">&#39;landscape&#39;</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">=</span><span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">11.7</span><span class="p">,</span> <span class="mf">8.3</span><span class="p">))</span>
   <span class="k">else</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">=</span><span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">8.3</span><span class="p">,</span> <span class="mf">11.7</span><span class="p">))</span>
 
   <span class="c">#Set margins</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="mf">0.92</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mf">0.08</span><span class="p">)</span>
  
   <span class="c">#Set fontsize</span>
   <span class="k">if</span> <span class="n">fontsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">rows</span><span class="o">*</span><span class="n">columns</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span><span class="o">=</span><span class="mi">11</span>
      <span class="k">else</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span><span class="o">=</span><span class="mi">8</span>
   <span class="k">else</span><span class="p">:</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span><span class="o">=</span><span class="n">fontsize</span>

   <span class="c">#Set initial subplot</span>
   <span class="n">gpos</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

   <span class="c">#Change tick length for plots &gt; 2x2</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">columns</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">rows</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span>
      <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;xtick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>
      <span class="n">matplotlib</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;ytick.major.size&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span>

 
</div>
<div class="viewcode-block" id="gclose"><a class="viewcode-back" href="../gclose.html#cfplot.gclose">[docs]</a><span class="k">def</span> <span class="nf">gclose</span><span class="p">(</span><span class="n">view</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | gclose saves a graphics file.  The default is to view the file as well</span>
<span class="sd">    | - use view=0 to turn this off.</span>
<span class="sd">  </span>
<span class="sd">    | view=True - view graphics file</span>

<span class="sd">    :Returns:</span>
<span class="sd">     None</span>

<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    |</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    |</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    |</span>

<span class="sd">   &quot;&quot;&quot;</span>

   <span class="c">#Reset the user_plot variable to off</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span>

   <span class="nb">file</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">file</span>
   <span class="k">if</span> <span class="nb">file</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="nb">type</span><span class="o">=</span><span class="mi">1</span>
      <span class="k">if</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;.ps&#39;</span><span class="p">:</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span>
      <span class="k">if</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;.eps&#39;</span><span class="p">:</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span>
      <span class="k">if</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;.png&#39;</span><span class="p">:</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span>
      <span class="k">if</span> <span class="nb">file</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;.pdf&#39;</span><span class="p">:</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span>
      <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="nb">file</span><span class="o">=</span><span class="nb">file</span><span class="o">+</span><span class="s">&#39;.png&#39;</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">papertype</span><span class="o">=</span><span class="s">&#39;a4&#39;</span><span class="p">,</span>\
                                   <span class="n">orientation</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">orientation</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

      
   <span class="c">#Reset plotting</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">=</span><span class="bp">None</span>

</div>
<span class="k">def</span> <span class="nf">showplot</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
   <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
      <span class="n">plot</span><span class="o">=</span><span class="n">data</span>
      <span class="n">plot</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
      <span class="c">#dir(plot)</span>
      <span class="c">#plot=args[0]</span>



<div class="viewcode-block" id="gpos"><a class="viewcode-back" href="../gpos.html#cfplot.gpos">[docs]</a><span class="k">def</span> <span class="nf">gpos</span><span class="p">(</span><span class="n">pos</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    | Set plot position. Plots start at top left and increase by one each plot</span>
<span class="sd">    | to the right. When the end of the row has been reached then the next plot</span>
<span class="sd">    | will bed the leftmost plot on the next row down.</span>

<span class="sd">    | pos=pos - plot position</span>

<span class="sd">    :Returns:</span>
<span class="sd">     None</span>

<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">  </span>
<span class="sd">   &quot;&quot;&quot;</span> 

   <span class="c">#Check inputs are okay</span>
   <span class="k">if</span> <span class="n">pos</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">pos</span> <span class="o">&gt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span><span class="o">*</span><span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
      <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;pos error - pos out of range:</span><span class="se">\n</span><span class="s"> range = 1 - &#39;</span>
      <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span><span class="o">*</span><span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
      <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> input pos was &#39;</span><span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>
      <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>    

   <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">master_plot</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s">&#39;both&#39;</span><span class="p">,</span> <span class="n">direction</span><span class="o">=</span><span class="s">&#39;out&#39;</span><span class="p">)</span>

   <span class="c">#if plotvars.user_plot == 0: </span>
   <span class="c">#   if plotvars.user_gset == 1: gset(user_gset=plotvars.user_gset)</span>
   <span class="c">#   gset(user_gset=plotvars.user_gset)</span>

  

<span class="c">#######################################</span>
<span class="c">#pcon - convert mb to km and vice-versa</span>
<span class="c">#######################################</span>
</div>
<div class="viewcode-block" id="pcon"><a class="viewcode-back" href="../pcon.html#cfplot.pcon">[docs]</a><span class="k">def</span> <span class="nf">pcon</span><span class="p">(</span><span class="n">mb</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">km</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mf">7.0</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    | pcon is a function for converting pressure to height in kilometers and </span>
<span class="sd">    | vice-versa. This function uses the equation P=P0exp(-z/H) to translate </span>
<span class="sd">    | between pressure and height. In pcon the surface pressure P0 is set to </span>
<span class="sd">    | 1000.0mb and the scale height H is set to 7.0. The value of H can vary </span>
<span class="sd">    | from 6.0 in the polar regions to 8.5 in the tropics as well as seasonally. </span>
<span class="sd">    | The value of P0 could also be said to be 1013.25mb rather than 1000.0mb. </span>

<span class="sd">    | As this relationship is approximate:</span>
<span class="sd">    | (i) Only use this for making the axis labels on y axis pressure plots</span>
<span class="sd">    | (ii) Put the converted axis on the right hand side to indicate that this </span>
<span class="sd">    |      isn&#39;t the primary unit of measure</span>

<span class="sd">    | print pcon(mb=[1000, 300, 100, 30, 10, 3, 1, 0.3])</span>
<span class="sd">    | [0., 8.42780963 16.11809565 24.54590528 32.2361913, 40.66400093 48.35428695, 56.78209658]  </span>

<span class="sd">    | mb=None - input pressure </span>
<span class="sd">    | km=None - input height</span>
<span class="sd">    | h=7.0 - default value for h</span>
<span class="sd">    | p0=1000 - default value for p0</span>

<span class="sd">    :Returns:</span>
<span class="sd">     | pressure(mb) if height(km) input, </span>
<span class="sd">     | height(km) if pressure(mb) input</span>
<span class="sd">    &quot;&quot;&quot;</span>  

   <span class="k">if</span> <span class="p">[</span><span class="n">mb</span><span class="p">,</span> <span class="n">km</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;pcon error - pcon must have mb or km input</span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>      
 
   <span class="k">if</span> <span class="n">mb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p0</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">mb</span><span class="p">))</span>
   <span class="k">if</span> <span class="n">km</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">km</span><span class="p">)</span><span class="o">/</span><span class="n">h</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p0</span><span class="p">)))</span>
 



</div>
<div class="viewcode-block" id="supscr"><a class="viewcode-back" href="../supscr.html#cfplot.supscr">[docs]</a><span class="k">def</span> <span class="nf">supscr</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | supscr - add superscript text formatting for ** and ^</span>
<span class="sd">    | This is an internal routine used in titles and colour bars </span>
<span class="sd">    | and not used by the user.</span>
<span class="sd">    | text=None - input text</span>
<span class="sd"> </span>
<span class="sd">    :Returns:</span>
<span class="sd">     Formatted text</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>  

   <span class="k">if</span> <span class="p">[</span><span class="n">text</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> supscr error - supscr must have text input</span><span class="se">\n</span><span class="s">&#39;</span>
         <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>        


   <span class="n">tform</span><span class="o">=</span><span class="s">&#39;&#39;</span>

   <span class="n">sup</span><span class="o">=</span><span class="mi">0</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">text</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s">&#39;^&#39;</span><span class="p">):</span> <span class="n">sup</span><span class="o">=</span><span class="mi">2</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">==</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="n">sup</span><span class="o">=</span><span class="n">sup</span><span class="o">+</span><span class="mi">1</span>
   
      <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="n">tform</span><span class="o">=</span><span class="n">tform</span><span class="o">+</span><span class="n">i</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">1</span><span class="p">):</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="s">&#39;*&#39;</span><span class="p">):</span> <span class="n">tform</span><span class="o">=</span><span class="n">tform</span><span class="o">+</span><span class="s">&#39;*&#39;</span><span class="o">+</span><span class="n">i</span><span class="p">;</span> <span class="n">sup</span><span class="o">=</span><span class="mi">0</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="s">&#39;-0123456789&#39;</span><span class="p">:</span> <span class="n">tform</span><span class="o">=</span><span class="n">tform</span><span class="o">+</span><span class="n">i</span>
         <span class="k">else</span><span class="p">:</span> <span class="n">tform</span><span class="o">=</span><span class="n">tform</span><span class="o">+</span><span class="s">&#39;}$&#39;</span><span class="o">+</span><span class="n">i</span><span class="p">;</span> <span class="n">sup</span><span class="o">=</span><span class="mi">0</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span> <span class="n">tform</span><span class="o">=</span><span class="n">tform</span><span class="o">+</span><span class="s">&#39;$^{&#39;</span> <span class="p">;</span> <span class="n">sup</span><span class="o">=</span><span class="mi">3</span>
   
   <span class="k">if</span> <span class="p">(</span><span class="n">sup</span> <span class="o">==</span> <span class="mi">3</span><span class="p">):</span> <span class="n">tform</span><span class="o">=</span><span class="n">tform</span><span class="o">+</span><span class="s">&#39;}$&#39;</span>


   <span class="n">tform</span><span class="o">=</span><span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;m2&#39;</span><span class="p">,</span> <span class="s">&#39;m$^{2}$&#39;</span><span class="p">)</span>   
   <span class="n">tform</span><span class="o">=</span><span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;m3&#39;</span><span class="p">,</span> <span class="s">&#39;m$^{3}$&#39;</span><span class="p">)</span>   
   <span class="n">tform</span><span class="o">=</span><span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;m-2&#39;</span><span class="p">,</span> <span class="s">&#39;m$^{-2}$&#39;</span><span class="p">)</span>
   <span class="n">tform</span><span class="o">=</span><span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;m-3&#39;</span><span class="p">,</span> <span class="s">&#39;m$^{-3}$&#39;</span><span class="p">)</span>
   <span class="n">tform</span><span class="o">=</span><span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;s-1&#39;</span><span class="p">,</span> <span class="s">&#39;s$^{-1}$&#39;</span><span class="p">)</span>
   <span class="n">tform</span><span class="o">=</span><span class="n">tform</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;s-2&#39;</span><span class="p">,</span> <span class="s">&#39;s$^{-2}$&#39;</span><span class="p">)</span>


   <span class="k">return</span> <span class="n">tform</span>



</div>
<div class="viewcode-block" id="gvals"><a class="viewcode-back" href="../gvals.html#cfplot.gvals">[docs]</a><span class="k">def</span> <span class="nf">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span> 
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | gvals - work out a sensible set of values between two limits</span>
<span class="sd">    | This is an internal routine used for contour levels and axis </span>
<span class="sd">    | labelling and is not used by the user.</span>

<span class="sd">    | dmin=None - minimum</span>
<span class="sd">    | dmax=None - maximum</span>
<span class="sd">    | tight=0 - return values tight to input min and max</span>
<span class="sd">    | mystep=None - use this step</span>
<span class="sd">    | mod=1 - modify data to make use of a multipler </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    |</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>

   <span class="k">if</span> <span class="p">[</span><span class="n">dmin</span><span class="p">,</span> <span class="n">dmax</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> gvals error - gvals must have dmin and dmax input</span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>         


   <span class="c">#Return some values if dmin = dmax</span>
   <span class="k">if</span> <span class="n">dmin</span> <span class="o">==</span> <span class="n">dmax</span><span class="p">:</span>
      <span class="n">vals</span><span class="o">=</span><span class="p">[</span><span class="n">dmin</span><span class="o">-</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">dmin</span><span class="p">,</span> <span class="n">dmin</span><span class="o">+</span><span class="mf">0.001</span><span class="p">]</span>
      <span class="n">mult</span><span class="o">=</span><span class="mi">0</span>
      <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">mult</span>



   <span class="n">mult</span><span class="o">=</span><span class="mi">0</span> <span class="c">#field multiplyer</span>
 
   <span class="c">#Generate reasonable step </span>
   <span class="n">step</span><span class="o">=</span><span class="p">(</span><span class="n">dmax</span><span class="o">-</span><span class="n">dmin</span><span class="p">)</span><span class="o">/</span><span class="mf">16.0</span>
   <span class="k">if</span> <span class="n">mod</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">mystep</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span> <span class="n">step</span><span class="o">=</span><span class="n">mystep</span>

      <span class="k">if</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
         <span class="k">while</span> <span class="n">dmax</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="o">*</span><span class="mf">10.0</span>
            <span class="n">dmin</span><span class="o">=</span><span class="n">dmin</span><span class="o">*</span><span class="mf">10.0</span>
            <span class="n">dmax</span><span class="o">=</span><span class="n">dmax</span><span class="o">*</span><span class="mf">10.0</span>
            <span class="n">mult</span><span class="o">=</span><span class="n">mult</span><span class="o">-</span><span class="mi">1</span>

      <span class="k">if</span> <span class="n">step</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">:</span>
         <span class="k">while</span> <span class="n">step</span> <span class="o">&gt;=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">dmax</span> <span class="o">&gt;</span><span class="mi">10</span><span class="p">:</span>
            <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="o">/</span><span class="mf">10.0</span>
            <span class="n">dmin</span><span class="o">=</span><span class="n">dmin</span><span class="o">/</span><span class="mf">10.0</span>
            <span class="n">dmax</span><span class="o">=</span><span class="n">dmax</span><span class="o">/</span><span class="mf">10.0</span>
            <span class="n">mult</span><span class="o">=</span><span class="n">mult</span><span class="o">+</span><span class="mi">1</span>
     

   <span class="c">#Change step to be a sensible one</span>
   <span class="n">step</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">dmax</span><span class="o">-</span><span class="n">dmin</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span>


   <span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="o">==</span> <span class="mi">8</span> <span class="ow">or</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">9</span><span class="p">):</span> <span class="n">step</span><span class="o">=</span><span class="mi">10</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="o">==</span> <span class="mi">7</span> <span class="ow">or</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">6</span> <span class="ow">or</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">4</span><span class="p">):</span> <span class="n">step</span><span class="o">=</span><span class="mi">5</span>
   <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span> <span class="n">step</span><span class="o">=</span><span class="mi">2</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">):</span> <span class="n">step</span><span class="o">=</span><span class="nb">int</span><span class="p">(</span><span class="n">step</span><span class="o">/</span><span class="mi">10</span><span class="p">)</span><span class="o">*</span><span class="mi">10</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span> <span class="n">step</span><span class="o">=</span><span class="mi">1</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">mystep</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span> <span class="n">step</span><span class="o">=</span><span class="n">mystep</span>


   <span class="c">#Make integer step</span>
   <span class="k">if</span> <span class="n">tight</span> <span class="o">==</span><span class="mi">0</span><span class="p">:</span>
      <span class="n">vals</span><span class="o">=</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dmin</span><span class="p">)</span><span class="o">/</span><span class="n">step</span><span class="p">)</span><span class="o">*</span><span class="n">step</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">vals</span><span class="o">=</span><span class="n">dmin</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="o">+</span><span class="n">step</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dmax</span><span class="p">:</span>
      <span class="n">vals</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="o">+</span><span class="n">step</span><span class="p">)</span>
   

   <span class="c">#Remove upper and lower limits if tight=0 - i.e. a contour plot</span>
   <span class="k">if</span> <span class="n">tight</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">dmax</span><span class="p">:</span> <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dmin</span><span class="p">:</span> <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>


   <span class="k">if</span> <span class="n">mystep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">mystep</span><span class="p">)</span> <span class="o">==</span> <span class="n">mystep</span><span class="p">:</span>      
         <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">mult</span>


   <span class="c">#Floating point step</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">mult</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">):</span>
      <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">mult</span>  
   <span class="k">else</span><span class="p">:</span>
      <span class="n">step</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%.1f</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">((</span><span class="n">dmax</span><span class="o">-</span><span class="n">dmin</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">step</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">((</span><span class="n">dmax</span><span class="o">-</span><span class="n">dmin</span><span class="p">)</span><span class="o">/</span><span class="mi">16</span><span class="p">))</span>

   <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">9</span><span class="p">:</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.0</span>
   <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">8</span><span class="p">:</span> <span class="n">step</span><span class="o">=</span><span class="mf">1.0</span>
   <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">7</span><span class="p">:</span> <span class="n">step</span><span class="o">=.</span><span class="mi">5</span>
   <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">6</span><span class="p">:</span> <span class="n">step</span><span class="o">=.</span><span class="mi">5</span>
   <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">3</span><span class="p">:</span> <span class="n">step</span><span class="o">=.</span><span class="mi">2</span>
   <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">09</span><span class="p">:</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span>
   <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mi">08</span><span class="p">:</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.1</span>
   <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mo">07</span><span class="p">:</span> <span class="n">step</span><span class="o">=.</span><span class="mo">05</span>
   <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mo">06</span><span class="p">:</span> <span class="n">step</span><span class="o">=.</span><span class="mo">05</span>
   <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="o">.</span><span class="mo">03</span><span class="p">:</span> <span class="n">step</span><span class="o">=.</span><span class="mo">02</span>


   <span class="k">if</span> <span class="p">(</span><span class="n">dmax</span><span class="o">-</span><span class="n">dmin</span> <span class="o">==</span> <span class="n">step</span><span class="p">):</span> <span class="n">step</span><span class="o">=</span><span class="n">step</span><span class="o">/</span><span class="mf">10.</span>
   <span class="n">vals</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">dmin</span><span class="o">/</span><span class="n">step</span><span class="p">)</span><span class="o">*</span><span class="n">step</span><span class="p">))</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="o">+</span><span class="n">step</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dmax</span><span class="p">:</span>
      <span class="n">vals</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%.2f</span><span class="s">&quot;</span> <span class="o">%</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="o">+</span><span class="n">step</span><span class="p">)))</span>

   <span class="k">if</span> <span class="n">tight</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">dmax</span><span class="p">:</span> <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">dmin</span><span class="p">:</span> <span class="n">vals</span><span class="o">=</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

   <span class="k">return</span> <span class="n">vals</span><span class="p">,</span> <span class="n">mult</span>


</div>
<div class="viewcode-block" id="cf_data_assign"><a class="viewcode-back" href="../cf_data_assign.html#cfplot.cf_data_assign">[docs]</a><span class="k">def</span> <span class="nf">cf_data_assign</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Check cf input data is okay and return data for contour plot.</span>
<span class="sd">    | This is an internal routine not used by the user.</span>
<span class="sd">    | f=None - input cf field</span>
<span class="sd">    | colorbar_title=None - input colour bar title</span>
<span class="sd">    | verbose=None - set to 1 to get a verbose idea of what the cf_data_assign is doing</span>

<span class="sd">    :Returns:</span>
<span class="sd">     | f - data for contouring</span>
<span class="sd">     | x - x coordinates of data (optional)</span>
<span class="sd">     | y - y coordinates of data (optional)</span>
<span class="sd">     | ptype - plot type</span>
<span class="sd">     | colorbar_title - colour bar title</span>
<span class="sd">     | xlabel - x label for plot</span>
<span class="sd">     | ylabel - y label for plot</span>
<span class="sd">     | </span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">     |</span>
<span class="sd">   &quot;&quot;&quot;</span>


   <span class="c">#Check input data has the correct number of dimensions</span>
   <span class="c">#Take into account rotated pole fields having extra dimensions  </span>
   <span class="n">ndim</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">axes</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">cf</span><span class="o">.</span><span class="n">gt</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
   <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s">&#39;rotated_latitude_longitude&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span>
         <span class="k">print</span> <span class="s">&#39;&#39;</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">):</span> <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;cf_data_assign error - data has too many dimensions&#39;</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">ndim</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">):</span> <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;cf_data_assign error - data has too few dimensions&#39;</span>
         <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> cfplot requires two dimensional data </span><span class="se">\n</span><span class="s">&#39;</span>
         <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">sn</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s">&#39;standard_name&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="n">ln</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s">&#39;long_name&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sn</span><span class="p">:</span> 
               <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">sn</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="k">else</span><span class="p">:</span>
               <span class="k">if</span> <span class="n">ln</span><span class="p">:</span> <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">ln</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;,&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">size</span><span class="p">)</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
         <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span> 

   
 
   <span class="c">#Set up data arrays and variables</span>
   <span class="n">lons</span><span class="o">=</span><span class="bp">None</span>
   <span class="n">lats</span><span class="o">=</span><span class="bp">None</span>
   <span class="n">height</span><span class="o">=</span><span class="bp">None</span> 
   <span class="n">time</span><span class="o">=</span><span class="bp">None</span> 
   <span class="n">xlabel</span><span class="o">=</span><span class="s">&#39;&#39;</span>
   <span class="n">ylabel</span><span class="o">=</span><span class="s">&#39;&#39;</span>
   <span class="n">ref_time</span><span class="o">=</span><span class="bp">None</span>
   <span class="n">ref_calendar</span><span class="o">=</span><span class="bp">None</span>
   <span class="n">ref_time_origin</span><span class="o">=</span><span class="bp">None</span>
   <span class="n">time_opts</span><span class="o">=</span><span class="bp">None</span>
   <span class="n">has_lons</span><span class="o">=</span><span class="bp">None</span>
   <span class="n">has_lats</span><span class="o">=</span><span class="bp">None</span>
   <span class="n">has_height</span><span class="o">=</span><span class="bp">None</span>
   <span class="n">has_time</span><span class="o">=</span><span class="bp">None</span>
   <span class="c">#has_rotated_pole=None</span>
   <span class="n">xpole</span><span class="o">=</span><span class="bp">None</span>
   <span class="n">ypole</span><span class="o">=</span><span class="bp">None</span>
   <span class="n">ptype</span><span class="o">=</span><span class="bp">None</span>


   <span class="c">#Extract coordinate data if a matching CF standard_name or axis is found</span>
   <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
       <span class="n">sn</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s">&#39;standard_name&#39;</span><span class="p">,</span> <span class="s">&#39;NoName&#39;</span><span class="p">)</span>
       <span class="n">an</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s">&#39;axis&#39;</span><span class="p">,</span> <span class="s">&#39;NoName&#39;</span><span class="p">)</span>

       <span class="n">standard_name_x</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;longitude&#39;</span><span class="p">]</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">sn</span> <span class="ow">in</span> <span class="n">standard_name_x</span> <span class="ow">or</span> <span class="n">an</span> <span class="o">==</span> <span class="s">&#39;X&#39;</span><span class="p">):</span>
          <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;cf_data_assign standard_name, axis - assigned lons -&#39;</span><span class="p">,</span> <span class="n">sn</span><span class="p">,</span> <span class="n">an</span>
          <span class="n">lons</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

       <span class="n">standard_name_y</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;latitude&#39;</span><span class="p">]</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">sn</span> <span class="ow">in</span> <span class="n">standard_name_y</span> <span class="ow">or</span> <span class="n">an</span> <span class="o">==</span> <span class="s">&#39;Y&#39;</span><span class="p">):</span>
          <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;cf_data_assign standard_name, axis - assigned lats -&#39;</span><span class="p">,</span> <span class="n">sn</span><span class="p">,</span> <span class="n">an</span>
          <span class="n">lats</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

       <span class="n">standard_name_z</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;pressure&#39;</span><span class="p">,</span> <span class="s">&#39;air_pressure&#39;</span><span class="p">,</span> <span class="s">&#39;height&#39;</span><span class="p">,</span> <span class="s">&#39;depth&#39;</span><span class="p">]</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">sn</span> <span class="ow">in</span> <span class="n">standard_name_z</span> <span class="ow">or</span> <span class="n">an</span> <span class="o">==</span> <span class="s">&#39;Z&#39;</span><span class="p">):</span>
          <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;cf_data_assign standard_name, axis - assigned height -&#39;</span><span class="p">,</span> <span class="n">sn</span><span class="p">,</span> <span class="n">an</span>
          <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

       <span class="n">standard_name_t</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;time&#39;</span><span class="p">]</span>
       <span class="k">if</span> <span class="p">(</span><span class="n">sn</span> <span class="ow">in</span> <span class="n">standard_name_t</span> <span class="ow">or</span> <span class="n">an</span> <span class="o">==</span> <span class="s">&#39;T&#39;</span><span class="p">):</span>
          <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;cf_data_assign standard_name, axis - assigned time -&#39;</span><span class="p">,</span> <span class="n">sn</span><span class="p">,</span> <span class="n">an</span>
          <span class="n">time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>



   
   <span class="c">#CF defined units</span>
   <span class="n">lon_units</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;degrees_east&#39;</span><span class="p">,</span> <span class="s">&#39;degree_east&#39;</span><span class="p">,</span> <span class="s">&#39;degree_E&#39;</span><span class="p">,</span> <span class="s">&#39;degrees_E&#39;</span><span class="p">,</span> <span class="s">&#39;degreeE&#39;</span><span class="p">,</span> <span class="s">&#39;degreesE&#39;</span><span class="p">]</span>
   <span class="n">lat_units</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;degrees_north&#39;</span><span class="p">,</span> <span class="s">&#39;degree_north&#39;</span><span class="p">,</span> <span class="s">&#39;degree_N&#39;</span><span class="p">,</span> <span class="s">&#39;degrees_N&#39;</span><span class="p">,</span> <span class="s">&#39;degreeN&#39;</span><span class="p">,</span> <span class="s">&#39;degreesN&#39;</span><span class="p">]</span>
   <span class="n">height_units</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;millibar&#39;</span><span class="p">,</span> <span class="s">&#39;decibar&#39;</span><span class="p">,</span> <span class="s">&#39;atmosphere&#39;</span><span class="p">,</span> <span class="s">&#39;atm&#39;</span><span class="p">,</span> <span class="s">&#39;pascal&#39;</span><span class="p">,</span><span class="s">&#39;Pa&#39;</span><span class="p">,</span> <span class="s">&#39;hPa&#39;</span><span class="p">,</span>\
                 <span class="s">&#39;meter&#39;</span><span class="p">,</span> <span class="s">&#39;metre&#39;</span><span class="p">,</span> <span class="s">&#39;m&#39;</span><span class="p">,</span> <span class="s">&#39;kilometer&#39;</span><span class="p">,</span> <span class="s">&#39;kilometre&#39;</span><span class="p">,</span> <span class="s">&#39;km&#39;</span><span class="p">]</span> 
   <span class="n">time_units</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;day&#39;</span><span class="p">,</span> <span class="s">&#39;days&#39;</span><span class="p">,</span> <span class="s">&#39;d&#39;</span><span class="p">,</span> <span class="s">&#39;hour&#39;</span><span class="p">,</span> <span class="s">&#39;hours&#39;</span><span class="p">,</span> <span class="s">&#39;hr&#39;</span><span class="p">,</span> <span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="s">&#39;minute&#39;</span><span class="p">,</span> <span class="s">&#39;minutes&#39;</span><span class="p">,</span> <span class="s">&#39;min&#39;</span><span class="p">,</span> <span class="s">&#39;mins&#39;</span><span class="p">,</span>\
               <span class="s">&#39;second&#39;</span><span class="p">,</span> <span class="s">&#39;seconds&#39;</span><span class="p">,</span> <span class="s">&#39;sec&#39;</span><span class="p">,</span> <span class="s">&#39;secs&#39;</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">]</span>



   <span class="c">#Extract coordinate data if a matching CF set of units is found</span>
   <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="n">units</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s">&#39;units&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="n">lon_units</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">lons</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;cf_data_assign units - assigned lons -&#39;</span><span class="p">,</span> <span class="n">units</span>
            <span class="n">lons</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="n">lat_units</span><span class="p">:</span>         
         <span class="k">if</span> <span class="n">lats</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;cf_data_assign units - assigned lats -&#39;</span><span class="p">,</span> <span class="n">units</span>
            <span class="n">lats</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="n">height_units</span><span class="p">:</span>         
         <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;cf_data_assign units - assigned height -&#39;</span><span class="p">,</span> <span class="n">units</span>
            <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">units</span> <span class="ow">in</span> <span class="n">time_units</span><span class="p">:</span>         
         <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;cf_data_assign units - assigned time -&#39;</span><span class="p">,</span> <span class="n">units</span>
            <span class="n">time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

   
   <span class="c">#Extract coordinate data from variable name if not already assigned</span>
   <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
      <span class="k">if</span> <span class="n">mydim</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;dim&#39;</span><span class="p">:</span>
         <span class="n">name</span><span class="o">=</span><span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;lon&#39;</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">lons</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
               <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;cf_data_assign dimension name - assigned lons -&#39;</span><span class="p">,</span> <span class="n">name</span>
               <span class="n">lons</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

         <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;lat&#39;</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">lats</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
               <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;cf_data_assign dimension name - assigned lats -&#39;</span><span class="p">,</span> <span class="n">name</span>
               <span class="n">lats</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

         <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;theta&#39;</span> <span class="ow">or</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;p&#39;</span> <span class="ow">or</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;air_pressure&#39;</span><span class="p">):</span> 
            <span class="k">if</span> <span class="n">height</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
               <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;cf_data_assign dimension name - assigned height -&#39;</span><span class="p">,</span> <span class="n">name</span>
               <span class="n">height</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

         <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;t&#39;</span><span class="p">:</span> 
            <span class="k">if</span> <span class="n">time</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
               <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span> <span class="s">&#39;cf_data_assign dimension name - assigned time -&#39;</span><span class="p">,</span> <span class="n">name</span>
               <span class="n">time</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>


   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">has_lons</span><span class="o">=</span><span class="mi">1</span>
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">has_lats</span><span class="o">=</span><span class="mi">1</span>
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">has_height</span><span class="o">=</span><span class="mi">1</span>
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">has_time</span><span class="o">=</span><span class="mi">1</span>




   <span class="c">#assign field data   </span>
   <span class="n">field</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>

   <span class="c">#Check what plot type is required.</span>
   <span class="c">#0=simple contour plot, 1=map plot, 2=latitude-height plot,</span>
   <span class="c">#3=longitude-time plot, 4=latitude-time plot.</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
      <span class="n">ptype</span><span class="o">=</span><span class="mi">1</span>
      <span class="n">x</span><span class="o">=</span><span class="n">lons</span>
      <span class="n">y</span><span class="o">=</span><span class="n">lats</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span> 
      <span class="n">ptype</span><span class="o">=</span><span class="mi">2</span>
      <span class="n">x</span><span class="o">=</span><span class="n">lats</span>
      <span class="n">y</span><span class="o">=</span><span class="n">height</span>
      <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
         <span class="n">name</span><span class="o">=</span><span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;lat&#39;</span><span class="p">:</span> 
            <span class="n">xunits</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">xunits</span> <span class="ow">in</span> <span class="n">lat_units</span><span class="p">):</span> <span class="n">xunits</span><span class="o">=</span><span class="s">&#39;degrees&#39;</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; (&#39;</span> <span class="o">+</span> <span class="n">xunits</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
         <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;p&#39;</span> <span class="ow">or</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;theta&#39;</span> <span class="ow">or</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;height&#39;</span><span class="p">:</span> 
            <span class="n">yunits</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; (&#39;</span> <span class="o">+</span> <span class="n">yunits</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>


   <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span> 
      <span class="n">ptype</span><span class="o">=</span><span class="mi">3</span>
      <span class="n">x</span><span class="o">=</span><span class="n">lons</span>
      <span class="n">y</span><span class="o">=</span><span class="n">height</span>
      <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
         <span class="n">name</span><span class="o">=</span><span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;lon&#39;</span><span class="p">:</span> 
            <span class="n">xunits</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">xunits</span> <span class="ow">in</span> <span class="n">lon_units</span><span class="p">):</span> <span class="n">xunits</span><span class="o">=</span><span class="s">&#39;degrees&#39;</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; (&#39;</span> <span class="o">+</span> <span class="n">xunits</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>
         <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;p&#39;</span> <span class="ow">or</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;theta&#39;</span> <span class="ow">or</span> <span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;height&#39;</span><span class="p">:</span> 
            <span class="n">yunits</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39; (&#39;</span> <span class="o">+</span> <span class="n">yunits</span> <span class="o">+</span> <span class="s">&#39;)&#39;</span>



   <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span>
      <span class="n">ptype</span><span class="o">=</span><span class="mi">4</span>
      <span class="n">x</span><span class="o">=</span><span class="n">lons</span>
      <span class="n">y</span><span class="o">=</span><span class="n">time</span>
      <span class="n">ref_time</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
      <span class="n">ref_calendar</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>
      <span class="n">ref_time_origin</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Units</span><span class="o">.</span><span class="n">reftime</span><span class="p">)</span>
      <span class="n">time_opts</span><span class="o">=</span><span class="p">[</span><span class="n">ref_time</span><span class="p">,</span><span class="n">ref_calendar</span><span class="p">,</span><span class="n">ref_time_origin</span><span class="p">]</span>

   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">time</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">ptype</span><span class="o">=</span><span class="mi">5</span>     
      <span class="n">x</span><span class="o">=</span><span class="n">lats</span>
      <span class="n">y</span><span class="o">=</span><span class="n">time</span>
      <span class="n">ref_time</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">units</span>
      <span class="n">ref_calendar</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">calendar</span>
      <span class="n">ref_time_origin</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="s">&#39;time&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">Units</span><span class="o">.</span><span class="n">reftime</span><span class="p">)</span>
      <span class="n">time_opts</span><span class="o">=</span><span class="p">[</span><span class="n">ref_time</span><span class="p">,</span><span class="n">ref_calendar</span><span class="p">,</span><span class="n">ref_time_origin</span><span class="p">]</span>

  

   <span class="c">#Rotated pole</span>
   <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s">&#39;rotated_latitude_longitude&#39;</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span> 
      <span class="n">ptype</span><span class="o">=</span><span class="mi">6</span>
      <span class="n">rotated_pole</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="s">&#39;rotated_latitude_longitude&#39;</span><span class="p">)</span>
      <span class="n">xpole</span><span class="o">=</span><span class="n">rotated_pole</span><span class="p">[</span><span class="s">&#39;grid_north_pole_longitude&#39;</span><span class="p">]</span>
      <span class="n">ypole</span><span class="o">=</span><span class="n">rotated_pole</span><span class="p">[</span><span class="s">&#39;grid_north_pole_latitude&#39;</span><span class="p">]</span>

      <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
         <span class="k">if</span> <span class="n">mydim</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;dim&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">))</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">))[</span><span class="mi">1</span><span class="p">]:</span>
               <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
               <span class="n">xunits</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s">&#39;units&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
               <span class="n">xlabel</span><span class="o">=</span><span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">))</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">))[</span><span class="mi">0</span><span class="p">]:</span>
               <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
               <span class="c">#Flip y and data if reversed</span>
               <span class="k">if</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                  <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                  <span class="n">field</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
               <span class="n">yunits</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
               <span class="n">ylabel</span><span class="o">=</span><span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span><span class="o">+</span><span class="n">yunits</span>     





      <span class="c">#rotated_pole.coords </span>
      <span class="c">#gives set([&#39;dim2&#39;, &#39;dim3&#39;, &#39;aux3&#39;, &#39;aux4&#39;])</span>
      <span class="c">#select out the data using these</span>
      <span class="c">#Possible to make a plot using aux3 and aux4 via a keyword?</span>

   <span class="c">#None of the above</span>
   <span class="k">if</span> <span class="p">[</span><span class="n">has_lons</span><span class="p">,</span> <span class="n">has_lats</span><span class="p">,</span> <span class="n">has_height</span><span class="p">,</span> <span class="n">has_time</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">ptype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="mi">6</span><span class="p">:</span>
      <span class="n">ptype</span><span class="o">=</span><span class="mi">0</span>

      <span class="k">for</span> <span class="n">mydim</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
         <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">))</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">))[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="n">xunits</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s">&#39;units&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span>

         <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">))</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">array</span><span class="p">))[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">)</span><span class="o">.</span><span class="n">array</span><span class="p">)</span>
            <span class="n">yunits</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">mydim</span><span class="p">),</span> <span class="s">&#39;Units&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="n">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="n">mydim</span><span class="p">)</span><span class="o">+</span><span class="n">yunits</span>     






   <span class="c">#Assign colorbar_title</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">colorbar_title</span> <span class="o">==</span> <span class="bp">None</span><span class="p">):</span>   
      <span class="n">colorbar_title</span><span class="o">=</span><span class="s">&#39;&#39;</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;ncvar&#39;</span><span class="p">):</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">ncvar</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;short_name&#39;</span><span class="p">):</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">short_name</span> 
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;long_name&#39;</span><span class="p">):</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">long_name</span> 
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;standard_name&#39;</span><span class="p">):</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="n">f</span><span class="o">.</span><span class="n">standard_name</span>
      <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">&#39;Units&#39;</span><span class="p">):</span> 
         <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">)</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="o">+</span><span class="s">&#39;&#39;</span>
         <span class="k">else</span><span class="p">:</span> <span class="n">colorbar_title</span><span class="o">=</span><span class="n">colorbar_title</span><span class="o">+</span><span class="s">&#39;(&#39;</span><span class="o">+</span><span class="n">supscr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">Units</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;)&#39;</span>
    

   <span class="c">#Return data</span>
   <span class="k">return</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">time_opts</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="check_data"><a class="viewcode-back" href="../check_data.html#cfplot.check_data">[docs]</a><span class="k">def</span> <span class="nf">check_data</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | check_data - check user input contour data is correct.</span>
<span class="sd">    | This is an internal routine and is not used by the user.</span>
<span class="sd">    | </span>
<span class="sd">    | field=None - field</span>
<span class="sd">    | x=None - x points for field</span>
<span class="sd">    | y=None - y points for field</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>

   <span class="c">#Input error trapping</span>
   <span class="n">args</span> <span class="o">=</span> <span class="bp">True</span>
   <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">field</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
         <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;con error - a field for contouring must be passed with the f= flag</span><span class="se">\n</span><span class="s">&#39;</span>
         <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>   
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
         <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;con error - x coordinates must be passed with the x= flag</span><span class="se">\n</span><span class="s">&#39;</span>
         <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
         <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;con error - y coordinates must be passed with the y= flag</span><span class="se">\n</span><span class="s">&#39;</span>
         <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>  
   <span class="k">if</span> <span class="n">args</span> <span class="o">==</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>  
  
  
   <span class="c">#Check input dimensions look okay.</span>
   <span class="c">#All inputs 2D</span>
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span> <span class="ow">and</span>  <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">xpts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">ypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">xpts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">xpts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
      <span class="k">if</span> <span class="n">ypts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">ypts</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
      <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> <span class="k">return</span>

   <span class="c">#Field x and y all 1D</span>
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">):</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">field</span><span class="p">):</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>
      <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> <span class="k">return</span>

   <span class="c">#Field 2D, x and y 1D</span>
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span> 
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>  
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span> 
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">field</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">1</span><span class="p">]:</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>  
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">)[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">args</span> <span class="o">=</span> <span class="bp">False</span>  
   
  
   <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
      <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;Input arguments incorrectly shaped:</span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;x has shape:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">x</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;y has shape:&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">y</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;field has shape&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">field</span><span class="p">))</span><span class="o">+</span><span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span>
      <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;Expected x=xpts, y=ypts, field=(ypts,xpts)</span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;x=npts, y=npts, field=npts</span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;or x=[ypts, xpts], y=[ypts, xpts], field=[ypts, xpts]</span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>  


</div>
<div class="viewcode-block" id="cscale"><a class="viewcode-back" href="../cscale.html#cfplot.cscale">[docs]</a><span class="k">def</span> <span class="nf">cscale</span><span class="p">(</span><span class="n">cmap</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">white</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">below</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">   | cscale - choose and manipulate colour maps.  Around 200 colour scales are</span>
<span class="sd">   |          available - see the gallery section for more details.</span>
<span class="sd">   | </span>
<span class="sd">   | cmap=cmap - name of colour map</span>
<span class="sd">   | ncols=ncols - number of colours for colour map</span>
<span class="sd">   | white=white - change these colours to be white</span>
<span class="sd">   | below=below - change the number of colours below the mid point of </span>
<span class="sd">   |               the colour scale to be this</span>
<span class="sd">   | above=above - change the number of colours above the mid point of </span>
<span class="sd">   |               the colour scale to be this</span>
<span class="sd">   | </span>
<span class="sd">   |</span>
<span class="sd">   | Personal colour maps are available by saving the map as red green blue </span>
<span class="sd">   | to a file with a set of values on each line. </span>
<span class="sd">   | </span>
<span class="sd">   |  </span>
<span class="sd">   | Use cscale() To reset to the scale1 colour scale</span>
<span class="sd">   |</span>
<span class="sd">   :Returns:</span>
<span class="sd">      None</span>

<span class="sd">   | </span>
<span class="sd">   | </span>
<span class="sd">   | </span>
<span class="sd">   |  </span>
<span class="sd">   &quot;&quot;&quot;</span>   


   <span class="c">#If no map requested reset to default  </span>
   <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">cmap</span><span class="o">=</span><span class="s">&#39;scale1&#39;</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">user_cscale</span><span class="o">=</span><span class="mi">0</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">user_cscale</span><span class="o">=</span><span class="mi">1</span>

   <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s">&#39;scale1&#39;</span> <span class="ow">or</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s">&#39;cosam&#39;</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s">&#39;scale1&#39;</span><span class="p">:</span> <span class="n">myscale</span><span class="o">=</span><span class="n">cscale1</span>
      <span class="k">if</span> <span class="n">cmap</span> <span class="o">==</span> <span class="s">&#39;cosam&#39;</span><span class="p">:</span> <span class="n">myscale</span><span class="o">=</span><span class="n">cosam</span>
      <span class="c">#convert cscale1 or cosam from hex to rgb</span>
      <span class="n">r</span><span class="o">=</span><span class="p">[]</span>
      <span class="n">g</span><span class="o">=</span><span class="p">[]</span>
      <span class="n">b</span><span class="o">=</span><span class="p">[]</span>
      <span class="k">for</span> <span class="n">myhex</span> <span class="ow">in</span> <span class="n">myscale</span><span class="p">:</span>
         <span class="n">myhex</span><span class="o">=</span><span class="n">myhex</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">)</span>
         <span class="n">mylen</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">myhex</span><span class="p">)</span>
         <span class="n">rgb</span><span class="o">=</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">myhex</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">mylen</span><span class="o">/</span><span class="mi">3</span><span class="p">],</span> <span class="mi">16</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">mylen</span><span class="p">,</span> <span class="n">mylen</span><span class="o">/</span><span class="mi">3</span><span class="p">))</span>
         <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
         <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
         <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rgb</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>  


   <span class="k">else</span><span class="p">:</span>
      <span class="kn">import</span> <span class="nn">distutils.sysconfig</span> <span class="kn">as</span> <span class="nn">sysconfig</span>
      <span class="nb">file</span> <span class="o">=</span> <span class="n">sysconfig</span><span class="o">.</span><span class="n">get_python_lib</span><span class="p">()</span><span class="o">+</span><span class="s">&#39;/cfplot/colourmaps/&#39;</span><span class="o">+</span><span class="n">cmap</span><span class="o">+</span><span class="s">&#39;.rgb&#39;</span>
      <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">cscale error - colour scale not found:</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;File &#39;</span><span class="o">+</span><span class="nb">file</span><span class="o">+</span> <span class="s">&#39; not found</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="n">errstr</span><span class="o">=</span><span class="n">errstr</span><span class="o">+</span><span class="s">&#39;File &#39;</span><span class="o">+</span><span class="n">cmap</span><span class="o">+</span><span class="s">&#39; not found</span><span class="se">\n</span><span class="s">&#39;</span>
            <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>  
         <span class="k">else</span><span class="p">:</span>
            <span class="nb">file</span><span class="o">=</span><span class="n">cmap</span>

      <span class="c">#Read in rgb values and convert to hex</span>
      <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s">&#39;r&#39;</span><span class="p">)</span>
      <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
      <span class="n">lines</span> <span class="o">=</span> <span class="n">lines</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>
      <span class="n">r</span><span class="o">=</span><span class="p">[]</span>
      <span class="n">g</span><span class="o">=</span><span class="p">[]</span>
      <span class="n">b</span><span class="o">=</span><span class="p">[]</span>
      <span class="nb">hex</span><span class="o">=</span><span class="p">[]</span>
      <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">:</span>
          <span class="n">vals</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
          <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
          <span class="n">g</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
          <span class="n">b</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">vals</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>



   <span class="c">#Interpolate to a new number of colours if requested</span>
   <span class="k">if</span> <span class="n">ncols</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
      <span class="n">xnew</span><span class="o">=</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">ncols</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ncols</span><span class="p">)</span>
      <span class="n">f_red</span><span class="o">=</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
      <span class="n">f_green</span><span class="o">=</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>    
      <span class="n">f_blue</span><span class="o">=</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>     
      <span class="n">r</span><span class="o">=</span><span class="n">f_red</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
      <span class="n">g</span><span class="o">=</span><span class="n">f_green</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
      <span class="n">b</span><span class="o">=</span><span class="n">f_blue</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>



   <span class="c">#Change the number of colours below and above the mid-point if requested</span>
   <span class="k">if</span> <span class="n">below</span> <span class="o">!=</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">above</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>

      <span class="c">#Mid-point of colour scale</span>
      <span class="n">npoints</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>

      
      <span class="c">#Below mid point x locations</span>
      <span class="n">x_below</span><span class="o">=</span><span class="p">[]</span>
      <span class="n">lower</span><span class="o">=</span><span class="mi">0</span>
      <span class="k">if</span> <span class="n">below</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">x_below</span><span class="o">=</span><span class="mi">0</span>     
      <span class="k">if</span> <span class="n">below</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> <span class="n">lower</span><span class="o">=</span><span class="n">below</span>
      <span class="k">if</span> <span class="n">below</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">lower</span><span class="o">=</span><span class="n">npoints</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">lower</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span> <span class="n">x_below</span><span class="o">=</span><span class="p">((</span><span class="n">npoints</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">lower</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">lower</span><span class="p">)</span>

    
      <span class="c">#Above mid point x locations      </span>
      <span class="n">x_above</span><span class="o">=</span><span class="p">[]</span>
      <span class="n">upper</span><span class="o">=</span><span class="mi">0</span>
      <span class="k">if</span> <span class="n">above</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="n">x_above</span><span class="o">=</span><span class="n">npoints</span><span class="o">*</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span>
      <span class="k">if</span> <span class="n">above</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span> <span class="n">upper</span><span class="o">=</span><span class="n">above</span>
      <span class="k">if</span> <span class="n">above</span> <span class="o">==</span> <span class="bp">None</span><span class="p">:</span> <span class="n">upper</span><span class="o">=</span><span class="n">npoints</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">upper</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">):</span> <span class="n">x_above</span><span class="o">=</span><span class="p">((</span><span class="n">npoints</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">upper</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">upper</span><span class="p">)</span><span class="o">+</span><span class="n">npoints</span>


      <span class="c">#Append new colour positions</span>
      <span class="n">xnew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_below</span><span class="p">,</span> <span class="n">x_above</span><span class="p">)</span>


      <span class="c">#Interpolate to new colour scale</span>
      <span class="n">xpts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>
      <span class="n">f_red</span><span class="o">=</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">r</span> <span class="p">)</span>
      <span class="n">f_green</span><span class="o">=</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>    
      <span class="n">f_blue</span><span class="o">=</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> 
      <span class="n">r</span><span class="o">=</span><span class="n">f_red</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
      <span class="n">g</span><span class="o">=</span><span class="n">f_green</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>
      <span class="n">b</span><span class="o">=</span><span class="n">f_blue</span><span class="p">(</span><span class="n">xnew</span><span class="p">)</span>  
 





   <span class="c">#Convert to hex</span>
   <span class="nb">hex</span><span class="o">=</span><span class="p">[]</span>   
   <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span>  <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">r</span><span class="p">)):</span>
      <span class="nb">hex</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;#</span><span class="si">%02x%02x%02x</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">col</span><span class="p">],</span><span class="n">g</span><span class="p">[</span><span class="n">col</span><span class="p">],</span><span class="n">b</span><span class="p">[</span><span class="n">col</span><span class="p">]))</span>    
     
         
   <span class="c">#White requested colour positions    </span>
   <span class="k">if</span> <span class="n">white</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">:</span>
      <span class="n">ccols</span><span class="o">=</span><span class="n">white</span>
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">white</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>   
          <span class="nb">hex</span><span class="p">[</span><span class="n">white</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;#ffffff&#39;</span>  
      <span class="k">else</span><span class="p">:</span>
         <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">white</span><span class="p">:</span>
            <span class="nb">hex</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">=</span><span class="s">&#39;#ffffff&#39;</span>  
  
  
   <span class="c">#Set colour scale </span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="o">=</span><span class="nb">hex</span>

</div>
<div class="viewcode-block" id="cscale_get_map"><a class="viewcode-back" href="../cscale_get_map.html#cfplot.cscale_get_map">[docs]</a><span class="k">def</span> <span class="nf">cscale_get_map</span><span class="p">():</span>
   <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">   | cscale_get_map - return colour map for use in contour plots.  </span>
<span class="sd">   |                   This depends on the colour bar extensions</span>
<span class="sd">   | This is an internal routine and is not used by the user. </span>
<span class="sd">   |</span>
<span class="sd">   |</span>
<span class="sd">   :Returns:</span>
<span class="sd">       colour map</span>

<span class="sd">   | </span>
<span class="sd">   | </span>
<span class="sd">   | </span>
<span class="sd">   |  </span>
<span class="sd">   &quot;&quot;&quot;</span>   
   <span class="n">cscale_ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span><span class="p">):</span> <span class="n">colmap</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="n">cscale_ncols</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   
   <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;min&#39;</span><span class="p">):</span> <span class="n">colmap</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>   
   <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span><span class="p">):</span> <span class="n">colmap</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[:</span><span class="n">cscale_ncols</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>   
   <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;neither&#39;</span><span class="p">):</span> <span class="n">colmap</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span>  
   <span class="k">return</span> <span class="p">(</span><span class="n">colmap</span><span class="p">)</span>


</div>
<div class="viewcode-block" id="bfill"><a class="viewcode-back" href="../bfill.html#cfplot.bfill">[docs]</a><span class="k">def</span> <span class="nf">bfill</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">clevs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    | bfill - block fill a field with colour rectangles</span>
<span class="sd">    | This is an internal routine and is not used by the user.</span>
<span class="sd">    | </span>
<span class="sd">    | f=None - field</span>
<span class="sd">    | x=None - x points for field</span>
<span class="sd">    | y=None - y points for field </span>
<span class="sd">    | clevs=None - levels for filling</span>
<span class="sd">    | lonlat=False - lonlat data</span>
<span class="sd">    | bound=False - x and y are cf data boundaries</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    :Returns:</span>
<span class="sd">       None</span>
<span class="sd">    |  </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    |</span>
<span class="sd">   &quot;&quot;&quot;</span>


   <span class="c">#Assign f to field as this may be modified in lat-lon plots</span>
   <span class="n">field</span><span class="o">=</span><span class="n">f</span>
 
   <span class="c">#Add in extra levels for colour bar extensions if present.</span>
   <span class="n">levs</span><span class="o">=</span><span class="n">clevs</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span><span class="p">):</span>
      <span class="n">levs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">levs</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1e30</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span><span class="p">):</span>
      <span class="n">levs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">levs</span><span class="p">,</span> <span class="mf">1e30</span><span class="p">)</span>



   <span class="k">if</span> <span class="n">bound</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">xpts</span><span class="o">=</span><span class="n">x</span>
      <span class="n">ypts</span><span class="o">=</span><span class="n">y</span>

      
      <span class="c">#print &#39;xpts are &#39;, xpts</span>
      <span class="c">#print &#39;&#39;</span>
      <span class="c">#print &#39;ypts are &#39;, ypts</span>
      <span class="c">#print &#39;&#39;</span>
      <span class="c">#print &#39;shape of data is &#39;, np.shape(f)</span>
      <span class="c">#print &#39;shape of x , y are &#39;, np.shape(x), np.shape(y)</span>

   <span class="k">if</span> <span class="n">bound</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
      <span class="c">#Find x box boundaries</span>
      <span class="n">xpts</span><span class="o">=</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>
      <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> 
         <span class="n">xpts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
      <span class="n">xpts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">ix</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> 


      <span class="c">#Find y box boundaries</span>
      <span class="n">ypts</span><span class="o">=</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span>
      <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span> 
         <span class="n">ypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span>
      <span class="n">ypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">y</span><span class="p">[</span><span class="n">iy</span><span class="p">])</span><span class="o">/</span><span class="mf">2.0</span><span class="p">)</span> 



   <span class="c">#Shift lon grid if needed</span>
   <span class="k">if</span> <span class="n">lonlat</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>

      <span class="c">#Extract upper bound and original rhs of box longitude bounding points</span>
      <span class="n">upper_bound</span><span class="o">=</span><span class="n">ypts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">xpts_orig</span><span class="o">=</span><span class="n">xpts</span>
      <span class="n">ypts_orig</span><span class="o">=</span><span class="n">ypts</span>
      
      <span class="c">#Reduce xpts and ypts by 1 or shiftgrid fails</span>
      <span class="c">#The last points are the right / upper bounds for the last data box</span>
      <span class="n">xpts</span><span class="o">=</span><span class="n">xpts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
      <span class="n">ypts</span><span class="o">=</span><span class="n">ypts</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span> <span class="n">xpts</span><span class="o">=</span><span class="n">xpts</span><span class="o">-</span><span class="mi">360</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span> <span class="n">xpts</span><span class="o">=</span><span class="n">xpts</span><span class="o">+</span><span class="mi">360</span>

      <span class="c">#Add cyclic information if missing.</span>
      <span class="n">lonrange</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
         <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span> <span class="o">=</span> <span class="n">addcyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span>

      <span class="c">#shiftgrid on lons and data</span>
      <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="o">=</span><span class="n">shiftgrid</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span> 

      <span class="n">right_bound</span><span class="o">=</span><span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="p">(</span><span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xpts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>

      <span class="c">#Add end x and y end points</span>
      <span class="n">xpts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">right_bound</span><span class="p">)</span>
      <span class="n">ypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ypts</span><span class="p">,</span> <span class="n">upper_bound</span><span class="p">)</span>


   <span class="c">#Make plot</span>
   <span class="c">#Set colour map</span>
   <span class="n">cmin</span><span class="o">=</span><span class="mi">0</span>
   <span class="n">cmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span><span class="p">):</span> <span class="n">cmin</span><span class="o">=</span><span class="mi">1</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span><span class="p">):</span> <span class="n">cmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>

   <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="n">cmin</span><span class="p">:</span><span class="n">cmax</span><span class="p">])</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;min&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span><span class="p">):</span>
      <span class="n">cmap</span><span class="o">.</span><span class="n">set_under</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;max&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">levels_extend</span> <span class="o">==</span> <span class="s">&#39;both&#39;</span><span class="p">):</span>
      <span class="n">cmap</span><span class="o">.</span><span class="n">set_over</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>

   <span class="n">norm</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">BoundaryNorm</span><span class="p">(</span><span class="n">clevs</span><span class="p">,</span> <span class="n">ncolors</span><span class="o">=</span><span class="n">cmap</span><span class="o">.</span><span class="n">N</span><span class="p">,</span> <span class="n">clip</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
   <span class="n">im</span> <span class="o">=</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">pcolormesh</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">norm</span><span class="o">=</span><span class="n">norm</span><span class="p">)</span>

   





</div>
<div class="viewcode-block" id="regrid"><a class="viewcode-back" href="../regrid.html#cfplot.regrid">[docs]</a><span class="k">def</span> <span class="nf">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lonlat</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | regrid - bilinear interpolation of a grid to new grid locations</span>
<span class="sd">    | </span>
<span class="sd">    |  </span>
<span class="sd">    |     f=None - original field</span>
<span class="sd">    |     x=None - original field x values</span>
<span class="sd">    |     y=None - original field y values</span>
<span class="sd">    |     xnew=None - new x points</span>
<span class="sd">    |     ynew=None - new y points</span>
<span class="sd">    | </span>
<span class="sd">    :Returns:</span>
<span class="sd">       field values at requested locations</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>

   <span class="c">#reassign input arrays</span>
   <span class="n">regrid_f</span><span class="o">=</span><span class="n">f</span>
   <span class="n">regrid_x</span><span class="o">=</span><span class="n">x</span>
   <span class="n">regrid_y</span><span class="o">=</span><span class="n">y</span>

   <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

   <span class="n">fieldout</span><span class="o">=</span><span class="p">[]</span>

   <span class="c">#Reverse xpts and field if necessary</span>
   <span class="k">if</span> <span class="n">regrid_x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">regrid_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
      <span class="n">regrid_x</span><span class="o">=</span><span class="n">regrid_x</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>            
      <span class="n">field</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">fliplr</span><span class="p">(</span><span class="n">regrid_f</span><span class="p">)</span>

   <span class="c">#Reverse ypts and field if necessary</span>
   <span class="k">if</span> <span class="n">regrid_y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">regrid_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
      <span class="n">regrid_y</span><span class="o">=</span><span class="n">regrid_y</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>         
      <span class="n">regrid_f</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">regrid_f</span><span class="p">)</span>

   <span class="c">#Iterate over the new grid to get the new grid values.</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xnew</span><span class="p">)):</span>

      <span class="n">xval</span><span class="o">=</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
      <span class="n">yval</span><span class="o">=</span><span class="n">ynew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>

      <span class="c">#Find position of new grid point in the x and y arrays</span>
      <span class="n">myxpos</span><span class="o">=</span><span class="n">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">regrid_x</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">xval</span><span class="p">)</span>
      <span class="n">myypos</span><span class="o">=</span><span class="n">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="n">regrid_y</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="n">yval</span><span class="p">)</span> 


      <span class="n">myxpos2</span><span class="o">=</span><span class="n">myxpos</span><span class="o">+</span><span class="mi">1</span>
      <span class="n">myypos2</span><span class="o">=</span><span class="n">myypos</span><span class="o">+</span><span class="mi">1</span>
      

      <span class="k">if</span> <span class="p">(</span><span class="n">myxpos2</span> <span class="o">!=</span> <span class="n">myxpos</span><span class="p">):</span> 
         <span class="n">alpha</span><span class="o">=</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos2</span><span class="p">]</span><span class="o">-</span><span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos</span><span class="p">])</span> 
      <span class="k">else</span><span class="p">:</span> 
         <span class="n">alpha</span><span class="o">=</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">regrid_x</span><span class="p">[</span><span class="n">myxpos</span><span class="p">])</span><span class="o">/</span><span class="mf">1E-30</span>

      <span class="n">newval1</span><span class="o">=</span><span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos</span><span class="p">,</span><span class="n">myxpos</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos</span><span class="p">,</span><span class="n">myxpos</span><span class="p">]</span><span class="o">-</span><span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos</span><span class="p">,</span><span class="n">myxpos2</span><span class="p">])</span><span class="o">*</span><span class="n">alpha</span>
      <span class="n">newval2</span><span class="o">=</span><span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos2</span><span class="p">,</span><span class="n">myxpos</span><span class="p">]</span><span class="o">-</span><span class="p">(</span><span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos2</span><span class="p">,</span><span class="n">myxpos</span><span class="p">]</span><span class="o">-</span><span class="n">regrid_f</span><span class="p">[</span><span class="n">myypos2</span><span class="p">,</span><span class="n">myxpos2</span><span class="p">])</span><span class="o">*</span><span class="n">alpha</span>

      <span class="k">if</span> <span class="p">(</span><span class="n">myypos2</span> <span class="o">!=</span> <span class="n">myypos</span><span class="p">):</span> <span class="n">alpha2</span><span class="o">=</span><span class="p">(</span><span class="n">ynew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos2</span><span class="p">]</span><span class="o">-</span><span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos</span><span class="p">])</span>
      <span class="k">else</span><span class="p">:</span> <span class="n">alpha2</span><span class="o">=</span><span class="p">(</span><span class="n">ynew</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">regrid_y</span><span class="p">[</span><span class="n">myypos</span><span class="p">])</span><span class="o">/</span><span class="mf">1E-30</span>

   
      <span class="n">newval3</span><span class="o">=</span><span class="n">newval1</span><span class="o">-</span><span class="p">(</span><span class="n">newval1</span><span class="o">-</span><span class="n">newval2</span><span class="p">)</span><span class="o">*</span><span class="n">alpha2</span>
  
      <span class="n">fieldout</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fieldout</span><span class="p">,</span> <span class="n">newval3</span><span class="p">)</span>



   <span class="k">return</span> <span class="n">fieldout</span>

</div>
<div class="viewcode-block" id="stipple"><a class="viewcode-back" href="../stipple.html#cfplot.stipple">[docs]</a><span class="k">def</span> <span class="nf">stipple</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">80</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s">&#39;.&#39;</span><span class="p">):</span>
    
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | stipple - put dots on the plot to indicate value of interest</span>
<span class="sd">    | </span>
<span class="sd">    | f=None - cf field or field</span>
<span class="sd">    | x=None - x points for field</span>
<span class="sd">    | y=None - y points for field    </span>
<span class="sd">    | min=None - minimum threshold for stipple</span>
<span class="sd">    | max=None - maximum threshold for stipple</span>
<span class="sd">    | size=80 - default size for stipples</span>
<span class="sd">    | color=&#39;k&#39; - default colour for stipples</span>
<span class="sd">    | pts=50 - number of points in the x direction</span>
<span class="sd">    | marker=&#39;.&#39; - default marker for stipples</span>
<span class="sd">    | </span>
<span class="sd">    |     </span>
<span class="sd">    :Returns:</span>
<span class="sd">       None</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>


   <span class="c">#Extract required data for contouring </span>
   <span class="c">#If a cf-python field</span>
   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
      <span class="n">colorbar_title</span><span class="o">=</span><span class="s">&#39;&#39;</span>
      <span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">time_opts</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span>\
         <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">field</span><span class="o">=</span><span class="n">f</span> <span class="c">#field data passed in as f</span>
      <span class="n">check_data</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
      <span class="n">xpts</span><span class="o">=</span><span class="n">x</span>
      <span class="n">ypts</span><span class="o">=</span><span class="n">y</span>

   

   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="c">#Cylindrical projection</span>
      <span class="c">#Add cyclic information if missing.</span>
      <span class="n">lonrange</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">lonrange</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">:</span>
         <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span> <span class="o">=</span> <span class="n">addcyclic</span><span class="p">(</span><span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span>

      <span class="c">#Shift grid if needed</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span> <span class="n">xpts</span><span class="o">=</span><span class="n">xpts</span><span class="o">-</span><span class="mi">360</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">):</span> <span class="n">xpts</span><span class="o">=</span><span class="n">xpts</span><span class="o">+</span><span class="mi">360</span>

      <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="o">=</span><span class="n">shiftgrid</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">xpts</span><span class="p">)</span>   

      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;cyl&#39;</span><span class="p">:</span>
         <span class="c">#Calculate interpolation points</span>
         <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span> <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>\
                                   <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ypts</span><span class="p">),</span> <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ypts</span><span class="p">),</span> <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
  
         <span class="c">#Calculate points in map space</span>
         <span class="n">xnew_map</span><span class="p">,</span><span class="n">ynew_map</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span><span class="n">ynew</span><span class="p">)</span>



      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;spstere&#39;</span><span class="p">:</span>
         <span class="c">#Calculate interpolation points</span>
         <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">,</span> <span class="n">xnew_map</span><span class="p">,</span> <span class="n">ynew_map</span><span class="o">=</span><span class="n">polar_regular_grid</span><span class="p">()</span>




   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
   <span class="c">#Calculate interpolation points</span>
         
      <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span> <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">),</span>\
                                <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">ypts</span><span class="p">),</span> <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ypts</span><span class="p">),</span> <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>



   <span class="c">#Get values at the new points</span>
   <span class="n">vals</span><span class="o">=</span><span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">field</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">xpts</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">ypts</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>

   <span class="c">#Work out which of the points are valid</span>
   <span class="n">valid_points</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;int32&#39;</span><span class="p">)</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">)):</span>
      <span class="k">if</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span><span class="nb">min</span> <span class="ow">and</span> <span class="n">vals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span><span class="nb">max</span><span class="p">:</span>
         <span class="n">valid_points</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_points</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>


      
   
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xnew_map</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span> <span class="n">ynew_map</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>


   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xnew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span> <span class="n">ynew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span> <span class="n">s</span><span class="o">=</span><span class="n">size</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="n">marker</span><span class="p">)</span>




</div>
<div class="viewcode-block" id="stipple_points"><a class="viewcode-back" href="../stipple_points.html#cfplot.stipple_points">[docs]</a><span class="k">def</span> <span class="nf">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | stipple_points - calculate interpolation points </span>
<span class="sd">    | </span>
<span class="sd">    | xmin=None - plot x minimum</span>
<span class="sd">    | ymax=None - plot x maximum</span>
<span class="sd">    | ymin=None - plot y minimum</span>
<span class="sd">    | ymax=None - plot x maximum</span>
<span class="sd">    | pts=None -  number of points in the x and y directions</span>
<span class="sd">    |             one number gives the same in both directions</span>
<span class="sd">    |             </span>
<span class="sd">    | stype=None - type of grid.  1=regular, 2=offset</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    |     </span>
<span class="sd">    :Returns:</span>
<span class="sd">       stipple locations in x and y</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>      

   <span class="c">#Work out number of points in x and y directions</span>
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">pts_x</span><span class="o">=</span><span class="n">pts</span>
      <span class="n">pts_y</span><span class="o">=</span><span class="n">pts</span>
   <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
      <span class="n">pts_x</span><span class="o">=</span><span class="n">pts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">pts_y</span><span class="o">=</span><span class="n">pts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

   <span class="c">#Create regularly spaced points</span>
   <span class="n">xstep</span><span class="o">=</span><span class="p">(</span><span class="n">xmax</span><span class="o">-</span><span class="n">xmin</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">pts_x</span><span class="p">)</span>
   <span class="n">x1</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="o">+</span><span class="n">xstep</span><span class="o">/</span><span class="mi">4</span><span class="p">]</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="n">xstep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">xmax</span><span class="o">-</span><span class="n">xstep</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
      <span class="n">x1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span><span class="o">+</span><span class="n">xstep</span><span class="p">)</span>
   <span class="n">nxpts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
   
   <span class="n">x2</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="o">+</span><span class="n">xstep</span><span class="o">*</span><span class="mi">3</span><span class="o">/</span><span class="mi">4</span><span class="p">]</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="n">xstep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">xmax</span><span class="o">-</span><span class="n">xstep</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
      <span class="n">x2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="o">+</span><span class="n">xstep</span><span class="p">)</span>

   <span class="n">ystep</span><span class="o">=</span><span class="p">(</span><span class="n">ymax</span><span class="o">-</span><span class="n">ymin</span><span class="p">)</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="n">pts_y</span><span class="p">)</span>
   <span class="n">y1</span><span class="o">=</span><span class="p">[</span><span class="n">ymin</span><span class="o">+</span><span class="n">ystep</span><span class="o">/</span><span class="mi">2</span><span class="p">]</span>
   <span class="k">while</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="n">ystep</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">ymax</span><span class="o">-</span><span class="n">ystep</span><span class="o">/</span><span class="mi">10</span><span class="p">:</span>
      <span class="n">y1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span>  <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">y1</span><span class="p">)</span><span class="o">+</span><span class="n">ystep</span><span class="p">)</span>


   
   <span class="c">#Create interpolation points</span>
   <span class="n">xnew</span><span class="o">=</span><span class="p">[]</span>
   <span class="n">ynew</span><span class="o">=</span><span class="p">[]</span>
   <span class="n">iy</span><span class="o">=</span><span class="mi">0</span>

   <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">y1</span><span class="p">:</span>
      <span class="n">iy</span><span class="o">=</span><span class="n">iy</span><span class="o">+</span><span class="mi">1</span>
      <span class="k">if</span> <span class="n">stype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">xnew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
         <span class="n">y2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x1</span><span class="p">))</span>
         <span class="n">y2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
         <span class="n">ynew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynew</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>

      <span class="k">if</span> <span class="n">stype</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">iy</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
            <span class="n">xnew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">x1</span><span class="p">)</span>
            <span class="n">y2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x1</span><span class="p">))</span>
            <span class="n">y2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ynew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynew</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">iy</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
            <span class="n">xnew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
            <span class="n">y2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">x2</span><span class="p">))</span>
            <span class="n">y2</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
            <span class="n">ynew</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ynew</span><span class="p">,</span> <span class="n">y2</span><span class="p">)</span>
      


   <span class="k">return</span> <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span>



</div>
<div class="viewcode-block" id="find_pos_in_array"><a class="viewcode-back" href="../find_pos_in_array.html#cfplot.find_pos_in_array">[docs]</a><span class="k">def</span> <span class="nf">find_pos_in_array</span><span class="p">(</span><span class="n">vals</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">above</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | find_pos_in_array - find the position of a point in an array </span>
<span class="sd">    | </span>
<span class="sd">    | vals - array values</span>
<span class="sd">    | val - value to find position of</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    :Returns:</span>
<span class="sd">      position in array</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>


   <span class="n">pos</span><span class="o">=-</span><span class="mi">1</span>
   <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">myval</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="n">myval</span><span class="p">:</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span>

   <span class="k">if</span> <span class="n">above</span> <span class="ow">is</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">myval</span> <span class="ow">in</span> <span class="n">vals</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;=</span> <span class="n">myval</span><span class="p">:</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span>

      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span> <span class="o">&gt;</span> <span class="n">pos</span><span class="p">:</span> <span class="n">pos</span><span class="o">=</span><span class="n">pos</span><span class="o">+</span><span class="mi">1</span>

   <span class="k">return</span> <span class="n">pos</span>


</div>
<div class="viewcode-block" id="vect"><a class="viewcode-back" href="../vect.html#cfplot.vect">[docs]</a><span class="k">def</span> <span class="nf">vect</span><span class="p">(</span><span class="n">u</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">v</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>\
         <span class="n">key_length</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">key_label</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ptype</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | vect - plot vectors</span>
<span class="sd">    | </span>
<span class="sd">    | u=None - u wind</span>
<span class="sd">    | v=None - v wind</span>
<span class="sd">    | x=None - x locations of u and v</span>
<span class="sd">    | y=None - y locations of u and v</span>
<span class="sd">    | scale=None - data units per arrow length unit</span>
<span class="sd">    | stride=None - plot vector every stride points. Can take two values</span>
<span class="sd">    |                one for x and one for y</span>
<span class="sd">    | pts=None - use bilinear interpolation to interpolate vectors</span>
<span class="sd">    |            onto a new grid.</span>
<span class="sd">    | key_length=None - length of the key</span>
<span class="sd">    | key_label=None - label for the key</span>
<span class="sd">    | ptype=0 - plot type - not needed for cf fields.</span>
<span class="sd">    |                       0 = no specific plot type,</span>
<span class="sd">    |                       1 = longitude-latitude,</span>
<span class="sd">    |                       2 = latitude - height, </span>
<span class="sd">    |                       3 = longitude - height, </span>
<span class="sd">    |                       4 = latitude - time,</span>
<span class="sd">    |                       5 = longitude - time</span>
<span class="sd">    |                       6 = rotated pole</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     None</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>

   <span class="n">colorbar_title</span><span class="o">=</span><span class="s">&#39;&#39;</span>
   <span class="n">text_fontsize</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span>
   <span class="n">continent_thickness</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span>
   <span class="n">continent_color</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span>
   <span class="k">if</span> <span class="n">text_fontsize</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">text_fontsize</span><span class="o">=</span><span class="mi">11</span>
   <span class="k">if</span> <span class="n">continent_thickness</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">continent_thickness</span><span class="o">=</span><span class="mf">1.5</span>
   <span class="k">if</span> <span class="n">continent_color</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">continent_color</span><span class="o">=</span><span class="s">&#39;k&#39;</span>
   <span class="n">ylog</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ylog</span>

   <span class="c">#Extract required data for contouring</span>
   <span class="c">#If a cf-python field</span>
   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
      <span class="n">u</span><span class="o">=</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span><span class="n">time_opts</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span>\
         <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="c">#field=f #field data passed in as f</span>
      <span class="n">check_data</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
      <span class="n">u_data</span><span class="o">=</span><span class="n">u</span>
      <span class="n">u_x</span><span class="o">=</span><span class="n">x</span>
      <span class="n">u_y</span><span class="o">=</span><span class="n">y</span>
      <span class="n">xlabel</span><span class="o">=</span><span class="s">&#39;&#39;</span>
      <span class="n">ylabel</span><span class="o">=</span><span class="s">&#39;&#39;</span>


   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span>
      <span class="n">v</span><span class="o">=</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
      <span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="p">,</span> <span class="n">ptype</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">,</span> <span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="p">,</span> <span class="n">time_opts</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span>\
         <span class="n">cf_data_assign</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">colorbar_title</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="c">#field=f #field data passed in as f</span>
      <span class="n">check_data</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
      <span class="n">v_data</span><span class="o">=</span><span class="n">v</span>
      <span class="n">v_x</span><span class="o">=</span><span class="n">x</span>
      <span class="n">v_y</span><span class="o">=</span><span class="n">y</span>
      <span class="n">xlabel</span><span class="o">=</span><span class="s">&#39;&#39;</span>
      <span class="n">ylabel</span><span class="o">=</span><span class="s">&#39;&#39;</span>
   

   <span class="k">if</span> <span class="n">scale</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_data</span><span class="p">)</span><span class="o">/</span><span class="mf">4.0</span>
   <span class="k">if</span> <span class="n">key_length</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">key_length</span><span class="o">=</span><span class="n">scale</span>
   <span class="k">if</span> <span class="n">key_label</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">key_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">key_length</span><span class="p">)</span>
   <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cf</span><span class="o">.</span><span class="n">Field</span><span class="p">):</span> <span class="n">key_label</span><span class="o">=</span><span class="n">key_label</span><span class="o">+</span><span class="n">u</span><span class="o">.</span><span class="n">units</span>
   <span class="n">key_label</span><span class="o">=</span><span class="n">supscr</span><span class="p">(</span><span class="n">key_label</span><span class="p">)</span>

   <span class="c">#Open a new plot if necessary</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
      <span class="n">gopen</span><span class="p">(</span><span class="n">user_plot</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

   <span class="c">#Set plot type if user specified</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">ptype</span> <span class="o">!=</span> <span class="bp">None</span><span class="p">):</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span><span class="o">=</span><span class="n">ptype</span>

   
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="c">#Set up mapping</span>
      <span class="n">set_map</span><span class="p">()</span>    
      <span class="n">mymap</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>   
    
      <span class="c">#add cyclic and shift grid </span>
      <span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span> <span class="o">=</span> <span class="n">addcyclic</span><span class="p">(</span><span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span><span class="p">)</span>
      <span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span> <span class="o">=</span> <span class="n">addcyclic</span><span class="p">(</span><span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">):</span> <span class="n">u_x</span><span class="o">=</span><span class="n">u_x</span><span class="o">-</span><span class="mf">360.0</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span> <span class="o">&lt;</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">v_x</span><span class="p">):</span> <span class="n">v_x</span><span class="o">=</span><span class="n">v_x</span><span class="o">-</span><span class="mf">360.0</span>
      <span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span> <span class="o">=</span> <span class="n">shiftgrid</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">u_data</span><span class="p">,</span> <span class="n">u_x</span><span class="p">)</span>
      <span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span> <span class="o">=</span> <span class="n">shiftgrid</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">v_data</span><span class="p">,</span> <span class="n">v_x</span><span class="p">)</span>


   <span class="c">#stride data points to reduce vector density</span>
   <span class="k">if</span> <span class="n">stride</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="n">xstride</span><span class="o">=</span><span class="n">stride</span>
         <span class="n">ystride</span><span class="o">=</span><span class="n">stride</span>
      <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">stride</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
         <span class="n">xstride</span><span class="o">=</span><span class="n">stride</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
         <span class="n">ystride</span><span class="o">=</span><span class="n">stride</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


      <span class="n">iskip</span><span class="o">=</span><span class="mi">1</span>
      <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u_x</span><span class="p">)):</span>
         <span class="k">if</span> <span class="n">iskip</span> <span class="o">!=</span> <span class="n">xstride</span><span class="p">:</span> <span class="n">u_x</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;nan&#39;</span><span class="p">)</span> 
         <span class="n">iskip</span><span class="o">=</span><span class="n">iskip</span><span class="o">+</span><span class="mi">1</span>
         <span class="k">if</span> <span class="n">iskip</span> <span class="o">&gt;</span> <span class="n">xstride</span><span class="p">:</span> <span class="n">iskip</span><span class="o">=</span><span class="mi">1</span>     
      <span class="n">iskip</span><span class="o">=</span><span class="mi">1</span>
      <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">u_y</span><span class="p">)):</span>
         <span class="k">if</span> <span class="n">iskip</span> <span class="o">!=</span> <span class="n">ystride</span><span class="p">:</span> <span class="n">u_y</span><span class="p">[</span><span class="n">iy</span><span class="p">]</span><span class="o">=</span><span class="nb">float</span><span class="p">(</span><span class="s">&#39;nan&#39;</span><span class="p">)</span> 
         <span class="n">iskip</span><span class="o">=</span><span class="n">iskip</span><span class="o">+</span><span class="mi">1</span>
         <span class="k">if</span> <span class="n">iskip</span> <span class="o">&gt;</span> <span class="n">ystride</span><span class="p">:</span> <span class="n">iskip</span><span class="o">=</span><span class="mi">1</span> 

      
   <span class="c">#Use bilinear interpolation to plot vectors</span>
   <span class="k">if</span> <span class="n">pts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">!=</span> <span class="s">&#39;npstere&#39;</span> <span class="ow">and</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">!=</span> <span class="s">&#39;spstere&#39;</span><span class="p">:</span> 
         <span class="c">#Calculate interpolation points and values</span>
         <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span>\
                                   <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

         <span class="n">u_vals</span><span class="o">=</span><span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">u_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>
         <span class="n">v_vals</span><span class="o">=</span><span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">v_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>

         <span class="c">#Plot vectors</span>
         <span class="n">quiv</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span><span class="n">ynew</span><span class="p">,</span><span class="n">u_vals</span><span class="p">,</span><span class="n">v_vals</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="s">&#39;middle&#39;</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;inches&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="c">#Calculate interpolation points and values</span>
         <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">,</span> <span class="n">xnew_map</span><span class="p">,</span> <span class="n">ynew_map</span><span class="o">=</span><span class="n">polar_regular_grid</span><span class="p">()</span>

         <span class="n">u_vals</span><span class="o">=</span><span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">u_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>
         <span class="n">v_vals</span><span class="o">=</span><span class="n">regrid</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">v_data</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">xnew</span><span class="o">=</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="o">=</span><span class="n">ynew</span><span class="p">)</span>



         <span class="c">#Plot vectors</span>
         <span class="n">quiv</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">xnew_map</span><span class="p">,</span><span class="n">ynew_map</span><span class="p">,</span><span class="n">u_vals</span><span class="p">,</span><span class="n">v_vals</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="s">&#39;middle&#39;</span><span class="p">,</span>\
                                    <span class="n">units</span><span class="o">=</span><span class="s">&#39;inches&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>


      <span class="n">quiv_key</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="n">quiv</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">key_length</span><span class="p">,</span> <span class="n">key_label</span><span class="p">,</span> <span class="n">labelpos</span><span class="o">=</span><span class="s">&#39;W&#39;</span><span class="p">)</span>

   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">pts</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
         <span class="c">#convert lons, lats into map coordinates</span>
         <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="p">(</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">))</span>

         <span class="c">#plot vectors and key</span>
         <span class="n">quiv</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">u_x</span><span class="p">,</span><span class="n">u_y</span><span class="p">,</span><span class="n">u_data</span><span class="p">,</span><span class="n">v_data</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="s">&#39;middle&#39;</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;inches&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
         <span class="n">quiv_key</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="n">quiv</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">key_length</span><span class="p">,</span> <span class="n">key_label</span><span class="p">,</span> <span class="n">labelpos</span><span class="o">=</span><span class="s">&#39;W&#39;</span><span class="p">)</span>



      <span class="c">#axes</span>
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;cyl&#39;</span><span class="p">:</span>
         <span class="n">lonticks</span><span class="p">,</span><span class="n">lonlabels</span><span class="o">=</span><span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
         <span class="n">latticks</span><span class="p">,</span><span class="n">latlabels</span><span class="o">=</span><span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
         <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">lonticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">lonlabels</span><span class="p">)</span>
         <span class="n">axes_plot</span><span class="p">(</span><span class="n">yticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">)</span>
   
      <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;npstere&#39;</span> <span class="ow">or</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;spstere&#39;</span><span class="p">:</span> 
         <span class="n">latstep</span><span class="o">=</span><span class="mi">30</span>
         <span class="k">if</span> <span class="mi">90</span><span class="o">-</span><span class="nb">abs</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">:</span> <span class="n">latstep</span><span class="o">=</span><span class="mi">10</span>
         <span class="n">mymap</span><span class="o">.</span><span class="n">drawparallels</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">120</span><span class="p">,</span><span class="n">latstep</span><span class="p">))</span>
         <span class="n">mymap</span><span class="o">.</span><span class="n">drawmeridians</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">420</span><span class="p">,</span><span class="mi">60</span><span class="p">),</span><span class="n">labels</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span> 


      <span class="c">#Coastlines and title</span>
      <span class="n">mymap</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">continent_color</span><span class="p">)</span>
      <span class="c">#plotvars.plot.set_title(title, y=1.03, fontsize=plotvars.fontsize)</span>



      
   <span class="c">#Zonal plot</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">plot_type</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span> 
      <span class="c">#and plotvars.user_plot == 0:</span>
      <span class="n">user_gset</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">user_gset</span>
      <span class="k">if</span> <span class="n">user_gset</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
         <span class="c">#Program selected data plot limits</span>
         <span class="n">xmin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">xmin</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">80</span> <span class="ow">and</span> <span class="n">xmin</span> <span class="o">&gt;=</span> <span class="o">-</span><span class="mi">90</span><span class="p">:</span> <span class="n">xmin</span><span class="o">=-</span><span class="mi">90</span>
         <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_x</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">xmax</span> <span class="o">&gt;</span> <span class="mi">80</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">&lt;=</span> <span class="mi">90</span><span class="p">:</span> <span class="n">xmax</span><span class="o">=</span><span class="mi">90</span> 
         <span class="n">ymin</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span>
         <span class="k">if</span> <span class="n">ymin</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">:</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span>
         <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">u_y</span><span class="p">)</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="c">#User specified plot limits</span>
         <span class="n">xmin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmin</span>
         <span class="n">xmax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">xmax</span>
         <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span> <span class="o">&lt;</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span><span class="p">:</span> 
            <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>
            <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">ymin</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymax</span>
            <span class="n">ymax</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">ymin</span>


      <span class="n">xstep</span><span class="o">=</span><span class="bp">None</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">xmin</span> <span class="o">==</span> <span class="o">-</span><span class="mi">90</span> <span class="ow">and</span> <span class="n">xmax</span> <span class="o">==</span> <span class="mi">90</span><span class="p">):</span> <span class="n">xstep</span><span class="o">=</span><span class="mi">30</span>
      <span class="n">ystep</span><span class="o">=</span><span class="bp">None</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">):</span> <span class="n">ystep</span><span class="o">=</span><span class="mi">100</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">==</span> <span class="mi">100000</span><span class="p">):</span> <span class="n">ystep</span><span class="o">=</span><span class="mi">10000</span>

      <span class="n">ytype</span><span class="o">=</span><span class="mi">0</span> <span class="c">#pressure or similar y axis</span>
      <span class="k">if</span> <span class="s">&#39;theta&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">):</span> <span class="n">ytype</span><span class="o">=</span><span class="mi">1</span>
      <span class="k">if</span> <span class="s">&#39;height&#39;</span> <span class="ow">in</span> <span class="n">ylabel</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">):</span> 
         <span class="n">ytype</span><span class="o">=</span><span class="mi">1</span>
         <span class="n">ystep</span><span class="o">=</span><span class="mi">100</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">5000</span><span class="p">:</span> <span class="n">ystep</span><span class="o">=</span><span class="mf">500.0</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">:</span> <span class="n">ystep</span><span class="o">=</span><span class="mf">1000.0</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">ymax</span> <span class="o">-</span> <span class="n">ymin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50000</span><span class="p">:</span> <span class="n">ystep</span><span class="o">=</span><span class="mf">10000.0</span>

      <span class="c">#Set plot limits and draw axes</span>
      <span class="k">if</span> <span class="n">ylog</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>   
         <span class="k">if</span> <span class="n">ytype</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> 
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
            <span class="n">latticks</span><span class="p">,</span><span class="n">latlabels</span><span class="o">=</span><span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">,</span>\
                 <span class="n">yticks</span><span class="o">=</span><span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>\
                 <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span> 
            <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
            <span class="n">latticks</span><span class="p">,</span><span class="n">latlabels</span><span class="o">=</span><span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">,</span>\
                 <span class="n">yticks</span><span class="o">=</span><span class="n">gvals</span><span class="p">(</span><span class="n">dmin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">dmax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">mystep</span><span class="o">=</span><span class="n">ystep</span><span class="p">,</span> <span class="n">mod</span><span class="o">=</span><span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>\
                 <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>  

      <span class="c">#Log y axis </span>
      <span class="k">if</span> <span class="n">ylog</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
         <span class="k">if</span> <span class="n">ymin</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">1</span>
         <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ylog</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="n">user_gset</span><span class="p">)</span>
         <span class="n">latticks</span><span class="p">,</span><span class="n">latlabels</span><span class="o">=</span><span class="n">mapaxis</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
         <span class="n">axes_plot</span><span class="p">(</span><span class="n">xticks</span><span class="o">=</span><span class="n">latticks</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">latlabels</span><span class="p">,</span>\
              <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">)</span>


      <span class="c">#plot vectors and key</span>
      <span class="n">quiv</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiver</span><span class="p">(</span><span class="n">u_x</span><span class="p">,</span><span class="n">u_y</span><span class="p">,</span><span class="n">u_data</span><span class="p">,</span><span class="n">v_data</span><span class="p">,</span> <span class="n">pivot</span><span class="o">=</span><span class="s">&#39;middle&#39;</span><span class="p">,</span><span class="n">units</span><span class="o">=</span><span class="s">&#39;inches&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
      <span class="n">quiv_key</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">quiverkey</span><span class="p">(</span><span class="n">quiv</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.06</span><span class="p">,</span> <span class="n">key_length</span><span class="p">,</span> <span class="n">key_label</span><span class="p">,</span> <span class="n">labelpos</span><span class="o">=</span><span class="s">&#39;W&#39;</span><span class="p">)</span>



   <span class="c">##########</span>
   <span class="c">#Save plot</span>
   <span class="c">##########</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">user_plot</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
      <span class="n">gset</span><span class="p">()</span>
      <span class="n">cscale</span><span class="p">()</span>
      <span class="n">gclose</span><span class="p">()</span>
  
</div>
<div class="viewcode-block" id="set_map"><a class="viewcode-back" href="../set_map.html#cfplot.set_map">[docs]</a><span class="k">def</span> <span class="nf">set_map</span><span class="p">():</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | set_map - set map and write into plotvars.mymap</span>
<span class="sd">    | </span>
<span class="sd">    | No inputs</span>
<span class="sd">    | This is an internal routine and not used by the user </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     None</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>
   
   <span class="c">#Set up mapping</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;cyl&#39;</span><span class="p">:</span>   
      <span class="n">lon_mid</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="o">+</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="o">-</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
      <span class="n">lat_mid</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="o">+</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="o">-</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span>
      <span class="n">mymap</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s">&#39;cyl&#39;</span><span class="p">,</span><span class="n">llcrnrlon</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmin</span><span class="p">,</span> <span class="n">urcrnrlon</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lonmax</span><span class="p">,</span> \
                      <span class="n">llcrnrlat</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmin</span><span class="p">,</span> <span class="n">urcrnrlat</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">latmax</span><span class="p">,</span> \
                      <span class="n">lon_0</span><span class="o">=</span><span class="n">lon_mid</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="n">lat_mid</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>  
 
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;npstere&#39;</span><span class="p">:</span>
      <span class="n">mymap</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s">&#39;npstere&#39;</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="s">&#39;True&#39;</span><span class="p">,</span>\
                      <span class="n">lon_0</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>

   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;spstere&#39;</span><span class="p">:</span>
      <span class="n">mymap</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s">&#39;spstere&#39;</span><span class="p">,</span> <span class="n">boundinglat</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="s">&#39;True&#39;</span><span class="p">,</span>\
                      <span class="n">lon_0</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span> <span class="n">lat_0</span><span class="o">=-</span><span class="mi">90</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>

   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;moll&#39;</span><span class="p">:</span>
      <span class="n">mymap</span> <span class="o">=</span> <span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s">&#39;moll&#39;</span><span class="p">,</span> <span class="n">lon_0</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>

   <span class="c">#Store map </span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span><span class="o">=</span><span class="n">mymap</span>


</div>
<div class="viewcode-block" id="polar_regular_grid"><a class="viewcode-back" href="../polar_regular_grid.html#cfplot.polar_regular_grid">[docs]</a><span class="k">def</span> <span class="nf">polar_regular_grid</span><span class="p">(</span><span class="n">pts</span><span class="o">=</span><span class="mi">50</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | polar_regular_grid - return a regular grid over a polar stereographic area</span>
<span class="sd">    | </span>
<span class="sd">    | pts=50 - number  of grid points in the x and y directions</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     lons, lats of grid in degrees</span>
<span class="sd">     x, y locations of lons and lats</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>


   <span class="n">mymap</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">mymap</span>

   <span class="n">boundinglat</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">boundinglat</span>
   <span class="n">lon_0</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">lon_0</span>

   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;npstere&#39;</span><span class="p">:</span>
      <span class="n">x</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">mymap</span><span class="p">(</span><span class="n">lon_0</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">)</span>
      <span class="n">x</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">mymap</span><span class="p">(</span><span class="n">lon_0</span><span class="o">+</span><span class="mi">180</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;spstere&#39;</span><span class="p">:</span>
      <span class="n">x</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">mymap</span><span class="p">(</span><span class="n">lon_0</span><span class="o">+</span><span class="mi">180</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">)</span>
      <span class="n">x</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">mymap</span><span class="p">(</span><span class="n">lon_0</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">)</span>
   <span class="n">xmin</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">mymap</span><span class="p">(</span><span class="n">lon_0</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">)</span>
   <span class="n">xmax</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">mymap</span><span class="p">(</span><span class="n">lon_0</span><span class="o">+</span><span class="mi">90</span><span class="p">,</span> <span class="n">boundinglat</span><span class="p">)</span>




   <span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span> <span class="o">=</span> <span class="n">stipple_points</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">ymax</span><span class="p">,</span> <span class="n">pts</span><span class="o">=</span><span class="n">pts</span><span class="p">,</span> <span class="n">stype</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
   <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">mymap</span><span class="p">(</span><span class="n">xnew</span><span class="p">,</span> <span class="n">ynew</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

   <span class="c">#Work out which of the points are valid</span>
   <span class="n">valid_points</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="s">&#39;int32&#39;</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;npstere&#39;</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)):</span>
         <span class="k">if</span> <span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">boundinglat</span> <span class="p">:</span>
            <span class="n">valid_points</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_points</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">proj</span> <span class="o">==</span> <span class="s">&#39;spstere&#39;</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">)):</span>
         <span class="k">if</span> <span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">boundinglat</span> <span class="p">:</span>
            <span class="n">valid_points</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">valid_points</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>


   <span class="k">return</span> <span class="n">lons</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span> <span class="n">lats</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span> <span class="n">xnew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">],</span> <span class="n">ynew</span><span class="p">[</span><span class="n">valid_points</span><span class="p">]</span>


</div>
<div class="viewcode-block" id="cf_var_name"><a class="viewcode-back" href="../cf_var_name.html#cfplot.cf_var_name">[docs]</a><span class="k">def</span> <span class="nf">cf_var_name</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | cf_var_name - return the name from a supplied dimension</span>
<span class="sd">    |               in the following order</span>
<span class="sd">    |               ncvar</span>
<span class="sd">    |               short_name</span>
<span class="sd">    |               long_name</span>
<span class="sd">    |               standard_name</span>
<span class="sd">    | </span>
<span class="sd">    | field=None - field</span>
<span class="sd">    | dim=None - dimension required - &#39;dim0&#39;, &#39;dim1&#39; etc.</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     name</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>


   <span class="n">ncvar</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s">&#39;ncvar&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
   <span class="n">short_name</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s">&#39;short_name&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
   <span class="n">long_name</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s">&#39;long_name&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
   <span class="n">standard_name</span><span class="o">=</span><span class="nb">getattr</span><span class="p">(</span><span class="n">field</span><span class="o">.</span><span class="n">item</span><span class="p">(</span><span class="n">dim</span><span class="p">),</span> <span class="s">&#39;standard_name&#39;</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>

   <span class="k">if</span> <span class="n">ncvar</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="n">ncvar</span> 
   <span class="k">if</span> <span class="n">short_name</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="n">short_name</span>
   <span class="k">if</span> <span class="n">long_name</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="n">long_name</span>
   <span class="k">if</span> <span class="n">standard_name</span><span class="p">:</span> <span class="n">name</span><span class="o">=</span><span class="n">standard_name</span>

   <span class="k">return</span> <span class="n">name</span>


</div>
<div class="viewcode-block" id="process_color_scales"><a class="viewcode-back" href="../process_color_scales.html#cfplot.process_color_scales">[docs]</a><span class="k">def</span> <span class="nf">process_color_scales</span><span class="p">():</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | Process colour scales to generate images of them for the web</span>
<span class="sd">    | documentation and the rst code for inclusion in the </span>
<span class="sd">    | colour_scale.rst file.</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    | No inputs</span>
<span class="sd">    | This is an internal routine and not used by the user </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     None</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">   &quot;&quot;&quot;</span>
   
   <span class="c">#Define scale categories</span>
   <span class="n">ncl_large</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;amwg256&#39;</span><span class="p">,</span> <span class="s">&#39;BkBlAqGrYeOrReViWh200&#39;</span><span class="p">,</span> <span class="s">&#39;BlAqGrYeOrRe&#39;</span><span class="p">,</span> <span class="s">&#39;BlAqGrYeOrReVi200&#39;</span><span class="p">,</span>\
              <span class="s">&#39;BlGrYeOrReVi200&#39;</span><span class="p">,</span> <span class="s">&#39;BlRe&#39;</span><span class="p">,</span> <span class="s">&#39;BlueRed&#39;</span><span class="p">,</span> <span class="s">&#39;BlueRedGray&#39;</span><span class="p">,</span> <span class="s">&#39;BlueWhiteOrangeRed&#39;</span><span class="p">,</span>\
              <span class="s">&#39;BlueYellowRed&#39;</span><span class="p">,</span> <span class="s">&#39;BlWhRe&#39;</span><span class="p">,</span> <span class="s">&#39;cmp_b2r&#39;</span><span class="p">,</span>\
              <span class="s">&#39;cmp_haxby&#39;</span><span class="p">,</span> <span class="s">&#39;detail&#39;</span><span class="p">,</span> <span class="s">&#39;extrema&#39;</span><span class="p">,</span> <span class="s">&#39;GrayWhiteGray&#39;</span><span class="p">,</span><span class="s">&#39;GreenYellow&#39;</span><span class="p">,</span>\
              <span class="s">&#39;helix&#39;</span><span class="p">,</span> <span class="s">&#39;helix1&#39;</span><span class="p">,</span> <span class="s">&#39;hotres&#39;</span><span class="p">,</span> <span class="s">&#39;matlab_hot&#39;</span><span class="p">,</span> <span class="s">&#39;matlab_hsv&#39;</span><span class="p">,</span> <span class="s">&#39;matlab_jet&#39;</span><span class="p">,</span>\
              <span class="s">&#39;matlab_lines&#39;</span><span class="p">,</span> <span class="s">&#39;ncl_default&#39;</span><span class="p">,</span> <span class="s">&#39;ncview_default&#39;</span><span class="p">,</span> <span class="s">&#39;OceanLakeLandSnow&#39;</span><span class="p">,</span>\
              <span class="s">&#39;rainbow&#39;</span><span class="p">,</span> <span class="s">&#39;rainbow+white+gray&#39;</span><span class="p">,</span>  <span class="s">&#39;rainbow+white&#39;</span><span class="p">,</span><span class="s">&#39;rainbow+gray&#39;</span><span class="p">,</span>\
              <span class="s">&#39;tbr_240-300&#39;</span><span class="p">,</span> <span class="s">&#39;tbr_stdev_0-30&#39;</span><span class="p">,</span> <span class="s">&#39;tbr_var_0-500&#39;</span><span class="p">,</span> <span class="s">&#39;tbrAvg1&#39;</span><span class="p">,</span>\
              <span class="s">&#39;tbrStd1&#39;</span><span class="p">,</span> <span class="s">&#39;tbrVar1&#39;</span><span class="p">,</span> <span class="s">&#39;thelix&#39;</span><span class="p">,</span> <span class="s">&#39;ViBlGrWhYeOrRe&#39;</span><span class="p">,</span>\
              <span class="s">&#39;wh-bl-gr-ye-re&#39;</span><span class="p">,</span> <span class="s">&#39;WhBlGrYeRe&#39;</span><span class="p">,</span> <span class="s">&#39;WhBlReWh&#39;</span><span class="p">,</span> <span class="s">&#39;WhiteBlue&#39;</span><span class="p">,</span>\
              <span class="s">&#39;WhiteBlueGreenYellowRed&#39;</span><span class="p">,</span> <span class="s">&#39;WhiteGreen&#39;</span><span class="p">,</span> <span class="s">&#39;WhiteYellowOrangeRed&#39;</span><span class="p">,</span>\
              <span class="s">&#39;WhViBlGrYeOrRe&#39;</span><span class="p">,</span> <span class="s">&#39;WhViBlGrYeOrReWh&#39;</span><span class="p">,</span> <span class="s">&#39;wxpEnIR&#39;</span><span class="p">,</span> <span class="s">&#39;3gauss&#39;</span><span class="p">,</span> <span class="s">&#39;3saw&#39;</span><span class="p">]</span>

   <span class="n">ncl_meteoswiss</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;hotcold_18lev&#39;</span><span class="p">,</span> <span class="s">&#39;hotcolr_19lev&#39;</span><span class="p">,</span> <span class="s">&#39;mch_default&#39;</span><span class="p">,</span> <span class="s">&#39;perc2_9lev&#39;</span><span class="p">,</span> <span class="s">&#39;percent_11lev&#39;</span><span class="p">,</span>\
                   <span class="s">&#39;precip2_15lev&#39;</span><span class="p">,</span> <span class="s">&#39;precip2_17lev&#39;</span><span class="p">,</span> <span class="s">&#39;precip3_16lev&#39;</span><span class="p">,</span> <span class="s">&#39;precip4_11lev&#39;</span><span class="p">,</span> \
                   <span class="s">&#39;precip4_diff_19lev&#39;</span><span class="p">,</span> <span class="s">&#39;precip_11lev&#39;</span><span class="p">,</span> <span class="s">&#39;precip_diff_12lev&#39;</span><span class="p">,</span> <span class="s">&#39;precip_diff_1lev&#39;</span><span class="p">,</span>\
                   <span class="s">&#39;rh_19lev&#39;</span><span class="p">,</span> <span class="s">&#39;spread_15lev&#39;</span><span class="p">]</span>

   <span class="n">ncl_color_blindness</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;StepSeq25&#39;</span><span class="p">,</span> <span class="s">&#39;posneg_2&#39;</span><span class="p">,</span> <span class="s">&#39;posneg_1&#39;</span><span class="p">,</span> <span class="s">&#39;BlueDarkOrange18&#39;</span><span class="p">,</span> <span class="s">&#39;BlueDarkRed18&#39;</span><span class="p">,</span>\
                        <span class="s">&#39;GreenMagenta16&#39;</span><span class="p">,</span> <span class="s">&#39;BlueGreen14&#39;</span><span class="p">,</span> <span class="s">&#39;BrownBlue12&#39;</span><span class="p">,</span> <span class="s">&#39;Cat12&#39;</span><span class="p">]</span>

   <span class="n">ncl_small</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;amwg&#39;</span><span class="p">,</span> <span class="s">&#39;amwg_blueyellowred&#39;</span><span class="p">,</span><span class="s">&#39;BlueDarkRed18&#39;</span><span class="p">,</span> <span class="s">&#39;BlueDarkOrange18&#39;</span><span class="p">,</span><span class="s">&#39;BlueGreen14&#39;</span><span class="p">,</span>\
              <span class="s">&#39;BrownBlue12&#39;</span><span class="p">,</span> <span class="s">&#39;Cat12&#39;</span><span class="p">,</span> <span class="s">&#39;cmp_flux&#39;</span><span class="p">,</span> <span class="s">&#39;cosam12&#39;</span><span class="p">,</span> <span class="s">&#39;cosam&#39;</span><span class="p">,</span>\
              <span class="s">&#39;GHRSST_anomaly&#39;</span><span class="p">,</span> <span class="s">&#39;GreenMagenta16&#39;</span><span class="p">,</span>\
              <span class="s">&#39;hotcold_18lev&#39;</span><span class="p">,</span> <span class="s">&#39;hotcolr_19lev&#39;</span><span class="p">,</span> <span class="s">&#39;mch_default&#39;</span><span class="p">,</span> <span class="s">&#39;nrl_sirkes&#39;</span><span class="p">,</span> \
              <span class="s">&#39;nrl_sirkes_nowhite&#39;</span><span class="p">,</span> <span class="s">&#39;perc2_9lev&#39;</span><span class="p">,</span> <span class="s">&#39;percent_11lev&#39;</span><span class="p">,</span> <span class="s">&#39;posneg_2&#39;</span><span class="p">,</span> <span class="s">&#39;prcp_1&#39;</span><span class="p">,</span> <span class="s">&#39;prcp_2&#39;</span><span class="p">,</span>\
              <span class="s">&#39;prcp_3&#39;</span><span class="p">,</span> <span class="s">&#39;precip_11lev&#39;</span><span class="p">,</span> <span class="s">&#39;precip_diff_12lev&#39;</span><span class="p">,</span> <span class="s">&#39;precip_diff_1lev&#39;</span><span class="p">,</span> <span class="s">&#39;precip2_15lev&#39;</span><span class="p">,</span>\
              <span class="s">&#39;precip2_17lev&#39;</span><span class="p">,</span> <span class="s">&#39;precip3_16lev&#39;</span><span class="p">,</span> <span class="s">&#39;precip4_11lev&#39;</span><span class="p">,</span> <span class="s">&#39;precip4_diff_19lev&#39;</span><span class="p">,</span> <span class="s">&#39;radar&#39;</span><span class="p">,</span>\
              <span class="s">&#39;radar_1&#39;</span><span class="p">,</span> <span class="s">&#39;rh_19lev&#39;</span><span class="p">,</span> <span class="s">&#39;seaice_1&#39;</span><span class="p">,</span> <span class="s">&#39;seaice_2&#39;</span><span class="p">,</span> <span class="s">&#39;so4_21&#39;</span><span class="p">,</span> <span class="s">&#39;spread_15lev&#39;</span><span class="p">,</span> <span class="s">&#39;StepSeq25&#39;</span><span class="p">,</span>\
              <span class="s">&#39;sunshine_9lev&#39;</span><span class="p">,</span> <span class="s">&#39;sunshine_diff_12lev&#39;</span><span class="p">,</span> <span class="s">&#39;temp_19lev&#39;</span><span class="p">,</span> <span class="s">&#39;temp_diff_18lev&#39;</span><span class="p">,</span> <span class="s">&#39;temp_diff_1lev&#39;</span><span class="p">,</span>\
              <span class="s">&#39;topo_15lev&#39;</span><span class="p">,</span> <span class="s">&#39;wgne15&#39;</span><span class="p">,</span> <span class="s">&#39;wind_17lev&#39;</span><span class="p">]</span>


   <span class="n">idl_guide</span><span class="o">=</span><span class="p">[]</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">45</span><span class="p">):</span>
      <span class="n">idl_guide</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;scale&#39;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>

   <span class="k">for</span> <span class="n">category</span> <span class="ow">in</span> <span class="s">&#39;ncl_meteoswiss&#39;</span><span class="p">,</span> <span class="s">&#39;ncl_small&#39;</span><span class="p">,</span> <span class="s">&#39;ncl_large&#39;</span><span class="p">,</span> <span class="s">&#39;ncl_color_blindness&#39;</span><span class="p">,</span> <span class="s">&#39;idl_guide&#39;</span><span class="p">:</span> 
      <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s">&#39;ncl_meteoswiss&#39;</span><span class="p">:</span> 
         <span class="n">scales</span><span class="o">=</span><span class="n">ncl_meteoswiss</span>
         <span class="n">div</span><span class="o">=</span><span class="s">&#39;================== =====&#39;</span>
         <span class="n">chars</span><span class="o">=</span><span class="mi">19</span>
         <span class="k">print</span> <span class="s">&#39;NCAR Command Language - MeteoSwiss colour maps&#39;</span>
         <span class="k">print</span> <span class="s">&#39;----------------------------------------------&#39;</span> 
         <span class="k">print</span> <span class="s">&#39;&#39;</span>
         <span class="k">print</span> <span class="n">div</span>
         <span class="k">print</span> <span class="s">&#39;Name               Scale&#39;</span>
         <span class="k">print</span> <span class="n">div</span>
      <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s">&#39;ncl_small&#39;</span><span class="p">:</span> 
         <span class="n">scales</span><span class="o">=</span><span class="n">ncl_small</span>
         <span class="n">div</span><span class="o">=</span><span class="s">&#39;=================== =====&#39;</span>
         <span class="n">chars</span><span class="o">=</span><span class="mi">20</span>
         <span class="k">print</span> <span class="s">&#39;NCAR Command Language - small color maps (&lt;50 colours)&#39;</span>
         <span class="k">print</span> <span class="s">&#39;------------------------------------------------------&#39;</span>
         <span class="k">print</span> <span class="s">&#39;&#39;</span>
         <span class="k">print</span> <span class="n">div</span>
         <span class="k">print</span> <span class="s">&#39;Name                Scale&#39;</span>
         <span class="k">print</span> <span class="n">div</span>
      <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s">&#39;ncl_large&#39;</span><span class="p">:</span> 
         <span class="n">scales</span><span class="o">=</span><span class="n">ncl_large</span>
         <span class="n">div</span><span class="o">=</span><span class="s">&#39;======================= =====&#39;</span>
         <span class="n">chars</span><span class="o">=</span><span class="mi">24</span>
         <span class="k">print</span> <span class="s">&#39;NCAR Command Language - large colour maps (&gt;50 colours)&#39;</span>
         <span class="k">print</span> <span class="s">&#39;-------------------------------------------------------&#39;</span>
         <span class="k">print</span> <span class="s">&#39;&#39;</span>
         <span class="k">print</span> <span class="n">div</span>
         <span class="k">print</span> <span class="s">&#39;Name                    Scale&#39;</span>
         <span class="k">print</span> <span class="n">div</span>
      <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s">&#39;ncl_color_blindness&#39;</span><span class="p">:</span> 
         <span class="n">scales</span><span class="o">=</span><span class="n">ncl_color_blindness</span>
         <span class="n">div</span><span class="o">=</span><span class="s">&#39;================ =====&#39;</span>
         <span class="n">chars</span><span class="o">=</span><span class="mi">17</span>
         <span class="k">print</span> <span class="s">&#39;NCAR Command Language - Enhanced to help with colour blindness&#39;</span>
         <span class="k">print</span> <span class="s">&#39;--------------------------------------------------------------&#39;</span>
         <span class="k">print</span> <span class="s">&#39;&#39;</span>
         <span class="k">print</span> <span class="n">div</span>
         <span class="k">print</span> <span class="s">&#39;Name             Scale&#39;</span>
         <span class="k">print</span> <span class="n">div</span>
         <span class="n">chars</span><span class="o">=</span><span class="mi">17</span>
      <span class="k">if</span> <span class="n">category</span> <span class="o">==</span> <span class="s">&#39;idl_guide&#39;</span><span class="p">:</span> 
         <span class="n">scales</span><span class="o">=</span><span class="n">idl_guide</span>
         <span class="n">div</span><span class="o">=</span><span class="s">&#39;======= =====&#39;</span>
         <span class="n">chars</span><span class="o">=</span><span class="mi">8</span>
         <span class="k">print</span> <span class="s">&#39;IDL guide scales&#39;</span>
         <span class="k">print</span> <span class="s">&#39;----------------&#39;</span>
         <span class="k">print</span> <span class="s">&#39;&#39;</span>
         <span class="k">print</span> <span class="n">div</span>
         <span class="k">print</span> <span class="s">&#39;Name    Scale&#39;</span>
         <span class="k">print</span> <span class="n">div</span>
         <span class="n">chars</span><span class="o">=</span><span class="mi">8</span>
       

      <span class="k">for</span> <span class="n">scale</span> <span class="ow">in</span> <span class="n">scales</span><span class="p">:</span>
         <span class="c">#Make image of scale</span>
         <span class="n">fig</span> <span class="o">=</span> <span class="n">plot</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mf">0.5</span><span class="p">))</span>
         <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>
         <span class="n">cscale</span><span class="p">(</span><span class="n">scale</span><span class="p">)</span>
         <span class="n">ncols</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
         <span class="n">cmap</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colors</span><span class="o">.</span><span class="n">ListedColormap</span><span class="p">(</span><span class="n">plotvars</span><span class="o">.</span><span class="n">cs</span><span class="p">)</span>
         <span class="n">cb1</span> <span class="o">=</span> <span class="n">matplotlib</span><span class="o">.</span><span class="n">colorbar</span><span class="o">.</span><span class="n">ColorbarBase</span><span class="p">(</span><span class="n">ax1</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">ticks</span><span class="o">=</span><span class="bp">None</span><span class="p">)</span>
         <span class="n">cb1</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
         <span class="n">cb1</span><span class="o">.</span><span class="n">set_ticklabels</span><span class="p">([</span><span class="s">&#39;&#39;</span><span class="p">,</span><span class="s">&#39;&#39;</span><span class="p">])</span>
         <span class="nb">file</span><span class="o">=</span><span class="s">&#39;/home/andy/public_html/cfplot_sphinx/images/colour_scales/&#39;</span><span class="o">+</span><span class="n">scale</span><span class="o">+</span><span class="s">&#39;.png&#39;</span>
         <span class="n">plot</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="nb">file</span><span class="p">)</span>
         <span class="n">plot</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

         <span class="c">#Use covert to trim the png file to remove white space</span>
         <span class="n">call</span><span class="p">([</span><span class="s">&quot;convert&quot;</span><span class="p">,</span> <span class="s">&quot;-trim&quot;</span><span class="p">,</span> <span class="nb">file</span><span class="p">,</span> <span class="nb">file</span><span class="p">])</span>

         <span class="n">name_pad</span><span class="o">=</span><span class="n">scale</span>
         <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">name_pad</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">chars</span><span class="p">:</span> <span class="n">name_pad</span><span class="o">=</span><span class="n">name_pad</span><span class="o">+</span><span class="s">&#39; &#39;</span>
         <span class="k">print</span>  <span class="n">name_pad</span><span class="o">+</span><span class="s">&#39;.. image:: images/colour_scales/&#39;</span><span class="o">+</span><span class="n">scale</span><span class="o">+</span><span class="s">&#39;.png&#39;</span>

      <span class="k">print</span> <span class="n">div</span>
      <span class="k">print</span> <span class="s">&#39;&#39;</span>
      <span class="k">print</span> <span class="s">&#39;&#39;</span>


</div>
<div class="viewcode-block" id="reset"><a class="viewcode-back" href="../reset.html#cfplot.reset">[docs]</a><span class="k">def</span> <span class="nf">reset</span><span class="p">():</span>   
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | reset all plotting variables</span>
<span class="sd">    |</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     name</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>
   <span class="n">axes</span><span class="p">()</span>
   <span class="n">cscale</span><span class="p">()</span>
   <span class="n">levs</span><span class="p">()</span>
   <span class="n">gset</span><span class="p">()</span>
   <span class="n">mapset</span><span class="p">()</span>
   <span class="n">setvars</span><span class="p">()</span>


</div>
<div class="viewcode-block" id="setvars"><a class="viewcode-back" href="../setvars.html#cfplot.setvars">[docs]</a><span class="k">def</span> <span class="nf">setvars</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">text_fontsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">axis_label_fontsize</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> \
        <span class="n">title_fontweight</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">,</span> <span class="n">text_fontweight</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">,</span> <span class="n">axis_label_fontweight</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">,</span> \
        <span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">,</span> <span class="n">continent_thickness</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">continent_color</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | setvars - set plotting variables</span>
<span class="sd">    |</span>
<span class="sd">    | file=None - output file name</span>
<span class="sd">    | text_fontsize=None - text fontsize, default=11</span>
<span class="sd">    | title_fontsize=None - title fontsize, default=15</span>
<span class="sd">    | axis_label_fontsize=None - default=11</span>
<span class="sd">    | text_fontweight=&#39;normal&#39; - text fontweight</span>
<span class="sd">    | title_fontweight=&#39;normal&#39; - title fontweight</span>
<span class="sd">    | axis_label_fontweight=&#39;normal&#39; - axis fontweight</span>
<span class="sd">    | fontweight=&#39;normal&#39; - all above fontweights</span>
<span class="sd">    | continent_thickness=None - default=1.5</span>
<span class="sd">    | continent_color=None - default=&#39;k&#39; (black)</span>
<span class="sd">    | </span>
<span class="sd">    | Use setvars() to reset to the defaults</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     name</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>

   <span class="k">if</span> <span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">title_fontsize</span><span class="p">,</span> <span class="n">text_fontsize</span><span class="p">,</span> <span class="n">axis_label_fontsize</span><span class="p">,</span> <span class="n">continent_thickness</span><span class="p">,</span> \
       <span class="n">title_fontweight</span><span class="p">,</span> <span class="n">text_fontweight</span><span class="p">,</span> <span class="n">axis_label_fontweight</span><span class="p">,</span> <span class="n">fontweight</span><span class="p">,</span> \
       <span class="n">continent_color</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">title_fontsize</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">text_fontsize</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">axis_label_fontsize</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">title_fontweight</span><span class="o">=</span><span class="s">&#39;normal&#39;</span>
      <span class="n">text_fontweight</span><span class="o">=</span><span class="s">&#39;normal&#39;</span>
      <span class="n">axis_label_fontweight</span><span class="o">=</span><span class="s">&#39;normal&#39;</span><span class="p">,</span>
      <span class="n">fontweight</span><span class="o">=</span><span class="s">&#39;normal&#39;</span>
      <span class="n">continent_thickness</span><span class="o">=</span><span class="bp">None</span>
      <span class="n">continent_color</span><span class="o">=</span><span class="bp">None</span>

   <span class="n">plotvars</span><span class="o">.</span><span class="n">file</span><span class="o">=</span><span class="nb">file</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontsize</span><span class="o">=</span><span class="n">title_fontsize</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontsize</span><span class="o">=</span><span class="n">axis_label_fontsize</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span><span class="o">=</span><span class="n">continent_thickness</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span><span class="o">=</span><span class="n">continent_color</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontsize</span><span class="o">=</span><span class="n">text_fontsize</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span><span class="o">=</span><span class="n">text_fontweight</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="o">=</span><span class="n">axis_label_fontweight</span>
   <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span><span class="o">=</span><span class="n">title_fontweight</span>
   <span class="k">if</span> <span class="n">fontweight</span> <span class="o">!=</span> <span class="s">&#39;normal&#39;</span><span class="p">:</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">text_fontweight</span><span class="o">=</span><span class="n">fontweight</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">axis_label_fontweight</span><span class="o">=</span><span class="n">fontweight</span>
      <span class="n">plotvars</span><span class="o">.</span><span class="n">title_fontweight</span><span class="o">=</span><span class="n">fontweight</span>



</div>
<div class="viewcode-block" id="rgrot"><a class="viewcode-back" href="../rgrot.html#cfplot.rgrot">[docs]</a><span class="k">def</span> <span class="nf">rgrot</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xpole</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | rgrot - rotate longitude and latitude points onto a rotated grid</span>
<span class="sd">    |</span>
<span class="sd">    | xin=xin - longitude locations</span>
<span class="sd">    | yin=yin - latitude locations</span>
<span class="sd">    | xpole=xpole - xpole in degrees</span>
<span class="sd">    | ypole=ypole - ypole in degrees</span>
<span class="sd">    | </span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">      x and y points on rotated grid </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>




   <span class="c">#Check input parameters</span>
   <span class="k">if</span> <span class="p">[</span><span class="n">xin</span><span class="p">,</span> <span class="n">yin</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n\</span>
<span class="s">             rgrot error</span><span class="se">\n\</span>
<span class="s">             xin, yin, xpole, ypole all need to be passed to rgrot to generate </span><span class="se">\n\</span>
<span class="s">             rotated output points</span><span class="se">\</span>
<span class="s">             </span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>


   <span class="c">#Define output arrays.</span>
   <span class="n">xout</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xin</span><span class="p">))</span>
   <span class="n">yout</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yin</span><span class="p">))</span>

   <span class="c">#Tolerance limit.</span>
   <span class="n">tol</span><span class="o">=</span><span class="mf">1.0E-6</span> 


   <span class="c">#Scale xpole to range -180 to 180.</span>
   <span class="n">xpole_orig</span><span class="o">=</span><span class="n">xpole</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">xpole</span> <span class="o">&gt;</span> <span class="mf">180.0</span><span class="p">):</span>  <span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="o">-</span><span class="mf">360.0</span>

   <span class="c">#Latitude of zero meridian.</span>
   <span class="n">x_zero</span><span class="o">=</span><span class="n">xpole</span><span class="o">+</span><span class="mf">180.0</span>


   <span class="c">#Sine and cosine of latitude of eq pole</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">ypole</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">):</span>
      <span class="n">sin_ypole</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ypole</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>
      <span class="n">cos_ypole</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypole</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">sin_ypole</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ypole</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>
      <span class="n">cos_ypole</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypole</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>



   <span class="c">#Transform to rotated grid.</span>
   <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xin</span><span class="p">)):</span>

      <span class="c">#Scale longitude to range -180 to +180 degs</span>
      <span class="n">xpt</span><span class="o">=</span><span class="n">xin</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">-</span><span class="n">x_zero</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">xpt</span> <span class="o">&gt;</span> <span class="mf">180.0</span><span class="p">):</span> <span class="n">xpt</span><span class="o">=</span><span class="n">xpt</span><span class="o">-</span><span class="mf">360.0</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">xpt</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">180.0</span><span class="p">):</span> <span class="n">xpt</span><span class="o">=</span><span class="n">xpt</span><span class="o">+</span><span class="mf">360.0</span>

      <span class="c">#Convert latitude &amp; longitude to radians</span>
      <span class="n">xpt</span><span class="o">=</span><span class="n">xpt</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span>
      <span class="n">ypt</span><span class="o">=</span><span class="n">yin</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span>

      <span class="c">#Calculate latitude.</span>
      <span class="n">arg</span><span class="o">=-</span><span class="n">cos_ypole</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">xpt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypt</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ypt</span><span class="p">)</span><span class="o">*</span><span class="n">sin_ypole</span>
      <span class="n">arg</span><span class="o">=</span><span class="nb">min</span><span class="p">([</span><span class="n">arg</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
      <span class="n">arg</span><span class="o">=</span><span class="nb">max</span><span class="p">([</span><span class="n">arg</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
      <span class="n">ypt2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arcsin</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
      <span class="n">yout</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">=</span><span class="n">ypt2</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

      <span class="c">#Calculate longitude.</span>
      <span class="n">t1</span><span class="o">=</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypt</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">xpt</span><span class="p">)</span><span class="o">*</span><span class="n">sin_ypole</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ypt</span><span class="p">)</span><span class="o">*</span><span class="n">cos_ypole</span><span class="p">)</span>
      <span class="n">t2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypt2</span><span class="p">)</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">t2</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">):</span> 
         <span class="n">xpt2</span><span class="o">=</span><span class="mf">0.0</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">arg</span><span class="o">=</span><span class="n">t1</span><span class="o">/</span><span class="n">t2</span>
         <span class="n">arg</span><span class="o">=</span><span class="nb">min</span><span class="p">([</span><span class="n">arg</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
         <span class="n">arg</span><span class="o">=</span><span class="nb">max</span><span class="p">([</span><span class="n">arg</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
         <span class="n">xpt2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">*</span><span class="mf">180.0</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
         <span class="k">if</span> <span class="p">(</span><span class="n">xpt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">xpt2</span><span class="o">=</span><span class="nb">abs</span><span class="p">(</span><span class="n">xpt2</span><span class="p">)</span>
         <span class="k">else</span><span class="p">:</span>
            <span class="n">xpt2</span><span class="o">=-</span><span class="mf">1.0</span><span class="o">*</span><span class="nb">abs</span><span class="p">(</span><span class="n">xpt2</span><span class="p">)</span>


      <span class="c">#Scale longitude to range 0 to 360 degs</span>
      <span class="c">#if (xpt2 &gt;= 360.0): xpt2=xpt2-360.0</span>
      <span class="c">#if (xpt2 &lt; 0.0): xpt2=xpt2+360.0</span>
      <span class="n">xout</span><span class="p">[</span><span class="n">ix</span><span class="p">]</span><span class="o">=</span><span class="n">xpt2</span>



   <span class="c">#Reset xpole</span>
   <span class="n">xpole</span><span class="o">=</span><span class="n">xpole_orig</span>


   <span class="k">return</span> <span class="p">(</span><span class="n">xout</span><span class="p">,</span> <span class="n">yout</span><span class="p">)</span>



</div>
<div class="viewcode-block" id="rgunrot"><a class="viewcode-back" href="../rgunrot.html#cfplot.rgunrot">[docs]</a><span class="k">def</span> <span class="nf">rgunrot</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xpole</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | rgunrot - translate points from a rotated grid to longitude/latitude grid</span>
<span class="sd">    |</span>
<span class="sd">    | xin=xin - longitude locations</span>
<span class="sd">    | yin=yin - latitude locations</span>
<span class="sd">    | xpole=xpole - xpole in degrees</span>
<span class="sd">    | ypole=ypole - ypole in degrees</span>
<span class="sd">    | </span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">      x and y points on longitude and latitude grid </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>   

   <span class="c">#Check input parameters</span>
   <span class="k">if</span> <span class="p">[</span><span class="n">xin</span><span class="p">,</span> <span class="n">yin</span><span class="p">,</span> <span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n\</span>
<span class="s">             rgrot error</span><span class="se">\n\</span>
<span class="s">             xin, yin, xpole, ypole all need to be passed to rgrot to generate </span><span class="se">\n\</span>
<span class="s">             rotated output points</span><span class="se">\</span>
<span class="s">             </span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>

   <span class="c">#Define output arrays.</span>
   <span class="n">xout</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xin</span><span class="p">))</span>
   <span class="n">yout</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yin</span><span class="p">))</span>

   <span class="c">#Tolerance limit.</span>
   <span class="n">tol</span><span class="o">=</span><span class="mf">1.0E-6</span> 


   <span class="c">#Form x and y arrays to hold grid coordinates.</span>
   <span class="n">nx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xin</span><span class="p">)</span>
   <span class="n">ny</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yin</span><span class="p">)</span>
   <span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">])</span>
   <span class="n">y</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">])</span>
   <span class="k">for</span> <span class="n">iy</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ny</span><span class="p">):</span>
       <span class="n">x</span><span class="p">[</span><span class="n">iy</span><span class="p">,:]</span><span class="o">=</span><span class="n">xin</span>
   <span class="k">for</span> <span class="n">ix</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">nx</span><span class="p">):</span>
      <span class="n">y</span><span class="p">[:,</span><span class="n">ix</span><span class="p">]</span><span class="o">=</span><span class="n">yin</span>

   <span class="n">xpole_orig</span><span class="o">=</span><span class="n">xpole</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">xpole</span> <span class="o">&gt;</span> <span class="mf">180.0</span><span class="p">):</span>  <span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="o">-</span><span class="mf">360.0</span>

   <span class="c">#Sine and cosine of latitude of eq pole</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">ypole</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">):</span>
      <span class="n">sin_ypole</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ypole</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>
      <span class="n">cos_ypole</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypole</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>
   <span class="k">else</span><span class="p">:</span>
      <span class="n">sin_ypole</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">ypole</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>
      <span class="n">cos_ypole</span><span class="o">=-</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ypole</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">/</span><span class="mf">180.0</span><span class="p">)</span>

   <span class="c">#Scale to -180 to 180</span>
   <span class="n">xx</span><span class="o">=</span><span class="n">x</span>
   <span class="n">yy</span><span class="o">=</span><span class="n">y</span>
   <span class="n">pts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xx</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">)</span>
   <span class="n">xx</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span><span class="o">=</span><span class="n">xx</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span><span class="o">-</span><span class="mf">360.0</span>
   <span class="n">pts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xx</span> <span class="o">&lt;</span> <span class="mi">180</span><span class="p">)</span>
   <span class="n">xx</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span><span class="o">=</span><span class="n">xx</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span><span class="o">+</span><span class="mf">360.0</span>
   <span class="n">xx</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">xx</span><span class="o">/</span><span class="mf">180.0</span>
   <span class="n">yy</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">yy</span><span class="o">/</span><span class="mf">180.0</span>


   <span class="n">arg</span><span class="o">=</span><span class="n">cosypole</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">xx</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">yy</span><span class="p">)</span><span class="o">*</span><span class="n">sinypole</span>
   <span class="n">pts</span><span class="o">=</span><span class="n">WHERE</span><span class="p">(</span><span class="n">arg</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">)</span>
   <span class="n">arg</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>
   <span class="n">pts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arg</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
   <span class="n">arg</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span><span class="o">=-</span><span class="mf">1.0</span>
   <span class="n">ay</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">asin</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
   <span class="n">y</span><span class="o">=</span><span class="mf">180.0</span><span class="o">*</span><span class="n">ay</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>


   <span class="n">t1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">YY</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">XX</span><span class="p">)</span><span class="o">*</span><span class="n">sinypole</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">YY</span><span class="p">)</span><span class="o">*</span><span class="n">cosypole</span>
   <span class="n">t2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">ay</span><span class="p">)</span>


   <span class="n">ax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">ny</span><span class="p">,</span><span class="n">nx</span><span class="p">])</span>

   <span class="n">pts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t2</span> <span class="o">&lt;</span> <span class="n">tol</span><span class="p">)</span>
   <span class="n">ax</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span><span class="o">=</span><span class="mf">0.0</span>

   <span class="n">pts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">t2</span> <span class="o">&gt;=</span> <span class="n">tol</span><span class="p">)</span>

   <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">pts</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
      <span class="n">arg</span><span class="o">=</span><span class="n">t1</span><span class="o">/</span><span class="n">T2</span>
      <span class="n">pts2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arg</span> <span class="o">&gt;</span> <span class="mf">1.0</span><span class="p">)</span>
      <span class="n">arg</span><span class="p">[</span><span class="n">pts2</span><span class="p">]</span><span class="o">=</span><span class="mf">1.0</span>
      <span class="n">pts2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">arg</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">)</span>
      <span class="n">arg</span><span class="p">[</span><span class="n">pts2</span><span class="p">]</span><span class="o">=-</span><span class="mf">1.0</span>
      <span class="n">arg</span><span class="o">=</span><span class="mf">180.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">acos</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
      <span class="n">ax</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span><span class="o">=</span><span class="n">arg</span>
      <span class="n">pts3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xx</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">)</span>
      <span class="n">ax</span><span class="p">[</span><span class="n">pts3</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">pts3</span><span class="p">])</span>
      <span class="n">pts3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xx</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
      <span class="n">ax</span><span class="p">[</span><span class="n">pts3</span><span class="p">]</span><span class="o">=-</span><span class="mf">1.0</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">ax</span><span class="p">[</span><span class="n">pts3</span><span class="p">])</span> 
      <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="o">+</span><span class="n">x0</span>
                                       

   <span class="n">x</span><span class="o">=</span><span class="n">ax</span>

   <span class="c">#Reset xpole</span>
   <span class="n">xpole</span><span class="o">=</span><span class="n">xpole_orig</span>

   <span class="k">return</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="vloc"><a class="viewcode-back" href="../vloc.html#cfplot.vloc">[docs]</a><span class="k">def</span> <span class="nf">vloc</span><span class="p">(</span><span class="n">xvec</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lons</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">    | vloc is used to locate the positions of a set of points in a vector</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    |</span>
<span class="sd">    | xvec=None - data longitudes </span>
<span class="sd">    | yvec=None - data latitudes</span>
<span class="sd">    | lons=None - required longitude positions</span>
<span class="sd">    | lats=None - required latitude positions</span>

<span class="sd">    :Returns:</span>
<span class="sd">     locations of user points in the longitude and latitude points</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>    

   <span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

   <span class="c">#Check input parameters</span>
   <span class="k">if</span> <span class="p">[</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="p">,</span> <span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
      <span class="n">errstr</span><span class="o">=</span><span class="s">&#39;</span><span class="se">\n\</span>
<span class="s">             vloc error</span><span class="se">\n\</span>
<span class="s">             xvec, yvec, lons, lats all need to be passed to vloc to generate </span><span class="se">\n\</span>
<span class="s">             a set of location points</span><span class="se">\</span>
<span class="s">             </span><span class="se">\n</span><span class="s">&#39;</span>
      <span class="k">raise</span>  <span class="ne">Warning</span><span class="p">(</span><span class="n">errstr</span><span class="p">)</span>


   <span class="n">xarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">))</span>
   <span class="n">yarr</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lats</span><span class="p">))</span>


   <span class="c">#Convert longitudes to -180 to 180.</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)):</span>
      <span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span><span class="o">-</span><span class="mi">180</span> 
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
      <span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">((</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">180</span><span class="p">)</span> <span class="o">%</span> <span class="mi">360</span><span class="p">)</span><span class="o">-</span><span class="mi">180</span> 

   <span class="c">#Centre around 180 degrees longitude if needed.</span>
   <span class="k">if</span> <span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">150</span><span class="p">):</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)):</span>
         <span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">xvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">360.0</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.0</span>
      <span class="n">pts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">xvec</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
      <span class="n">xvec</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span><span class="o">=</span><span class="n">xvec</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span><span class="o">+</span><span class="mf">360.0</span> 
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>
         <span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">+</span><span class="mf">360.0</span><span class="p">)</span> <span class="o">%</span> <span class="mf">360.0</span>
      <span class="n">pts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span>
      <span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span><span class="o">=</span><span class="n">lons</span><span class="p">[</span><span class="n">pts</span><span class="p">]</span><span class="o">+</span><span class="mf">360.0</span>  


   <span class="c">#Find position in array</span>
   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">lons</span><span class="p">)):</span>

      <span class="k">if</span> <span class="p">((</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">xvec</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">xvec</span><span class="p">))):</span> 
         <span class="n">xpt</span><span class="o">=-</span><span class="mi">1</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">xpts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">xvec</span><span class="p">)</span>
         <span class="n">xpt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">xpts</span><span class="p">)</span>

      <span class="k">if</span> <span class="p">((</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nb">min</span><span class="p">(</span><span class="n">yvec</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">(</span><span class="n">yvec</span><span class="p">))):</span> 
         <span class="n">ypt</span><span class="o">=-</span><span class="mi">1</span>
      <span class="k">else</span><span class="p">:</span>
         <span class="n">ypts</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">yvec</span><span class="p">)</span>
         <span class="n">ypt</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">ypts</span><span class="p">)</span>

 
      <span class="k">if</span> <span class="p">(</span><span class="n">xpt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
         <span class="n">xarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">xpt</span><span class="o">+</span><span class="p">(</span><span class="n">lons</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">xvec</span><span class="p">[</span><span class="n">xpt</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">xvec</span><span class="p">[</span><span class="n">xpt</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">xvec</span><span class="p">[</span><span class="n">xpt</span><span class="p">])</span> 
      <span class="k">else</span><span class="p">:</span>
         <span class="n">xarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>


      <span class="k">if</span> <span class="p">(</span><span class="n">ypt</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">ypt</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>  
         <span class="n">yarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">ypt</span><span class="o">+</span><span class="p">(</span><span class="n">lats</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">yvec</span><span class="p">[</span><span class="n">ypt</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">yvec</span><span class="p">[</span><span class="n">ypt</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">yvec</span><span class="p">[</span><span class="n">ypt</span><span class="p">])</span> 
      <span class="k">else</span><span class="p">:</span>
         <span class="n">yarr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span> 

   <span class="k">return</span> <span class="p">(</span><span class="n">xarr</span><span class="p">,</span> <span class="n">yarr</span><span class="p">)</span>




</div>
<div class="viewcode-block" id="rgaxes"><a class="viewcode-back" href="../rgaxes.html#cfplot.rgaxes">[docs]</a><span class="k">def</span> <span class="nf">rgaxes</span><span class="p">(</span><span class="n">xpole</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">spacing</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">degspacing</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> \
           <span class="n">continents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">grid</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">labels</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    | rgaxes - label rotated grid plots</span>
<span class="sd">    |</span>
<span class="sd">    | xpole=None - location of xpole in degrees</span>
<span class="sd">    | ypole=None - location of ypole in degrees</span>
<span class="sd">    | xvec=None - location of x grid points</span>
<span class="sd">    | yvec=None - location of y grid points</span>
<span class="sd">    | spacing=10.0 - spacing of the grid for longitude and latitude (degrees)</span>
<span class="sd">    | degspacing=0.75 - spacing of the points along the grid (degrees)</span>
<span class="sd">    | continents=True - draw continents</span>
<span class="sd">    | grid=True - draw grid</span>
<span class="sd">    | labels=True - draw axis labels</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    |</span>
<span class="sd">    :Returns:</span>
<span class="sd">     name</span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">    | </span>
<span class="sd">   &quot;&quot;&quot;</span>

   <span class="c">#Invert y array if going from north to south</span>
   <span class="c">#Otherwise this gives nans for all output</span>
   <span class="n">yvec_orig</span><span class="o">=</span><span class="n">yvec</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">yvec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">yvec</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


   <span class="c">#Extract map continents</span>
   <span class="n">m</span><span class="o">=</span><span class="n">Basemap</span><span class="p">(</span><span class="n">projection</span><span class="o">=</span><span class="s">&#39;cyl&#39;</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="n">plotvars</span><span class="o">.</span><span class="n">resolution</span><span class="p">)</span>
   
   <span class="n">clines</span><span class="o">=</span><span class="n">m</span><span class="o">.</span><span class="n">drawcoastlines</span><span class="p">(</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
   <span class="n">paths</span><span class="o">=</span><span class="n">clines</span><span class="o">.</span><span class="n">get_paths</span><span class="p">()</span>        
   <span class="n">npaths</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">paths</span><span class="p">)</span>

   <span class="n">gset</span><span class="p">(</span><span class="n">xmin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">xmax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">ymin</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ymax</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="n">yvec</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">user_gset</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

   <span class="c">#Set continent thickness and color if not already set</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_thickness</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">continent_thickness</span><span class="o">=</span><span class="mf">1.5</span>
   <span class="k">if</span> <span class="n">plotvars</span><span class="o">.</span><span class="n">continent_color</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> <span class="n">continent_color</span><span class="o">=</span><span class="s">&#39;k&#39;</span>

   <span class="c">#Draw continents</span>
   <span class="k">if</span> <span class="n">continents</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">npaths</span><span class="p">):</span>
         <span class="n">p</span><span class="o">=</span><span class="n">paths</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
         <span class="n">pvert</span><span class="o">=</span><span class="n">p</span><span class="o">.</span><span class="n">vertices</span>
         <span class="n">lons</span><span class="o">=</span><span class="n">pvert</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
         <span class="n">lats</span><span class="o">=</span><span class="n">pvert</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>

         <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span><span class="o">=</span><span class="n">rgrot</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="n">pvert</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="n">yin</span><span class="o">=</span><span class="n">pvert</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">)</span>  
         <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span> <span class="o">=</span> <span class="n">vloc</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">xout</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">yout</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span><span class="n">ypts</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="n">continent_thickness</span><span class="p">,</span> \
                            <span class="n">color</span><span class="o">=</span><span class="n">continent_color</span><span class="p">)</span>



   <span class="c">#Draw grid lines</span>
   <span class="k">if</span> <span class="n">grid</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
      <span class="n">lons</span><span class="o">=-</span><span class="mi">180</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">360</span><span class="o">/</span><span class="n">spacing</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">spacing</span>
      <span class="n">lats</span><span class="o">=-</span><span class="mi">90</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">180</span><span class="o">/</span><span class="n">spacing</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">spacing</span>
      <span class="c">#latmin=np.nanmin(xpts)</span>
      <span class="c">#lonmin=np.nanmin(ypts)</span>

      <span class="c">#Longitudes</span>
      <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">:</span>
         <span class="n">ipts</span><span class="o">=</span><span class="mf">179.</span><span class="o">/</span><span class="n">degspacing</span>
         <span class="n">lona</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ipts</span><span class="p">)</span><span class="o">+</span><span class="n">lon</span>
         <span class="n">lata</span><span class="o">=-</span><span class="mi">90</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ipts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">degspacing</span>
         <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span><span class="o">=</span><span class="n">rgrot</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="n">lona</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="n">lata</span><span class="p">,</span> <span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">)</span>   
         <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="o">=</span><span class="n">vloc</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">xout</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">yout</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span><span class="n">ypts</span><span class="p">,</span> <span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>

         <span class="c">#if labels is True:</span>
            <span class="c">#Label code here</span>

      <span class="c">#Latitudes</span>
      <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span><span class="p">:</span>
         <span class="n">ipts</span><span class="o">=</span><span class="mf">359.0</span><span class="o">/</span><span class="n">degspacing</span>
         <span class="n">lata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">ipts</span><span class="p">)</span><span class="o">+</span><span class="n">lat</span>
         <span class="n">lona</span><span class="o">=-</span><span class="mf">180.0</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ipts</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">degspacing</span>
         <span class="n">xout</span><span class="p">,</span> <span class="n">yout</span><span class="o">=</span><span class="n">rgrot</span><span class="p">(</span><span class="n">xin</span><span class="o">=</span><span class="n">lona</span><span class="p">,</span> <span class="n">yin</span><span class="o">=</span><span class="n">lata</span><span class="p">,</span> <span class="n">xpole</span><span class="o">=</span><span class="n">xpole</span><span class="p">,</span> <span class="n">ypole</span><span class="o">=</span><span class="n">ypole</span><span class="p">)</span>   
         <span class="n">xpts</span><span class="p">,</span> <span class="n">ypts</span><span class="o">=</span><span class="n">vloc</span><span class="p">(</span><span class="n">lons</span><span class="o">=</span><span class="n">xout</span><span class="p">,</span> <span class="n">lats</span><span class="o">=</span><span class="n">yout</span><span class="p">,</span> <span class="n">xvec</span><span class="o">=</span><span class="n">xvec</span><span class="p">,</span> <span class="n">yvec</span><span class="o">=</span><span class="n">yvec</span><span class="p">)</span>
         <span class="n">plotvars</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xpts</span><span class="p">,</span><span class="n">ypts</span><span class="p">,</span> <span class="s">&#39;:&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">)</span>

         <span class="c">#if labels is True:</span>
            <span class="c">#Label code here</span>

      <span class="c">#;Plot lower axis labels if required.</span>
      <span class="c">#IF ((ylab EQ 1) or (ylab EQ 3)) THEN BEGIN</span>
      <span class="c"># pts=WHERE(xyloc(*,1) GE 0.0, count)</span>
      <span class="c"># IF (count GE 1) THEN BEGIN</span>
      <span class="c">#  ipt=MIN(pts)</span>
      <span class="c">#  IF (xyloc(ipt,0) GE 0) THEN BEGIN</span>
      <span class="c">#   y0=ymin-200</span>
      <span class="c">#   x0=xmin+xyloc(ipt,0)/(xpts-1)*(xmax-xmin)</span>
      <span class="c">#   GPLOT, X=[x0, x0], Y=[ymin, ymin-150], /DEVICE</span>
      <span class="c">#   GPLOT, X=x0, Y=y0-50 , TEXT=SCROP(((lons(ix) + 180) MOD 360)-180), ALIGN=0.5, VALIGN=1.0, /DEVICE</span>
      <span class="c">#  ENDIF</span>
      <span class="c"># ENDIF</span>
      <span class="c">#ENDIF</span>


   <span class="n">yvec</span><span class="o">=</span><span class="n">yvec_orig</span>
   
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">

<h3><a href="http://ajheaps.github.io/cf-view/#">Homepage</a><p></h3>
<h5><a href="http://ajheaps.github.io/cf-view/download.html">Download/Install</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-view/versions.html">Versions</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-view/issues.html">Issues</a><p></h5
><h5><a href="http://ajheaps.github.io/cf-view/routines.html">Routines</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-view/license.html">License</a><p></h5>
<h5><a href="http://ajheaps.github.io/cf-view/search.html">Search</a><p></h5>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../index.html">cf-view 0.6.10 documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2016, Bryan Lawrence, Andy Heaps, Mudit Gupta.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2.2.
    </div>
  </body>
</html>